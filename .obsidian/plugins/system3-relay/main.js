/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var sv=Object.create;var Eo=Object.defineProperty;var ov=Object.getOwnPropertyDescriptor;var iv=Object.getOwnPropertyNames;var av=Object.getPrototypeOf,lv=Object.prototype.hasOwnProperty;var cv=(n,e,t)=>e in n?Eo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Gl=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),zl=(n,e)=>{for(var t in e)Eo(n,t,{get:e[t],enumerable:!0})},jd=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of iv(e))!lv.call(n,s)&&s!==t&&Eo(n,s,{get:()=>e[s],enumerable:!(r=ov(e,s))||r.enumerable});return n};var To=(n,e,t)=>(t=n!=null?sv(av(n)):{},jd(e||!n||!n.__esModule?Eo(t,"default",{value:n,enumerable:!0}):t,n)),uv=n=>jd(Eo({},"__esModule",{value:!0}),n);var at=(n,e,t)=>(cv(n,typeof e!="symbol"?e+"":e,t),t);var ba=Gl((UT,Up)=>{"use strict";function Tr(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}function $p(n,e){for(var t="",r=0,s=-1,o=0,i,l=0;l<=n.length;++l){if(l<n.length)i=n.charCodeAt(l);else{if(i===47)break;i=47}if(i===47){if(!(s===l-1||o===1))if(s!==l-1&&o===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var c=t.lastIndexOf("/");if(c!==t.length-1){c===-1?(t="",r=0):(t=t.slice(0,c),r=t.length-1-t.lastIndexOf("/")),s=l,o=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=l,o=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+n.slice(s+1,l):t=n.slice(s+1,l),r=l-s-1;s=l,o=0}else i===46&&o!==-1?++o:o=-1}return t}function E0(n,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+n+r:r}var Us={resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var o;s>=0?o=arguments[s]:(r===void 0&&(r=process.cwd()),o=r),Tr(o),o.length!==0&&(e=o+"/"+e,t=o.charCodeAt(0)===47)}return e=$p(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Tr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=$p(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Tr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Tr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Us.normalize(e)},relative:function(e,t){if(Tr(e),Tr(t),e===t||(e=Us.resolve(e),t=Us.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,o=s-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var l=t.length,c=l-i,f=o<c?o:c,d=-1,p=0;p<=f;++p){if(p===f){if(c>f){if(t.charCodeAt(i+p)===47)return t.slice(i+p+1);if(p===0)return t.slice(i+p)}else o>f&&(e.charCodeAt(r+p)===47?d=p:p===0&&(d=0));break}var g=e.charCodeAt(r+p),_=t.charCodeAt(i+p);if(g!==_)break;g===47&&(d=p)}var y="";for(p=r+d+1;p<=s;++p)(p===s||e.charCodeAt(p)===47)&&(y.length===0?y+="..":y+="/..");return y.length>0?y+t.slice(i+d):(i+=d,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(Tr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,o=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!o){s=i;break}}else o=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Tr(e);var r=0,s=-1,o=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var l=t.length-1,c=-1;for(i=e.length-1;i>=0;--i){var f=e.charCodeAt(i);if(f===47){if(!o){r=i+1;break}}else c===-1&&(o=!1,c=i+1),l>=0&&(f===t.charCodeAt(l)?--l===-1&&(s=i):(l=-1,s=c))}return r===s?s=c:s===-1&&(s=e.length),e.slice(r,s)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!o){r=i+1;break}}else s===-1&&(o=!1,s=i+1);return s===-1?"":e.slice(r,s)}},extname:function(e){Tr(e);for(var t=-1,r=0,s=-1,o=!0,i=0,l=e.length-1;l>=0;--l){var c=e.charCodeAt(l);if(c===47){if(!o){r=l+1;break}continue}s===-1&&(o=!1,s=l+1),c===46?t===-1?t=l:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||s===-1||i===0||i===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return E0("/",e)},parse:function(e){Tr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,o;s?(t.root="/",o=1):o=0;for(var i=-1,l=0,c=-1,f=!0,d=e.length-1,p=0;d>=o;--d){if(r=e.charCodeAt(d),r===47){if(!f){l=d+1;break}continue}c===-1&&(f=!1,c=d+1),r===46?i===-1?i=d:p!==1&&(p=1):i!==-1&&(p=-1)}return i===-1||c===-1||p===0||p===1&&i===c-1&&i===l+1?c!==-1&&(l===0&&s?t.base=t.name=e.slice(1,c):t.base=t.name=e.slice(l,c)):(l===0&&s?(t.name=e.slice(1,i),t.base=e.slice(1,c)):(t.name=e.slice(l,i),t.base=e.slice(l,c)),t.ext=e.slice(i,c)),l>0?t.dir=e.slice(0,l-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Us.posix=Us;Up.exports=Us});var Hm=Gl((pM,eo)=>{var W=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},Pe=-1,Oe=1,he=0;W.Diff=function(n,e){return[n,e]};W.prototype.diff_main=function(n,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var s=r;if(n==null||e==null)throw new Error("Null input. (diff_main)");if(n==e)return n?[new W.Diff(he,n)]:[];typeof t=="undefined"&&(t=!0);var o=t,i=this.diff_commonPrefix(n,e),l=n.substring(0,i);n=n.substring(i),e=e.substring(i),i=this.diff_commonSuffix(n,e);var c=n.substring(n.length-i);n=n.substring(0,n.length-i),e=e.substring(0,e.length-i);var f=this.diff_compute_(n,e,o,s);return l&&f.unshift(new W.Diff(he,l)),c&&f.push(new W.Diff(he,c)),this.diff_cleanupMerge(f),f};W.prototype.diff_compute_=function(n,e,t,r){var s;if(!n)return[new W.Diff(Oe,e)];if(!e)return[new W.Diff(Pe,n)];var o=n.length>e.length?n:e,i=n.length>e.length?e:n,l=o.indexOf(i);if(l!=-1)return s=[new W.Diff(Oe,o.substring(0,l)),new W.Diff(he,i),new W.Diff(Oe,o.substring(l+i.length))],n.length>e.length&&(s[0][0]=s[2][0]=Pe),s;if(i.length==1)return[new W.Diff(Pe,n),new W.Diff(Oe,e)];var c=this.diff_halfMatch_(n,e);if(c){var f=c[0],d=c[1],p=c[2],g=c[3],_=c[4],y=this.diff_main(f,p,t,r),x=this.diff_main(d,g,t,r);return y.concat([new W.Diff(he,_)],x)}return t&&n.length>100&&e.length>100?this.diff_lineMode_(n,e,r):this.diff_bisect_(n,e,r)};W.prototype.diff_lineMode_=function(n,e,t){var r=this.diff_linesToChars_(n,e);n=r.chars1,e=r.chars2;var s=r.lineArray,o=this.diff_main(n,e,!1,t);this.diff_charsToLines_(o,s),this.diff_cleanupSemantic(o),o.push(new W.Diff(he,""));for(var i=0,l=0,c=0,f="",d="";i<o.length;){switch(o[i][0]){case Oe:c++,d+=o[i][1];break;case Pe:l++,f+=o[i][1];break;case he:if(l>=1&&c>=1){o.splice(i-l-c,l+c),i=i-l-c;for(var p=this.diff_main(f,d,!1,t),g=p.length-1;g>=0;g--)o.splice(i,0,p[g]);i=i+p.length}c=0,l=0,f="",d="";break}i++}return o.pop(),o};W.prototype.diff_bisect_=function(n,e,t){for(var r=n.length,s=e.length,o=Math.ceil((r+s)/2),i=o,l=2*o,c=new Array(l),f=new Array(l),d=0;d<l;d++)c[d]=-1,f[d]=-1;c[i+1]=0,f[i+1]=0;for(var p=r-s,g=p%2!=0,_=0,y=0,x=0,C=0,v=0;v<o&&!(new Date().getTime()>t);v++){for(var D=-v+_;D<=v-y;D+=2){var Y=i+D,S;D==-v||D!=v&&c[Y-1]<c[Y+1]?S=c[Y+1]:S=c[Y-1]+1;for(var M=S-D;S<r&&M<s&&n.charAt(S)==e.charAt(M);)S++,M++;if(c[Y]=S,S>r)y+=2;else if(M>s)_+=2;else if(g){var O=i+p-D;if(O>=0&&O<l&&f[O]!=-1){var U=r-f[O];if(S>=U)return this.diff_bisectSplit_(n,e,S,M,t)}}}for(var I=-v+x;I<=v-C;I+=2){var O=i+I,U;I==-v||I!=v&&f[O-1]<f[O+1]?U=f[O+1]:U=f[O-1]+1;for(var oe=U-I;U<r&&oe<s&&n.charAt(r-U-1)==e.charAt(s-oe-1);)U++,oe++;if(f[O]=U,U>r)C+=2;else if(oe>s)x+=2;else if(!g){var Y=i+p-I;if(Y>=0&&Y<l&&c[Y]!=-1){var S=c[Y],M=i+S-Y;if(U=r-U,S>=U)return this.diff_bisectSplit_(n,e,S,M,t)}}}}return[new W.Diff(Pe,n),new W.Diff(Oe,e)]};W.prototype.diff_bisectSplit_=function(n,e,t,r,s){var o=n.substring(0,t),i=e.substring(0,r),l=n.substring(t),c=e.substring(r),f=this.diff_main(o,i,!1,s),d=this.diff_main(l,c,!1,s);return f.concat(d)};W.prototype.diff_linesToChars_=function(n,e){var t=[],r={};t[0]="";function s(c){for(var f="",d=0,p=-1,g=t.length;p<c.length-1;){p=c.indexOf(`
`,d),p==-1&&(p=c.length-1);var _=c.substring(d,p+1);(r.hasOwnProperty?r.hasOwnProperty(_):r[_]!==void 0)?f+=String.fromCharCode(r[_]):(g==o&&(_=c.substring(d),p=c.length),f+=String.fromCharCode(g),r[_]=g,t[g++]=_),d=p+1}return f}var o=4e4,i=s(n);o=65535;var l=s(e);return{chars1:i,chars2:l,lineArray:t}};W.prototype.diff_charsToLines_=function(n,e){for(var t=0;t<n.length;t++){for(var r=n[t][1],s=[],o=0;o<r.length;o++)s[o]=e[r.charCodeAt(o)];n[t][1]=s.join("")}};W.prototype.diff_commonPrefix=function(n,e){if(!n||!e||n.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(n.length,e.length),s=r,o=0;t<s;)n.substring(o,s)==e.substring(o,s)?(t=s,o=t):r=s,s=Math.floor((r-t)/2+t);return s};W.prototype.diff_commonSuffix=function(n,e){if(!n||!e||n.charAt(n.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(n.length,e.length),s=r,o=0;t<s;)n.substring(n.length-s,n.length-o)==e.substring(e.length-s,e.length-o)?(t=s,o=t):r=s,s=Math.floor((r-t)/2+t);return s};W.prototype.diff_commonOverlap_=function(n,e){var t=n.length,r=e.length;if(t==0||r==0)return 0;t>r?n=n.substring(t-r):t<r&&(e=e.substring(0,t));var s=Math.min(t,r);if(n==e)return s;for(var o=0,i=1;;){var l=n.substring(s-i),c=e.indexOf(l);if(c==-1)return o;i+=c,(c==0||n.substring(s-i)==e.substring(0,i))&&(o=i,i++)}};W.prototype.diff_halfMatch_=function(n,e){if(this.Diff_Timeout<=0)return null;var t=n.length>e.length?n:e,r=n.length>e.length?e:n;if(t.length<4||r.length*2<t.length)return null;var s=this;function o(y,x,C){for(var v=y.substring(C,C+Math.floor(y.length/4)),D=-1,Y="",S,M,O,U;(D=x.indexOf(v,D+1))!=-1;){var I=s.diff_commonPrefix(y.substring(C),x.substring(D)),oe=s.diff_commonSuffix(y.substring(0,C),x.substring(0,D));Y.length<oe+I&&(Y=x.substring(D-oe,D)+x.substring(D,D+I),S=y.substring(0,C-oe),M=y.substring(C+I),O=x.substring(0,D-oe),U=x.substring(D+I))}return Y.length*2>=y.length?[S,M,O,U,Y]:null}var i=o(t,r,Math.ceil(t.length/4)),l=o(t,r,Math.ceil(t.length/2)),c;if(!i&&!l)return null;l?i?c=i[4].length>l[4].length?i:l:c=l:c=i;var f,d,p,g;n.length>e.length?(f=c[0],d=c[1],p=c[2],g=c[3]):(p=c[0],g=c[1],f=c[2],d=c[3]);var _=c[4];return[f,d,p,g,_]};W.prototype.diff_cleanupSemantic=function(n){for(var e=!1,t=[],r=0,s=null,o=0,i=0,l=0,c=0,f=0;o<n.length;)n[o][0]==he?(t[r++]=o,i=c,l=f,c=0,f=0,s=n[o][1]):(n[o][0]==Oe?c+=n[o][1].length:f+=n[o][1].length,s&&s.length<=Math.max(i,l)&&s.length<=Math.max(c,f)&&(n.splice(t[r-1],0,new W.Diff(Pe,s)),n[t[r-1]+1][0]=Oe,r--,r--,o=r>0?t[r-1]:-1,i=0,l=0,c=0,f=0,s=null,e=!0)),o++;for(e&&this.diff_cleanupMerge(n),this.diff_cleanupSemanticLossless(n),o=1;o<n.length;){if(n[o-1][0]==Pe&&n[o][0]==Oe){var d=n[o-1][1],p=n[o][1],g=this.diff_commonOverlap_(d,p),_=this.diff_commonOverlap_(p,d);g>=_?(g>=d.length/2||g>=p.length/2)&&(n.splice(o,0,new W.Diff(he,p.substring(0,g))),n[o-1][1]=d.substring(0,d.length-g),n[o+1][1]=p.substring(g),o++):(_>=d.length/2||_>=p.length/2)&&(n.splice(o,0,new W.Diff(he,d.substring(0,_))),n[o-1][0]=Oe,n[o-1][1]=p.substring(0,p.length-_),n[o+1][0]=Pe,n[o+1][1]=d.substring(_),o++),o++}o++}};W.prototype.diff_cleanupSemanticLossless=function(n){function e(_,y){if(!_||!y)return 6;var x=_.charAt(_.length-1),C=y.charAt(0),v=x.match(W.nonAlphaNumericRegex_),D=C.match(W.nonAlphaNumericRegex_),Y=v&&x.match(W.whitespaceRegex_),S=D&&C.match(W.whitespaceRegex_),M=Y&&x.match(W.linebreakRegex_),O=S&&C.match(W.linebreakRegex_),U=M&&_.match(W.blanklineEndRegex_),I=O&&y.match(W.blanklineStartRegex_);return U||I?5:M||O?4:v&&!Y&&S?3:Y||S?2:v||D?1:0}for(var t=1;t<n.length-1;){if(n[t-1][0]==he&&n[t+1][0]==he){var r=n[t-1][1],s=n[t][1],o=n[t+1][1],i=this.diff_commonSuffix(r,s);if(i){var l=s.substring(s.length-i);r=r.substring(0,r.length-i),s=l+s.substring(0,s.length-i),o=l+o}for(var c=r,f=s,d=o,p=e(r,s)+e(s,o);s.charAt(0)===o.charAt(0);){r+=s.charAt(0),s=s.substring(1)+o.charAt(0),o=o.substring(1);var g=e(r,s)+e(s,o);g>=p&&(p=g,c=r,f=s,d=o)}n[t-1][1]!=c&&(c?n[t-1][1]=c:(n.splice(t-1,1),t--),n[t][1]=f,d?n[t+1][1]=d:(n.splice(t+1,1),t--))}t++}};W.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;W.whitespaceRegex_=/\s/;W.linebreakRegex_=/[\r\n]/;W.blanklineEndRegex_=/\n\r?\n$/;W.blanklineStartRegex_=/^\r?\n\r?\n/;W.prototype.diff_cleanupEfficiency=function(n){for(var e=!1,t=[],r=0,s=null,o=0,i=!1,l=!1,c=!1,f=!1;o<n.length;)n[o][0]==he?(n[o][1].length<this.Diff_EditCost&&(c||f)?(t[r++]=o,i=c,l=f,s=n[o][1]):(r=0,s=null),c=f=!1):(n[o][0]==Pe?f=!0:c=!0,s&&(i&&l&&c&&f||s.length<this.Diff_EditCost/2&&i+l+c+f==3)&&(n.splice(t[r-1],0,new W.Diff(Pe,s)),n[t[r-1]+1][0]=Oe,r--,s=null,i&&l?(c=f=!0,r=0):(r--,o=r>0?t[r-1]:-1,c=f=!1),e=!0)),o++;e&&this.diff_cleanupMerge(n)};W.prototype.diff_cleanupMerge=function(n){n.push(new W.Diff(he,""));for(var e=0,t=0,r=0,s="",o="",i;e<n.length;)switch(n[e][0]){case Oe:r++,o+=n[e][1],e++;break;case Pe:t++,s+=n[e][1],e++;break;case he:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(o,s),i!==0&&(e-t-r>0&&n[e-t-r-1][0]==he?n[e-t-r-1][1]+=o.substring(0,i):(n.splice(0,0,new W.Diff(he,o.substring(0,i))),e++),o=o.substring(i),s=s.substring(i)),i=this.diff_commonSuffix(o,s),i!==0&&(n[e][1]=o.substring(o.length-i)+n[e][1],o=o.substring(0,o.length-i),s=s.substring(0,s.length-i))),e-=t+r,n.splice(e,t+r),s.length&&(n.splice(e,0,new W.Diff(Pe,s)),e++),o.length&&(n.splice(e,0,new W.Diff(Oe,o)),e++),e++):e!==0&&n[e-1][0]==he?(n[e-1][1]+=n[e][1],n.splice(e,1)):e++,r=0,t=0,s="",o="";break}n[n.length-1][1]===""&&n.pop();var l=!1;for(e=1;e<n.length-1;)n[e-1][0]==he&&n[e+1][0]==he&&(n[e][1].substring(n[e][1].length-n[e-1][1].length)==n[e-1][1]?(n[e][1]=n[e-1][1]+n[e][1].substring(0,n[e][1].length-n[e-1][1].length),n[e+1][1]=n[e-1][1]+n[e+1][1],n.splice(e-1,1),l=!0):n[e][1].substring(0,n[e+1][1].length)==n[e+1][1]&&(n[e-1][1]+=n[e+1][1],n[e][1]=n[e][1].substring(n[e+1][1].length)+n[e+1][1],n.splice(e+1,1),l=!0)),e++;l&&this.diff_cleanupMerge(n)};W.prototype.diff_xIndex=function(n,e){var t=0,r=0,s=0,o=0,i;for(i=0;i<n.length&&(n[i][0]!==Oe&&(t+=n[i][1].length),n[i][0]!==Pe&&(r+=n[i][1].length),!(t>e));i++)s=t,o=r;return n.length!=i&&n[i][0]===Pe?o:o+(e-s)};W.prototype.diff_prettyHtml=function(n){for(var e=[],t=/&/g,r=/</g,s=/>/g,o=/\n/g,i=0;i<n.length;i++){var l=n[i][0],c=n[i][1],f=c.replace(t,"&amp;").replace(r,"&lt;").replace(s,"&gt;").replace(o,"&para;<br>");switch(l){case Oe:e[i]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case Pe:e[i]='<del style="background:#ffe6e6;">'+f+"</del>";break;case he:e[i]="<span>"+f+"</span>";break}}return e.join("")};W.prototype.diff_text1=function(n){for(var e=[],t=0;t<n.length;t++)n[t][0]!==Oe&&(e[t]=n[t][1]);return e.join("")};W.prototype.diff_text2=function(n){for(var e=[],t=0;t<n.length;t++)n[t][0]!==Pe&&(e[t]=n[t][1]);return e.join("")};W.prototype.diff_levenshtein=function(n){for(var e=0,t=0,r=0,s=0;s<n.length;s++){var o=n[s][0],i=n[s][1];switch(o){case Oe:t+=i.length;break;case Pe:r+=i.length;break;case he:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};W.prototype.diff_toDelta=function(n){for(var e=[],t=0;t<n.length;t++)switch(n[t][0]){case Oe:e[t]="+"+encodeURI(n[t][1]);break;case Pe:e[t]="-"+n[t][1].length;break;case he:e[t]="="+n[t][1].length;break}return e.join("	").replace(/%20/g," ")};W.prototype.diff_fromDelta=function(n,e){for(var t=[],r=0,s=0,o=e.split(/\t/g),i=0;i<o.length;i++){var l=o[i].substring(1);switch(o[i].charAt(0)){case"+":try{t[r++]=new W.Diff(Oe,decodeURI(l))}catch(d){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var c=parseInt(l,10);if(isNaN(c)||c<0)throw new Error("Invalid number in diff_fromDelta: "+l);var f=n.substring(s,s+=c);o[i].charAt(0)=="="?t[r++]=new W.Diff(he,f):t[r++]=new W.Diff(Pe,f);break;default:if(o[i])throw new Error("Invalid diff operation in diff_fromDelta: "+o[i])}}if(s!=n.length)throw new Error("Delta length ("+s+") does not equal source text length ("+n.length+").");return t};W.prototype.match_main=function(n,e,t){if(n==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,n.length)),n==e?0:n.length?n.substring(t,t+e.length)==e?t:this.match_bitap_(n,e,t):-1};W.prototype.match_bitap_=function(n,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),s=this;function o(S,M){var O=S/e.length,U=Math.abs(t-M);return s.Match_Distance?O+U/s.Match_Distance:U?1:O}var i=this.Match_Threshold,l=n.indexOf(e,t);l!=-1&&(i=Math.min(o(0,l),i),l=n.lastIndexOf(e,t+e.length),l!=-1&&(i=Math.min(o(0,l),i)));var c=1<<e.length-1;l=-1;for(var f,d,p=e.length+n.length,g,_=0;_<e.length;_++){for(f=0,d=p;f<d;)o(_,t+d)<=i?f=d:p=d,d=Math.floor((p-f)/2+f);p=d;var y=Math.max(1,t-d+1),x=Math.min(t+d,n.length)+e.length,C=Array(x+2);C[x+1]=(1<<_)-1;for(var v=x;v>=y;v--){var D=r[n.charAt(v-1)];if(_===0?C[v]=(C[v+1]<<1|1)&D:C[v]=(C[v+1]<<1|1)&D|((g[v+1]|g[v])<<1|1)|g[v+1],C[v]&c){var Y=o(_,v-1);if(Y<=i)if(i=Y,l=v-1,l>t)y=Math.max(1,2*t-l);else break}}if(o(_+1,t)>i)break;g=C}return l};W.prototype.match_alphabet_=function(n){for(var e={},t=0;t<n.length;t++)e[n.charAt(t)]=0;for(var t=0;t<n.length;t++)e[n.charAt(t)]|=1<<n.length-t-1;return e};W.prototype.patch_addContext_=function(n,e){if(e.length!=0){if(n.start2===null)throw Error("patch not initialized");for(var t=e.substring(n.start2,n.start2+n.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(n.start2-r,n.start2+n.length1+r);r+=this.Patch_Margin;var s=e.substring(n.start2-r,n.start2);s&&n.diffs.unshift(new W.Diff(he,s));var o=e.substring(n.start2+n.length1,n.start2+n.length1+r);o&&n.diffs.push(new W.Diff(he,o)),n.start1-=s.length,n.start2-=s.length,n.length1+=s.length+o.length,n.length2+=s.length+o.length}};W.prototype.patch_make=function(n,e,t){var r,s;if(typeof n=="string"&&typeof e=="string"&&typeof t=="undefined")r=n,s=this.diff_main(r,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(n&&typeof n=="object"&&typeof e=="undefined"&&typeof t=="undefined")s=n,r=this.diff_text1(s);else if(typeof n=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=n,s=e;else if(typeof n=="string"&&typeof e=="string"&&t&&typeof t=="object")r=n,s=t;else throw new Error("Unknown call format to patch_make.");if(s.length===0)return[];for(var o=[],i=new W.patch_obj,l=0,c=0,f=0,d=r,p=r,g=0;g<s.length;g++){var _=s[g][0],y=s[g][1];switch(!l&&_!==he&&(i.start1=c,i.start2=f),_){case Oe:i.diffs[l++]=s[g],i.length2+=y.length,p=p.substring(0,f)+y+p.substring(f);break;case Pe:i.length1+=y.length,i.diffs[l++]=s[g],p=p.substring(0,f)+p.substring(f+y.length);break;case he:y.length<=2*this.Patch_Margin&&l&&s.length!=g+1?(i.diffs[l++]=s[g],i.length1+=y.length,i.length2+=y.length):y.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(i,d),o.push(i),i=new W.patch_obj,l=0,d=p,c=f);break}_!==Oe&&(c+=y.length),_!==Pe&&(f+=y.length)}return l&&(this.patch_addContext_(i,d),o.push(i)),o};W.prototype.patch_deepCopy=function(n){for(var e=[],t=0;t<n.length;t++){var r=n[t],s=new W.patch_obj;s.diffs=[];for(var o=0;o<r.diffs.length;o++)s.diffs[o]=new W.Diff(r.diffs[o][0],r.diffs[o][1]);s.start1=r.start1,s.start2=r.start2,s.length1=r.length1,s.length2=r.length2,e[t]=s}return e};W.prototype.patch_apply=function(n,e){if(n.length==0)return[e,[]];n=this.patch_deepCopy(n);var t=this.patch_addPadding(n);e=t+e+t,this.patch_splitMax(n);for(var r=0,s=[],o=0;o<n.length;o++){var i=n[o].start2+r,l=this.diff_text1(n[o].diffs),c,f=-1;if(l.length>this.Match_MaxBits?(c=this.match_main(e,l.substring(0,this.Match_MaxBits),i),c!=-1&&(f=this.match_main(e,l.substring(l.length-this.Match_MaxBits),i+l.length-this.Match_MaxBits),(f==-1||c>=f)&&(c=-1))):c=this.match_main(e,l,i),c==-1)s[o]=!1,r-=n[o].length2-n[o].length1;else{s[o]=!0,r=c-i;var d;if(f==-1?d=e.substring(c,c+l.length):d=e.substring(c,f+this.Match_MaxBits),l==d)e=e.substring(0,c)+this.diff_text2(n[o].diffs)+e.substring(c+l.length);else{var p=this.diff_main(l,d,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(p)/l.length>this.Patch_DeleteThreshold)s[o]=!1;else{this.diff_cleanupSemanticLossless(p);for(var g=0,_,y=0;y<n[o].diffs.length;y++){var x=n[o].diffs[y];x[0]!==he&&(_=this.diff_xIndex(p,g)),x[0]===Oe?e=e.substring(0,c+_)+x[1]+e.substring(c+_):x[0]===Pe&&(e=e.substring(0,c+_)+e.substring(c+this.diff_xIndex(p,g+x[1].length))),x[0]!==Pe&&(g+=x[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,s]};W.prototype.patch_addPadding=function(n){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<n.length;r++)n[r].start1+=e,n[r].start2+=e;var s=n[0],o=s.diffs;if(o.length==0||o[0][0]!=he)o.unshift(new W.Diff(he,t)),s.start1-=e,s.start2-=e,s.length1+=e,s.length2+=e;else if(e>o[0][1].length){var i=e-o[0][1].length;o[0][1]=t.substring(o[0][1].length)+o[0][1],s.start1-=i,s.start2-=i,s.length1+=i,s.length2+=i}if(s=n[n.length-1],o=s.diffs,o.length==0||o[o.length-1][0]!=he)o.push(new W.Diff(he,t)),s.length1+=e,s.length2+=e;else if(e>o[o.length-1][1].length){var i=e-o[o.length-1][1].length;o[o.length-1][1]+=t.substring(0,i),s.length1+=i,s.length2+=i}return t};W.prototype.patch_splitMax=function(n){for(var e=this.Match_MaxBits,t=0;t<n.length;t++)if(!(n[t].length1<=e)){var r=n[t];n.splice(t--,1);for(var s=r.start1,o=r.start2,i="";r.diffs.length!==0;){var l=new W.patch_obj,c=!0;for(l.start1=s-i.length,l.start2=o-i.length,i!==""&&(l.length1=l.length2=i.length,l.diffs.push(new W.Diff(he,i)));r.diffs.length!==0&&l.length1<e-this.Patch_Margin;){var f=r.diffs[0][0],d=r.diffs[0][1];f===Oe?(l.length2+=d.length,o+=d.length,l.diffs.push(r.diffs.shift()),c=!1):f===Pe&&l.diffs.length==1&&l.diffs[0][0]==he&&d.length>2*e?(l.length1+=d.length,s+=d.length,c=!1,l.diffs.push(new W.Diff(f,d)),r.diffs.shift()):(d=d.substring(0,e-l.length1-this.Patch_Margin),l.length1+=d.length,s+=d.length,f===he?(l.length2+=d.length,o+=d.length):c=!1,l.diffs.push(new W.Diff(f,d)),d==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(d.length))}i=this.diff_text2(l.diffs),i=i.substring(i.length-this.Patch_Margin);var p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);p!==""&&(l.length1+=p.length,l.length2+=p.length,l.diffs.length!==0&&l.diffs[l.diffs.length-1][0]===he?l.diffs[l.diffs.length-1][1]+=p:l.diffs.push(new W.Diff(he,p))),c||n.splice(++t,0,l)}}};W.prototype.patch_toText=function(n){for(var e=[],t=0;t<n.length;t++)e[t]=n[t];return e.join("")};W.prototype.patch_fromText=function(n){var e=[];if(!n)return e;for(var t=n.split(`
`),r=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var o=t[r].match(s);if(!o)throw new Error("Invalid patch string: "+t[r]);var i=new W.patch_obj;for(e.push(i),i.start1=parseInt(o[1],10),o[2]===""?(i.start1--,i.length1=1):o[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(o[2],10)),i.start2=parseInt(o[3],10),o[4]===""?(i.start2--,i.length2=1):o[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(o[4],10)),r++;r<t.length;){var l=t[r].charAt(0);try{var c=decodeURI(t[r].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+c)}if(l=="-")i.diffs.push(new W.Diff(Pe,c));else if(l=="+")i.diffs.push(new W.Diff(Oe,c));else if(l==" ")i.diffs.push(new W.Diff(he,c));else{if(l=="@")break;if(l!=="")throw new Error('Invalid patch mode "'+l+'" in: '+c)}r++}}return e};W.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};W.patch_obj.prototype.toString=function(){var n,e;this.length1===0?n=this.start1+",0":this.length1==1?n=this.start1+1:n=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+n+" +"+e+` @@
`],r,s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case Oe:r="+";break;case Pe:r="-";break;case he:r=" ";break}t[s+1]=r+encodeURI(this.diffs[s][1])+`
`}return t.join("").replace(/%20/g," ")};eo.exports=W;eo.exports.diff_match_patch=W;eo.exports.DIFF_DELETE=Pe;eo.exports.DIFF_INSERT=Oe;eo.exports.DIFF_EQUAL=he});var xg=Gl((Sf,oo)=>{(function(n,e){typeof Sf=="object"&&typeof oo!="undefined"?oo.exports=e():typeof define=="function"&&define.amd?define(e):n.moment=e()})(Sf,function(){"use strict";var n;function e(){return n.apply(null,arguments)}function t(a){n=a}function r(a){return a instanceof Array||Object.prototype.toString.call(a)==="[object Array]"}function s(a){return a!=null&&Object.prototype.toString.call(a)==="[object Object]"}function o(a,u){return Object.prototype.hasOwnProperty.call(a,u)}function i(a){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(a).length===0;var u;for(u in a)if(o(a,u))return!1;return!0}function l(a){return a===void 0}function c(a){return typeof a=="number"||Object.prototype.toString.call(a)==="[object Number]"}function f(a){return a instanceof Date||Object.prototype.toString.call(a)==="[object Date]"}function d(a,u){var h=[],m,w=a.length;for(m=0;m<w;++m)h.push(u(a[m],m));return h}function p(a,u){for(var h in u)o(u,h)&&(a[h]=u[h]);return o(u,"toString")&&(a.toString=u.toString),o(u,"valueOf")&&(a.valueOf=u.valueOf),a}function g(a,u,h,m){return Ed(a,u,h,m,!0).utc()}function _(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function y(a){return a._pf==null&&(a._pf=_()),a._pf}var x;Array.prototype.some?x=Array.prototype.some:x=function(a){var u=Object(this),h=u.length>>>0,m;for(m=0;m<h;m++)if(m in u&&a.call(this,u[m],m,u))return!0;return!1};function C(a){if(a._isValid==null){var u=y(a),h=x.call(u.parsedDateParts,function(w){return w!=null}),m=!isNaN(a._d.getTime())&&u.overflow<0&&!u.empty&&!u.invalidEra&&!u.invalidMonth&&!u.invalidWeekday&&!u.weekdayMismatch&&!u.nullInput&&!u.invalidFormat&&!u.userInvalidated&&(!u.meridiem||u.meridiem&&h);if(a._strict&&(m=m&&u.charsLeftOver===0&&u.unusedTokens.length===0&&u.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(a))a._isValid=m;else return m}return a._isValid}function v(a){var u=g(NaN);return a!=null?p(y(u),a):y(u).userInvalidated=!0,u}var D=e.momentProperties=[],Y=!1;function S(a,u){var h,m,w,b=D.length;if(l(u._isAMomentObject)||(a._isAMomentObject=u._isAMomentObject),l(u._i)||(a._i=u._i),l(u._f)||(a._f=u._f),l(u._l)||(a._l=u._l),l(u._strict)||(a._strict=u._strict),l(u._tzm)||(a._tzm=u._tzm),l(u._isUTC)||(a._isUTC=u._isUTC),l(u._offset)||(a._offset=u._offset),l(u._pf)||(a._pf=y(u)),l(u._locale)||(a._locale=u._locale),b>0)for(h=0;h<b;h++)m=D[h],w=u[m],l(w)||(a[m]=w);return a}function M(a){S(this,a),this._d=new Date(a._d!=null?a._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),Y===!1&&(Y=!0,e.updateOffset(this),Y=!1)}function O(a){return a instanceof M||a!=null&&a._isAMomentObject!=null}function U(a){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+a)}function I(a,u){var h=!0;return p(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,a),h){var m=[],w,b,P,ee=arguments.length;for(b=0;b<ee;b++){if(w="",typeof arguments[b]=="object"){w+=`
[`+b+"] ";for(P in arguments[0])o(arguments[0],P)&&(w+=P+": "+arguments[0][P]+", ");w=w.slice(0,-2)}else w=arguments[b];m.push(w)}U(a+`
Arguments: `+Array.prototype.slice.call(m).join("")+`
`+new Error().stack),h=!1}return u.apply(this,arguments)},u)}var oe={};function ue(a,u){e.deprecationHandler!=null&&e.deprecationHandler(a,u),oe[a]||(U(u),oe[a]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function se(a){return typeof Function!="undefined"&&a instanceof Function||Object.prototype.toString.call(a)==="[object Function]"}function ge(a){var u,h;for(h in a)o(a,h)&&(u=a[h],se(u)?this[h]=u:this["_"+h]=u);this._config=a,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function be(a,u){var h=p({},a),m;for(m in u)o(u,m)&&(s(a[m])&&s(u[m])?(h[m]={},p(h[m],a[m]),p(h[m],u[m])):u[m]!=null?h[m]=u[m]:delete h[m]);for(m in a)o(a,m)&&!o(u,m)&&s(a[m])&&(h[m]=p({},h[m]));return h}function $(a){a!=null&&this.set(a)}var j;Object.keys?j=Object.keys:j=function(a){var u,h=[];for(u in a)o(a,u)&&h.push(u);return h};var H={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function z(a,u,h){var m=this._calendar[a]||this._calendar.sameElse;return se(m)?m.call(u,h):m}function ke(a,u,h){var m=""+Math.abs(a),w=u-m.length,b=a>=0;return(b?h?"+":"":"-")+Math.pow(10,Math.max(0,w)).toString().substr(1)+m}var vt=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,st=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,yt={},le={};function G(a,u,h,m){var w=m;typeof m=="string"&&(w=function(){return this[m]()}),a&&(le[a]=w),u&&(le[u[0]]=function(){return ke(w.apply(this,arguments),u[1],u[2])}),h&&(le[h]=function(){return this.localeData().ordinal(w.apply(this,arguments),a)})}function sn(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function Ht(a){var u=a.match(vt),h,m;for(h=0,m=u.length;h<m;h++)le[u[h]]?u[h]=le[u[h]]:u[h]=sn(u[h]);return function(w){var b="",P;for(P=0;P<m;P++)b+=se(u[P])?u[P].call(w,a):u[P];return b}}function Rr(a,u){return a.isValid()?(u=rs(u,a.localeData()),yt[u]=yt[u]||Ht(u),yt[u](a)):a.localeData().invalidDate()}function rs(a,u){var h=5;function m(w){return u.longDateFormat(w)||w}for(st.lastIndex=0;h>=0&&st.test(a);)a=a.replace(st,m),st.lastIndex=0,h-=1;return a}var ns={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function lo(a){var u=this._longDateFormat[a],h=this._longDateFormat[a.toUpperCase()];return u||!h?u:(this._longDateFormat[a]=h.match(vt).map(function(m){return m==="MMMM"||m==="MM"||m==="DD"||m==="dddd"?m.slice(1):m}).join(""),this._longDateFormat[a])}var co="Invalid date";function uo(){return this._invalidDate}var fo="%d",ho=/\d{1,2}/;function po(a){return this._ordinal.replace("%d",a)}var mo={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function go(a,u,h,m){var w=this._relativeTime[h];return se(w)?w(a,u,h,m):w.replace(/%d/i,a)}function yo(a,u){var h=this._relativeTime[a>0?"future":"past"];return se(h)?h(u):h.replace(/%s/i,u)}var Pr={};function Ze(a,u){var h=a.toLowerCase();Pr[h]=Pr[h+"s"]=Pr[u]=a}function R(a){return typeof a=="string"?Pr[a]||Pr[a.toLowerCase()]:void 0}function de(a){var u={},h,m;for(m in a)o(a,m)&&(h=R(m),h&&(u[h]=a[m]));return u}var Ue={};function Ae(a,u){Ue[a]=u}function on(a){var u=[],h;for(h in a)o(a,h)&&u.push({unit:h,priority:Ue[h]});return u.sort(function(m,w){return m.priority-w.priority}),u}function ss(a){return a%4===0&&a%100!==0||a%400===0}function wt(a){return a<0?Math.ceil(a)||0:Math.floor(a)}function ye(a){var u=+a,h=0;return u!==0&&isFinite(u)&&(h=wt(u)),h}function os(a,u){return function(h){return h!=null?(id(this,a,h),e.updateOffset(this,u),this):vi(this,a)}}function vi(a,u){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+u]():NaN}function id(a,u,h){a.isValid()&&!isNaN(h)&&(u==="FullYear"&&ss(a.year())&&a.month()===1&&a.date()===29?(h=ye(h),a._d["set"+(a._isUTC?"UTC":"")+u](h,a.month(),Ai(h,a.month()))):a._d["set"+(a._isUTC?"UTC":"")+u](h))}function xy(a){return a=R(a),se(this[a])?this[a]():this}function Sy(a,u){if(typeof a=="object"){a=de(a);var h=on(a),m,w=h.length;for(m=0;m<w;m++)this[h[m].unit](a[h[m].unit])}else if(a=R(a),se(this[a]))return this[a](u);return this}var ad=/\d/,Ot=/\d\d/,ld=/\d{3}/,Dl=/\d{4}/,xi=/[+-]?\d{6}/,Ie=/\d\d?/,cd=/\d\d\d\d?/,ud=/\d\d\d\d\d\d?/,Si=/\d{1,3}/,Fl=/\d{1,4}/,ki=/[+-]?\d{1,6}/,is=/\d+/,Ci=/[+-]?\d+/,ky=/Z|[+-]\d\d:?\d\d/gi,Ei=/Z|[+-]\d\d(?::?\d\d)?/gi,Cy=/[+-]?\d+(\.\d{1,3})?/,wo=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ti;Ti={};function X(a,u,h){Ti[a]=se(u)?u:function(m,w){return m&&h?h:u}}function Ey(a,u){return o(Ti,a)?Ti[a](u._strict,u._locale):new RegExp(Ty(a))}function Ty(a){return It(a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(u,h,m,w,b){return h||m||w||b}))}function It(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var Ml={};function De(a,u){var h,m=u,w;for(typeof a=="string"&&(a=[a]),c(u)&&(m=function(b,P){P[u]=ye(b)}),w=a.length,h=0;h<w;h++)Ml[a[h]]=m}function _o(a,u){De(a,function(h,m,w,b){w._w=w._w||{},u(h,w._w,w,b)})}function Ay(a,u,h){u!=null&&o(Ml,a)&&Ml[a](u,h._a,h,a)}var _t=0,Or=1,_r=2,ot=3,rr=4,Ir=5,Dn=6,Dy=7,Fy=8;function My(a,u){return(a%u+u)%u}var qe;Array.prototype.indexOf?qe=Array.prototype.indexOf:qe=function(a){var u;for(u=0;u<this.length;++u)if(this[u]===a)return u;return-1};function Ai(a,u){if(isNaN(a)||isNaN(u))return NaN;var h=My(u,12);return a+=(u-h)/12,h===1?ss(a)?29:28:31-h%7%2}G("M",["MM",2],"Mo",function(){return this.month()+1}),G("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),G("MMMM",0,0,function(a){return this.localeData().months(this,a)}),Ze("month","M"),Ae("month",8),X("M",Ie),X("MM",Ie,Ot),X("MMM",function(a,u){return u.monthsShortRegex(a)}),X("MMMM",function(a,u){return u.monthsRegex(a)}),De(["M","MM"],function(a,u){u[Or]=ye(a)-1}),De(["MMM","MMMM"],function(a,u,h,m){var w=h._locale.monthsParse(a,m,h._strict);w!=null?u[Or]=w:y(h).invalidMonth=a});var Ry="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),fd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),dd=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Py=wo,Oy=wo;function Iy(a,u){return a?r(this._months)?this._months[a.month()]:this._months[(this._months.isFormat||dd).test(u)?"format":"standalone"][a.month()]:r(this._months)?this._months:this._months.standalone}function Ly(a,u){return a?r(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[dd.test(u)?"format":"standalone"][a.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function $y(a,u,h){var m,w,b,P=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],m=0;m<12;++m)b=g([2e3,m]),this._shortMonthsParse[m]=this.monthsShort(b,"").toLocaleLowerCase(),this._longMonthsParse[m]=this.months(b,"").toLocaleLowerCase();return h?u==="MMM"?(w=qe.call(this._shortMonthsParse,P),w!==-1?w:null):(w=qe.call(this._longMonthsParse,P),w!==-1?w:null):u==="MMM"?(w=qe.call(this._shortMonthsParse,P),w!==-1?w:(w=qe.call(this._longMonthsParse,P),w!==-1?w:null)):(w=qe.call(this._longMonthsParse,P),w!==-1?w:(w=qe.call(this._shortMonthsParse,P),w!==-1?w:null))}function Uy(a,u,h){var m,w,b;if(this._monthsParseExact)return $y.call(this,a,u,h);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),m=0;m<12;m++){if(w=g([2e3,m]),h&&!this._longMonthsParse[m]&&(this._longMonthsParse[m]=new RegExp("^"+this.months(w,"").replace(".","")+"$","i"),this._shortMonthsParse[m]=new RegExp("^"+this.monthsShort(w,"").replace(".","")+"$","i")),!h&&!this._monthsParse[m]&&(b="^"+this.months(w,"")+"|^"+this.monthsShort(w,""),this._monthsParse[m]=new RegExp(b.replace(".",""),"i")),h&&u==="MMMM"&&this._longMonthsParse[m].test(a))return m;if(h&&u==="MMM"&&this._shortMonthsParse[m].test(a))return m;if(!h&&this._monthsParse[m].test(a))return m}}function hd(a,u){var h;if(!a.isValid())return a;if(typeof u=="string"){if(/^\d+$/.test(u))u=ye(u);else if(u=a.localeData().monthsParse(u),!c(u))return a}return h=Math.min(a.date(),Ai(a.year(),u)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](u,h),a}function pd(a){return a!=null?(hd(this,a),e.updateOffset(this,!0),this):vi(this,"Month")}function Ny(){return Ai(this.year(),this.month())}function By(a){return this._monthsParseExact?(o(this,"_monthsRegex")||md.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex):(o(this,"_monthsShortRegex")||(this._monthsShortRegex=Py),this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex)}function Vy(a){return this._monthsParseExact?(o(this,"_monthsRegex")||md.call(this),a?this._monthsStrictRegex:this._monthsRegex):(o(this,"_monthsRegex")||(this._monthsRegex=Oy),this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex)}function md(){function a(P,ee){return ee.length-P.length}var u=[],h=[],m=[],w,b;for(w=0;w<12;w++)b=g([2e3,w]),u.push(this.monthsShort(b,"")),h.push(this.months(b,"")),m.push(this.months(b,"")),m.push(this.monthsShort(b,""));for(u.sort(a),h.sort(a),m.sort(a),w=0;w<12;w++)u[w]=It(u[w]),h[w]=It(h[w]);for(w=0;w<24;w++)m[w]=It(m[w]);this._monthsRegex=new RegExp("^("+m.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+u.join("|")+")","i")}G("Y",0,0,function(){var a=this.year();return a<=9999?ke(a,4):"+"+a}),G(0,["YY",2],0,function(){return this.year()%100}),G(0,["YYYY",4],0,"year"),G(0,["YYYYY",5],0,"year"),G(0,["YYYYYY",6,!0],0,"year"),Ze("year","y"),Ae("year",1),X("Y",Ci),X("YY",Ie,Ot),X("YYYY",Fl,Dl),X("YYYYY",ki,xi),X("YYYYYY",ki,xi),De(["YYYYY","YYYYYY"],_t),De("YYYY",function(a,u){u[_t]=a.length===2?e.parseTwoDigitYear(a):ye(a)}),De("YY",function(a,u){u[_t]=e.parseTwoDigitYear(a)}),De("Y",function(a,u){u[_t]=parseInt(a,10)});function bo(a){return ss(a)?366:365}e.parseTwoDigitYear=function(a){return ye(a)+(ye(a)>68?1900:2e3)};var gd=os("FullYear",!0);function Hy(){return ss(this.year())}function Wy(a,u,h,m,w,b,P){var ee;return a<100&&a>=0?(ee=new Date(a+400,u,h,m,w,b,P),isFinite(ee.getFullYear())&&ee.setFullYear(a)):ee=new Date(a,u,h,m,w,b,P),ee}function vo(a){var u,h;return a<100&&a>=0?(h=Array.prototype.slice.call(arguments),h[0]=a+400,u=new Date(Date.UTC.apply(null,h)),isFinite(u.getUTCFullYear())&&u.setUTCFullYear(a)):u=new Date(Date.UTC.apply(null,arguments)),u}function Di(a,u,h){var m=7+u-h,w=(7+vo(a,0,m).getUTCDay()-u)%7;return-w+m-1}function yd(a,u,h,m,w){var b=(7+h-m)%7,P=Di(a,m,w),ee=1+7*(u-1)+b+P,pe,Fe;return ee<=0?(pe=a-1,Fe=bo(pe)+ee):ee>bo(a)?(pe=a+1,Fe=ee-bo(a)):(pe=a,Fe=ee),{year:pe,dayOfYear:Fe}}function xo(a,u,h){var m=Di(a.year(),u,h),w=Math.floor((a.dayOfYear()-m-1)/7)+1,b,P;return w<1?(P=a.year()-1,b=w+Lr(P,u,h)):w>Lr(a.year(),u,h)?(b=w-Lr(a.year(),u,h),P=a.year()+1):(P=a.year(),b=w),{week:b,year:P}}function Lr(a,u,h){var m=Di(a,u,h),w=Di(a+1,u,h);return(bo(a)-m+w)/7}G("w",["ww",2],"wo","week"),G("W",["WW",2],"Wo","isoWeek"),Ze("week","w"),Ze("isoWeek","W"),Ae("week",5),Ae("isoWeek",5),X("w",Ie),X("ww",Ie,Ot),X("W",Ie),X("WW",Ie,Ot),_o(["w","ww","W","WW"],function(a,u,h,m){u[m.substr(0,1)]=ye(a)});function Ky(a){return xo(a,this._week.dow,this._week.doy).week}var Yy={dow:0,doy:6};function Jy(){return this._week.dow}function qy(){return this._week.doy}function jy(a){var u=this.localeData().week(this);return a==null?u:this.add((a-u)*7,"d")}function Gy(a){var u=xo(this,1,4).week;return a==null?u:this.add((a-u)*7,"d")}G("d",0,"do","day"),G("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),G("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),G("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),G("e",0,0,"weekday"),G("E",0,0,"isoWeekday"),Ze("day","d"),Ze("weekday","e"),Ze("isoWeekday","E"),Ae("day",11),Ae("weekday",11),Ae("isoWeekday",11),X("d",Ie),X("e",Ie),X("E",Ie),X("dd",function(a,u){return u.weekdaysMinRegex(a)}),X("ddd",function(a,u){return u.weekdaysShortRegex(a)}),X("dddd",function(a,u){return u.weekdaysRegex(a)}),_o(["dd","ddd","dddd"],function(a,u,h,m){var w=h._locale.weekdaysParse(a,m,h._strict);w!=null?u.d=w:y(h).invalidWeekday=a}),_o(["d","e","E"],function(a,u,h,m){u[m]=ye(a)});function zy(a,u){return typeof a!="string"?a:isNaN(a)?(a=u.weekdaysParse(a),typeof a=="number"?a:null):parseInt(a,10)}function Xy(a,u){return typeof a=="string"?u.weekdaysParse(a)%7||7:isNaN(a)?null:a}function Rl(a,u){return a.slice(u,7).concat(a.slice(0,u))}var Zy="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),wd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Qy="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),ew=wo,tw=wo,rw=wo;function nw(a,u){var h=r(this._weekdays)?this._weekdays:this._weekdays[a&&a!==!0&&this._weekdays.isFormat.test(u)?"format":"standalone"];return a===!0?Rl(h,this._week.dow):a?h[a.day()]:h}function sw(a){return a===!0?Rl(this._weekdaysShort,this._week.dow):a?this._weekdaysShort[a.day()]:this._weekdaysShort}function ow(a){return a===!0?Rl(this._weekdaysMin,this._week.dow):a?this._weekdaysMin[a.day()]:this._weekdaysMin}function iw(a,u,h){var m,w,b,P=a.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],m=0;m<7;++m)b=g([2e3,1]).day(m),this._minWeekdaysParse[m]=this.weekdaysMin(b,"").toLocaleLowerCase(),this._shortWeekdaysParse[m]=this.weekdaysShort(b,"").toLocaleLowerCase(),this._weekdaysParse[m]=this.weekdays(b,"").toLocaleLowerCase();return h?u==="dddd"?(w=qe.call(this._weekdaysParse,P),w!==-1?w:null):u==="ddd"?(w=qe.call(this._shortWeekdaysParse,P),w!==-1?w:null):(w=qe.call(this._minWeekdaysParse,P),w!==-1?w:null):u==="dddd"?(w=qe.call(this._weekdaysParse,P),w!==-1||(w=qe.call(this._shortWeekdaysParse,P),w!==-1)?w:(w=qe.call(this._minWeekdaysParse,P),w!==-1?w:null)):u==="ddd"?(w=qe.call(this._shortWeekdaysParse,P),w!==-1||(w=qe.call(this._weekdaysParse,P),w!==-1)?w:(w=qe.call(this._minWeekdaysParse,P),w!==-1?w:null)):(w=qe.call(this._minWeekdaysParse,P),w!==-1||(w=qe.call(this._weekdaysParse,P),w!==-1)?w:(w=qe.call(this._shortWeekdaysParse,P),w!==-1?w:null))}function aw(a,u,h){var m,w,b;if(this._weekdaysParseExact)return iw.call(this,a,u,h);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),m=0;m<7;m++){if(w=g([2e3,1]).day(m),h&&!this._fullWeekdaysParse[m]&&(this._fullWeekdaysParse[m]=new RegExp("^"+this.weekdays(w,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[m]=new RegExp("^"+this.weekdaysShort(w,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[m]=new RegExp("^"+this.weekdaysMin(w,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[m]||(b="^"+this.weekdays(w,"")+"|^"+this.weekdaysShort(w,"")+"|^"+this.weekdaysMin(w,""),this._weekdaysParse[m]=new RegExp(b.replace(".",""),"i")),h&&u==="dddd"&&this._fullWeekdaysParse[m].test(a))return m;if(h&&u==="ddd"&&this._shortWeekdaysParse[m].test(a))return m;if(h&&u==="dd"&&this._minWeekdaysParse[m].test(a))return m;if(!h&&this._weekdaysParse[m].test(a))return m}}function lw(a){if(!this.isValid())return a!=null?this:NaN;var u=this._isUTC?this._d.getUTCDay():this._d.getDay();return a!=null?(a=zy(a,this.localeData()),this.add(a-u,"d")):u}function cw(a){if(!this.isValid())return a!=null?this:NaN;var u=(this.day()+7-this.localeData()._week.dow)%7;return a==null?u:this.add(a-u,"d")}function uw(a){if(!this.isValid())return a!=null?this:NaN;if(a!=null){var u=Xy(a,this.localeData());return this.day(this.day()%7?u:u-7)}else return this.day()||7}function fw(a){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Pl.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex):(o(this,"_weekdaysRegex")||(this._weekdaysRegex=ew),this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex)}function dw(a){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Pl.call(this),a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(o(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=tw),this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function hw(a){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Pl.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(o(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=rw),this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Pl(){function a(xt,Vr){return Vr.length-xt.length}var u=[],h=[],m=[],w=[],b,P,ee,pe,Fe;for(b=0;b<7;b++)P=g([2e3,1]).day(b),ee=It(this.weekdaysMin(P,"")),pe=It(this.weekdaysShort(P,"")),Fe=It(this.weekdays(P,"")),u.push(ee),h.push(pe),m.push(Fe),w.push(ee),w.push(pe),w.push(Fe);u.sort(a),h.sort(a),m.sort(a),w.sort(a),this._weekdaysRegex=new RegExp("^("+w.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+m.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+u.join("|")+")","i")}function Ol(){return this.hours()%12||12}function pw(){return this.hours()||24}G("H",["HH",2],0,"hour"),G("h",["hh",2],0,Ol),G("k",["kk",2],0,pw),G("hmm",0,0,function(){return""+Ol.apply(this)+ke(this.minutes(),2)}),G("hmmss",0,0,function(){return""+Ol.apply(this)+ke(this.minutes(),2)+ke(this.seconds(),2)}),G("Hmm",0,0,function(){return""+this.hours()+ke(this.minutes(),2)}),G("Hmmss",0,0,function(){return""+this.hours()+ke(this.minutes(),2)+ke(this.seconds(),2)});function _d(a,u){G(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),u)})}_d("a",!0),_d("A",!1),Ze("hour","h"),Ae("hour",13);function bd(a,u){return u._meridiemParse}X("a",bd),X("A",bd),X("H",Ie),X("h",Ie),X("k",Ie),X("HH",Ie,Ot),X("hh",Ie,Ot),X("kk",Ie,Ot),X("hmm",cd),X("hmmss",ud),X("Hmm",cd),X("Hmmss",ud),De(["H","HH"],ot),De(["k","kk"],function(a,u,h){var m=ye(a);u[ot]=m===24?0:m}),De(["a","A"],function(a,u,h){h._isPm=h._locale.isPM(a),h._meridiem=a}),De(["h","hh"],function(a,u,h){u[ot]=ye(a),y(h).bigHour=!0}),De("hmm",function(a,u,h){var m=a.length-2;u[ot]=ye(a.substr(0,m)),u[rr]=ye(a.substr(m)),y(h).bigHour=!0}),De("hmmss",function(a,u,h){var m=a.length-4,w=a.length-2;u[ot]=ye(a.substr(0,m)),u[rr]=ye(a.substr(m,2)),u[Ir]=ye(a.substr(w)),y(h).bigHour=!0}),De("Hmm",function(a,u,h){var m=a.length-2;u[ot]=ye(a.substr(0,m)),u[rr]=ye(a.substr(m))}),De("Hmmss",function(a,u,h){var m=a.length-4,w=a.length-2;u[ot]=ye(a.substr(0,m)),u[rr]=ye(a.substr(m,2)),u[Ir]=ye(a.substr(w))});function mw(a){return(a+"").toLowerCase().charAt(0)==="p"}var gw=/[ap]\.?m?\.?/i,yw=os("Hours",!0);function ww(a,u,h){return a>11?h?"pm":"PM":h?"am":"AM"}var vd={calendar:H,longDateFormat:ns,invalidDate:co,ordinal:fo,dayOfMonthOrdinalParse:ho,relativeTime:mo,months:Ry,monthsShort:fd,week:Yy,weekdays:Zy,weekdaysMin:Qy,weekdaysShort:wd,meridiemParse:gw},Ne={},So={},ko;function _w(a,u){var h,m=Math.min(a.length,u.length);for(h=0;h<m;h+=1)if(a[h]!==u[h])return h;return m}function xd(a){return a&&a.toLowerCase().replace("_","-")}function bw(a){for(var u=0,h,m,w,b;u<a.length;){for(b=xd(a[u]).split("-"),h=b.length,m=xd(a[u+1]),m=m?m.split("-"):null;h>0;){if(w=Fi(b.slice(0,h).join("-")),w)return w;if(m&&m.length>=h&&_w(b,m)>=h-1)break;h--}u++}return ko}function vw(a){return a.match("^[^/\\\\]*$")!=null}function Fi(a){var u=null,h;if(Ne[a]===void 0&&typeof oo!="undefined"&&oo&&oo.exports&&vw(a))try{u=ko._abbr,h=require,h("./locale/"+a),an(u)}catch(m){Ne[a]=null}return Ne[a]}function an(a,u){var h;return a&&(l(u)?h=$r(a):h=Il(a,u),h?ko=h:typeof console!="undefined"&&console.warn&&console.warn("Locale "+a+" not found. Did you forget to load it?")),ko._abbr}function Il(a,u){if(u!==null){var h,m=vd;if(u.abbr=a,Ne[a]!=null)ue("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),m=Ne[a]._config;else if(u.parentLocale!=null)if(Ne[u.parentLocale]!=null)m=Ne[u.parentLocale]._config;else if(h=Fi(u.parentLocale),h!=null)m=h._config;else return So[u.parentLocale]||(So[u.parentLocale]=[]),So[u.parentLocale].push({name:a,config:u}),null;return Ne[a]=new $(be(m,u)),So[a]&&So[a].forEach(function(w){Il(w.name,w.config)}),an(a),Ne[a]}else return delete Ne[a],null}function xw(a,u){if(u!=null){var h,m,w=vd;Ne[a]!=null&&Ne[a].parentLocale!=null?Ne[a].set(be(Ne[a]._config,u)):(m=Fi(a),m!=null&&(w=m._config),u=be(w,u),m==null&&(u.abbr=a),h=new $(u),h.parentLocale=Ne[a],Ne[a]=h),an(a)}else Ne[a]!=null&&(Ne[a].parentLocale!=null?(Ne[a]=Ne[a].parentLocale,a===an()&&an(a)):Ne[a]!=null&&delete Ne[a]);return Ne[a]}function $r(a){var u;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return ko;if(!r(a)){if(u=Fi(a),u)return u;a=[a]}return bw(a)}function Sw(){return j(Ne)}function Ll(a){var u,h=a._a;return h&&y(a).overflow===-2&&(u=h[Or]<0||h[Or]>11?Or:h[_r]<1||h[_r]>Ai(h[_t],h[Or])?_r:h[ot]<0||h[ot]>24||h[ot]===24&&(h[rr]!==0||h[Ir]!==0||h[Dn]!==0)?ot:h[rr]<0||h[rr]>59?rr:h[Ir]<0||h[Ir]>59?Ir:h[Dn]<0||h[Dn]>999?Dn:-1,y(a)._overflowDayOfYear&&(u<_t||u>_r)&&(u=_r),y(a)._overflowWeeks&&u===-1&&(u=Dy),y(a)._overflowWeekday&&u===-1&&(u=Fy),y(a).overflow=u),a}var kw=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Cw=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ew=/Z|[+-]\d\d(?::?\d\d)?/,Mi=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],$l=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Tw=/^\/?Date\((-?\d+)/i,Aw=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Dw={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Sd(a){var u,h,m=a._i,w=kw.exec(m)||Cw.exec(m),b,P,ee,pe,Fe=Mi.length,xt=$l.length;if(w){for(y(a).iso=!0,u=0,h=Fe;u<h;u++)if(Mi[u][1].exec(w[1])){P=Mi[u][0],b=Mi[u][2]!==!1;break}if(P==null){a._isValid=!1;return}if(w[3]){for(u=0,h=xt;u<h;u++)if($l[u][1].exec(w[3])){ee=(w[2]||" ")+$l[u][0];break}if(ee==null){a._isValid=!1;return}}if(!b&&ee!=null){a._isValid=!1;return}if(w[4])if(Ew.exec(w[4]))pe="Z";else{a._isValid=!1;return}a._f=P+(ee||"")+(pe||""),Nl(a)}else a._isValid=!1}function Fw(a,u,h,m,w,b){var P=[Mw(a),fd.indexOf(u),parseInt(h,10),parseInt(m,10),parseInt(w,10)];return b&&P.push(parseInt(b,10)),P}function Mw(a){var u=parseInt(a,10);return u<=49?2e3+u:u<=999?1900+u:u}function Rw(a){return a.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Pw(a,u,h){if(a){var m=wd.indexOf(a),w=new Date(u[0],u[1],u[2]).getDay();if(m!==w)return y(h).weekdayMismatch=!0,h._isValid=!1,!1}return!0}function Ow(a,u,h){if(a)return Dw[a];if(u)return 0;var m=parseInt(h,10),w=m%100,b=(m-w)/100;return b*60+w}function kd(a){var u=Aw.exec(Rw(a._i)),h;if(u){if(h=Fw(u[4],u[3],u[2],u[5],u[6],u[7]),!Pw(u[1],h,a))return;a._a=h,a._tzm=Ow(u[8],u[9],u[10]),a._d=vo.apply(null,a._a),a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),y(a).rfc2822=!0}else a._isValid=!1}function Iw(a){var u=Tw.exec(a._i);if(u!==null){a._d=new Date(+u[1]);return}if(Sd(a),a._isValid===!1)delete a._isValid;else return;if(kd(a),a._isValid===!1)delete a._isValid;else return;a._strict?a._isValid=!1:e.createFromInputFallback(a)}e.createFromInputFallback=I("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))});function as(a,u,h){return a!=null?a:u!=null?u:h}function Lw(a){var u=new Date(e.now());return a._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()]}function Ul(a){var u,h,m=[],w,b,P;if(!a._d){for(w=Lw(a),a._w&&a._a[_r]==null&&a._a[Or]==null&&$w(a),a._dayOfYear!=null&&(P=as(a._a[_t],w[_t]),(a._dayOfYear>bo(P)||a._dayOfYear===0)&&(y(a)._overflowDayOfYear=!0),h=vo(P,0,a._dayOfYear),a._a[Or]=h.getUTCMonth(),a._a[_r]=h.getUTCDate()),u=0;u<3&&a._a[u]==null;++u)a._a[u]=m[u]=w[u];for(;u<7;u++)a._a[u]=m[u]=a._a[u]==null?u===2?1:0:a._a[u];a._a[ot]===24&&a._a[rr]===0&&a._a[Ir]===0&&a._a[Dn]===0&&(a._nextDay=!0,a._a[ot]=0),a._d=(a._useUTC?vo:Wy).apply(null,m),b=a._useUTC?a._d.getUTCDay():a._d.getDay(),a._tzm!=null&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[ot]=24),a._w&&typeof a._w.d!="undefined"&&a._w.d!==b&&(y(a).weekdayMismatch=!0)}}function $w(a){var u,h,m,w,b,P,ee,pe,Fe;u=a._w,u.GG!=null||u.W!=null||u.E!=null?(b=1,P=4,h=as(u.GG,a._a[_t],xo(Le(),1,4).year),m=as(u.W,1),w=as(u.E,1),(w<1||w>7)&&(pe=!0)):(b=a._locale._week.dow,P=a._locale._week.doy,Fe=xo(Le(),b,P),h=as(u.gg,a._a[_t],Fe.year),m=as(u.w,Fe.week),u.d!=null?(w=u.d,(w<0||w>6)&&(pe=!0)):u.e!=null?(w=u.e+b,(u.e<0||u.e>6)&&(pe=!0)):w=b),m<1||m>Lr(h,b,P)?y(a)._overflowWeeks=!0:pe!=null?y(a)._overflowWeekday=!0:(ee=yd(h,m,w,b,P),a._a[_t]=ee.year,a._dayOfYear=ee.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function Nl(a){if(a._f===e.ISO_8601){Sd(a);return}if(a._f===e.RFC_2822){kd(a);return}a._a=[],y(a).empty=!0;var u=""+a._i,h,m,w,b,P,ee=u.length,pe=0,Fe,xt;for(w=rs(a._f,a._locale).match(vt)||[],xt=w.length,h=0;h<xt;h++)b=w[h],m=(u.match(Ey(b,a))||[])[0],m&&(P=u.substr(0,u.indexOf(m)),P.length>0&&y(a).unusedInput.push(P),u=u.slice(u.indexOf(m)+m.length),pe+=m.length),le[b]?(m?y(a).empty=!1:y(a).unusedTokens.push(b),Ay(b,m,a)):a._strict&&!m&&y(a).unusedTokens.push(b);y(a).charsLeftOver=ee-pe,u.length>0&&y(a).unusedInput.push(u),a._a[ot]<=12&&y(a).bigHour===!0&&a._a[ot]>0&&(y(a).bigHour=void 0),y(a).parsedDateParts=a._a.slice(0),y(a).meridiem=a._meridiem,a._a[ot]=Uw(a._locale,a._a[ot],a._meridiem),Fe=y(a).era,Fe!==null&&(a._a[_t]=a._locale.erasConvertYear(Fe,a._a[_t])),Ul(a),Ll(a)}function Uw(a,u,h){var m;return h==null?u:a.meridiemHour!=null?a.meridiemHour(u,h):(a.isPM!=null&&(m=a.isPM(h),m&&u<12&&(u+=12),!m&&u===12&&(u=0)),u)}function Nw(a){var u,h,m,w,b,P,ee=!1,pe=a._f.length;if(pe===0){y(a).invalidFormat=!0,a._d=new Date(NaN);return}for(w=0;w<pe;w++)b=0,P=!1,u=S({},a),a._useUTC!=null&&(u._useUTC=a._useUTC),u._f=a._f[w],Nl(u),C(u)&&(P=!0),b+=y(u).charsLeftOver,b+=y(u).unusedTokens.length*10,y(u).score=b,ee?b<m&&(m=b,h=u):(m==null||b<m||P)&&(m=b,h=u,P&&(ee=!0));p(a,h||u)}function Bw(a){if(!a._d){var u=de(a._i),h=u.day===void 0?u.date:u.day;a._a=d([u.year,u.month,h,u.hour,u.minute,u.second,u.millisecond],function(m){return m&&parseInt(m,10)}),Ul(a)}}function Vw(a){var u=new M(Ll(Cd(a)));return u._nextDay&&(u.add(1,"d"),u._nextDay=void 0),u}function Cd(a){var u=a._i,h=a._f;return a._locale=a._locale||$r(a._l),u===null||h===void 0&&u===""?v({nullInput:!0}):(typeof u=="string"&&(a._i=u=a._locale.preparse(u)),O(u)?new M(Ll(u)):(f(u)?a._d=u:r(h)?Nw(a):h?Nl(a):Hw(a),C(a)||(a._d=null),a))}function Hw(a){var u=a._i;l(u)?a._d=new Date(e.now()):f(u)?a._d=new Date(u.valueOf()):typeof u=="string"?Iw(a):r(u)?(a._a=d(u.slice(0),function(h){return parseInt(h,10)}),Ul(a)):s(u)?Bw(a):c(u)?a._d=new Date(u):e.createFromInputFallback(a)}function Ed(a,u,h,m,w){var b={};return(u===!0||u===!1)&&(m=u,u=void 0),(h===!0||h===!1)&&(m=h,h=void 0),(s(a)&&i(a)||r(a)&&a.length===0)&&(a=void 0),b._isAMomentObject=!0,b._useUTC=b._isUTC=w,b._l=h,b._i=a,b._f=u,b._strict=m,Vw(b)}function Le(a,u,h,m){return Ed(a,u,h,m,!1)}var Ww=I("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=Le.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:v()}),Kw=I("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=Le.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:a:v()});function Td(a,u){var h,m;if(u.length===1&&r(u[0])&&(u=u[0]),!u.length)return Le();for(h=u[0],m=1;m<u.length;++m)(!u[m].isValid()||u[m][a](h))&&(h=u[m]);return h}function Yw(){var a=[].slice.call(arguments,0);return Td("isBefore",a)}function Jw(){var a=[].slice.call(arguments,0);return Td("isAfter",a)}var qw=function(){return Date.now?Date.now():+new Date},Co=["year","quarter","month","week","day","hour","minute","second","millisecond"];function jw(a){var u,h=!1,m,w=Co.length;for(u in a)if(o(a,u)&&!(qe.call(Co,u)!==-1&&(a[u]==null||!isNaN(a[u]))))return!1;for(m=0;m<w;++m)if(a[Co[m]]){if(h)return!1;parseFloat(a[Co[m]])!==ye(a[Co[m]])&&(h=!0)}return!0}function Gw(){return this._isValid}function zw(){return nr(NaN)}function Ri(a){var u=de(a),h=u.year||0,m=u.quarter||0,w=u.month||0,b=u.week||u.isoWeek||0,P=u.day||0,ee=u.hour||0,pe=u.minute||0,Fe=u.second||0,xt=u.millisecond||0;this._isValid=jw(u),this._milliseconds=+xt+Fe*1e3+pe*6e4+ee*1e3*60*60,this._days=+P+b*7,this._months=+w+m*3+h*12,this._data={},this._locale=$r(),this._bubble()}function Pi(a){return a instanceof Ri}function Bl(a){return a<0?Math.round(-1*a)*-1:Math.round(a)}function Xw(a,u,h){var m=Math.min(a.length,u.length),w=Math.abs(a.length-u.length),b=0,P;for(P=0;P<m;P++)(h&&a[P]!==u[P]||!h&&ye(a[P])!==ye(u[P]))&&b++;return b+w}function Ad(a,u){G(a,0,0,function(){var h=this.utcOffset(),m="+";return h<0&&(h=-h,m="-"),m+ke(~~(h/60),2)+u+ke(~~h%60,2)})}Ad("Z",":"),Ad("ZZ",""),X("Z",Ei),X("ZZ",Ei),De(["Z","ZZ"],function(a,u,h){h._useUTC=!0,h._tzm=Vl(Ei,a)});var Zw=/([\+\-]|\d\d)/gi;function Vl(a,u){var h=(u||"").match(a),m,w,b;return h===null?null:(m=h[h.length-1]||[],w=(m+"").match(Zw)||["-",0,0],b=+(w[1]*60)+ye(w[2]),b===0?0:w[0]==="+"?b:-b)}function Hl(a,u){var h,m;return u._isUTC?(h=u.clone(),m=(O(a)||f(a)?a.valueOf():Le(a).valueOf())-h.valueOf(),h._d.setTime(h._d.valueOf()+m),e.updateOffset(h,!1),h):Le(a).local()}function Wl(a){return-Math.round(a._d.getTimezoneOffset())}e.updateOffset=function(){};function Qw(a,u,h){var m=this._offset||0,w;if(!this.isValid())return a!=null?this:NaN;if(a!=null){if(typeof a=="string"){if(a=Vl(Ei,a),a===null)return this}else Math.abs(a)<16&&!h&&(a=a*60);return!this._isUTC&&u&&(w=Wl(this)),this._offset=a,this._isUTC=!0,w!=null&&this.add(w,"m"),m!==a&&(!u||this._changeInProgress?Rd(this,nr(a-m,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?m:Wl(this)}function e_(a,u){return a!=null?(typeof a!="string"&&(a=-a),this.utcOffset(a,u),this):-this.utcOffset()}function t_(a){return this.utcOffset(0,a)}function r_(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Wl(this),"m")),this}function n_(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var a=Vl(ky,this._i);a!=null?this.utcOffset(a):this.utcOffset(0,!0)}return this}function s_(a){return this.isValid()?(a=a?Le(a).utcOffset():0,(this.utcOffset()-a)%60===0):!1}function o_(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function i_(){if(!l(this._isDSTShifted))return this._isDSTShifted;var a={},u;return S(a,this),a=Cd(a),a._a?(u=a._isUTC?g(a._a):Le(a._a),this._isDSTShifted=this.isValid()&&Xw(a._a,u.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function a_(){return this.isValid()?!this._isUTC:!1}function l_(){return this.isValid()?this._isUTC:!1}function Dd(){return this.isValid()?this._isUTC&&this._offset===0:!1}var c_=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,u_=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function nr(a,u){var h=a,m=null,w,b,P;return Pi(a)?h={ms:a._milliseconds,d:a._days,M:a._months}:c(a)||!isNaN(+a)?(h={},u?h[u]=+a:h.milliseconds=+a):(m=c_.exec(a))?(w=m[1]==="-"?-1:1,h={y:0,d:ye(m[_r])*w,h:ye(m[ot])*w,m:ye(m[rr])*w,s:ye(m[Ir])*w,ms:ye(Bl(m[Dn]*1e3))*w}):(m=u_.exec(a))?(w=m[1]==="-"?-1:1,h={y:Fn(m[2],w),M:Fn(m[3],w),w:Fn(m[4],w),d:Fn(m[5],w),h:Fn(m[6],w),m:Fn(m[7],w),s:Fn(m[8],w)}):h==null?h={}:typeof h=="object"&&("from"in h||"to"in h)&&(P=f_(Le(h.from),Le(h.to)),h={},h.ms=P.milliseconds,h.M=P.months),b=new Ri(h),Pi(a)&&o(a,"_locale")&&(b._locale=a._locale),Pi(a)&&o(a,"_isValid")&&(b._isValid=a._isValid),b}nr.fn=Ri.prototype,nr.invalid=zw;function Fn(a,u){var h=a&&parseFloat(a.replace(",","."));return(isNaN(h)?0:h)*u}function Fd(a,u){var h={};return h.months=u.month()-a.month()+(u.year()-a.year())*12,a.clone().add(h.months,"M").isAfter(u)&&--h.months,h.milliseconds=+u-+a.clone().add(h.months,"M"),h}function f_(a,u){var h;return a.isValid()&&u.isValid()?(u=Hl(u,a),a.isBefore(u)?h=Fd(a,u):(h=Fd(u,a),h.milliseconds=-h.milliseconds,h.months=-h.months),h):{milliseconds:0,months:0}}function Md(a,u){return function(h,m){var w,b;return m!==null&&!isNaN(+m)&&(ue(u,"moment()."+u+"(period, number) is deprecated. Please use moment()."+u+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),b=h,h=m,m=b),w=nr(h,m),Rd(this,w,a),this}}function Rd(a,u,h,m){var w=u._milliseconds,b=Bl(u._days),P=Bl(u._months);a.isValid()&&(m=m==null?!0:m,P&&hd(a,vi(a,"Month")+P*h),b&&id(a,"Date",vi(a,"Date")+b*h),w&&a._d.setTime(a._d.valueOf()+w*h),m&&e.updateOffset(a,b||P))}var d_=Md(1,"add"),h_=Md(-1,"subtract");function Pd(a){return typeof a=="string"||a instanceof String}function p_(a){return O(a)||f(a)||Pd(a)||c(a)||g_(a)||m_(a)||a===null||a===void 0}function m_(a){var u=s(a)&&!i(a),h=!1,m=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],w,b,P=m.length;for(w=0;w<P;w+=1)b=m[w],h=h||o(a,b);return u&&h}function g_(a){var u=r(a),h=!1;return u&&(h=a.filter(function(m){return!c(m)&&Pd(a)}).length===0),u&&h}function y_(a){var u=s(a)&&!i(a),h=!1,m=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],w,b;for(w=0;w<m.length;w+=1)b=m[w],h=h||o(a,b);return u&&h}function w_(a,u){var h=a.diff(u,"days",!0);return h<-6?"sameElse":h<-1?"lastWeek":h<0?"lastDay":h<1?"sameDay":h<2?"nextDay":h<7?"nextWeek":"sameElse"}function __(a,u){arguments.length===1&&(arguments[0]?p_(arguments[0])?(a=arguments[0],u=void 0):y_(arguments[0])&&(u=arguments[0],a=void 0):(a=void 0,u=void 0));var h=a||Le(),m=Hl(h,this).startOf("day"),w=e.calendarFormat(this,m)||"sameElse",b=u&&(se(u[w])?u[w].call(this,h):u[w]);return this.format(b||this.localeData().calendar(w,this,Le(h)))}function b_(){return new M(this)}function v_(a,u){var h=O(a)?a:Le(a);return this.isValid()&&h.isValid()?(u=R(u)||"millisecond",u==="millisecond"?this.valueOf()>h.valueOf():h.valueOf()<this.clone().startOf(u).valueOf()):!1}function x_(a,u){var h=O(a)?a:Le(a);return this.isValid()&&h.isValid()?(u=R(u)||"millisecond",u==="millisecond"?this.valueOf()<h.valueOf():this.clone().endOf(u).valueOf()<h.valueOf()):!1}function S_(a,u,h,m){var w=O(a)?a:Le(a),b=O(u)?u:Le(u);return this.isValid()&&w.isValid()&&b.isValid()?(m=m||"()",(m[0]==="("?this.isAfter(w,h):!this.isBefore(w,h))&&(m[1]===")"?this.isBefore(b,h):!this.isAfter(b,h))):!1}function k_(a,u){var h=O(a)?a:Le(a),m;return this.isValid()&&h.isValid()?(u=R(u)||"millisecond",u==="millisecond"?this.valueOf()===h.valueOf():(m=h.valueOf(),this.clone().startOf(u).valueOf()<=m&&m<=this.clone().endOf(u).valueOf())):!1}function C_(a,u){return this.isSame(a,u)||this.isAfter(a,u)}function E_(a,u){return this.isSame(a,u)||this.isBefore(a,u)}function T_(a,u,h){var m,w,b;if(!this.isValid())return NaN;if(m=Hl(a,this),!m.isValid())return NaN;switch(w=(m.utcOffset()-this.utcOffset())*6e4,u=R(u),u){case"year":b=Oi(this,m)/12;break;case"month":b=Oi(this,m);break;case"quarter":b=Oi(this,m)/3;break;case"second":b=(this-m)/1e3;break;case"minute":b=(this-m)/6e4;break;case"hour":b=(this-m)/36e5;break;case"day":b=(this-m-w)/864e5;break;case"week":b=(this-m-w)/6048e5;break;default:b=this-m}return h?b:wt(b)}function Oi(a,u){if(a.date()<u.date())return-Oi(u,a);var h=(u.year()-a.year())*12+(u.month()-a.month()),m=a.clone().add(h,"months"),w,b;return u-m<0?(w=a.clone().add(h-1,"months"),b=(u-m)/(m-w)):(w=a.clone().add(h+1,"months"),b=(u-m)/(w-m)),-(h+b)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function A_(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function D_(a){if(!this.isValid())return null;var u=a!==!0,h=u?this.clone().utc():this;return h.year()<0||h.year()>9999?Rr(h,u?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):se(Date.prototype.toISOString)?u?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Rr(h,"Z")):Rr(h,u?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function F_(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var a="moment",u="",h,m,w,b;return this.isLocal()||(a=this.utcOffset()===0?"moment.utc":"moment.parseZone",u="Z"),h="["+a+'("]',m=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",w="-MM-DD[T]HH:mm:ss.SSS",b=u+'[")]',this.format(h+m+w+b)}function M_(a){a||(a=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var u=Rr(this,a);return this.localeData().postformat(u)}function R_(a,u){return this.isValid()&&(O(a)&&a.isValid()||Le(a).isValid())?nr({to:this,from:a}).locale(this.locale()).humanize(!u):this.localeData().invalidDate()}function P_(a){return this.from(Le(),a)}function O_(a,u){return this.isValid()&&(O(a)&&a.isValid()||Le(a).isValid())?nr({from:this,to:a}).locale(this.locale()).humanize(!u):this.localeData().invalidDate()}function I_(a){return this.to(Le(),a)}function Od(a){var u;return a===void 0?this._locale._abbr:(u=$r(a),u!=null&&(this._locale=u),this)}var Id=I("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return a===void 0?this.localeData():this.locale(a)});function Ld(){return this._locale}var Ii=1e3,ls=60*Ii,Li=60*ls,$d=(365*400+97)*24*Li;function cs(a,u){return(a%u+u)%u}function Ud(a,u,h){return a<100&&a>=0?new Date(a+400,u,h)-$d:new Date(a,u,h).valueOf()}function Nd(a,u,h){return a<100&&a>=0?Date.UTC(a+400,u,h)-$d:Date.UTC(a,u,h)}function L_(a){var u,h;if(a=R(a),a===void 0||a==="millisecond"||!this.isValid())return this;switch(h=this._isUTC?Nd:Ud,a){case"year":u=h(this.year(),0,1);break;case"quarter":u=h(this.year(),this.month()-this.month()%3,1);break;case"month":u=h(this.year(),this.month(),1);break;case"week":u=h(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":u=h(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":u=h(this.year(),this.month(),this.date());break;case"hour":u=this._d.valueOf(),u-=cs(u+(this._isUTC?0:this.utcOffset()*ls),Li);break;case"minute":u=this._d.valueOf(),u-=cs(u,ls);break;case"second":u=this._d.valueOf(),u-=cs(u,Ii);break}return this._d.setTime(u),e.updateOffset(this,!0),this}function $_(a){var u,h;if(a=R(a),a===void 0||a==="millisecond"||!this.isValid())return this;switch(h=this._isUTC?Nd:Ud,a){case"year":u=h(this.year()+1,0,1)-1;break;case"quarter":u=h(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":u=h(this.year(),this.month()+1,1)-1;break;case"week":u=h(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":u=h(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":u=h(this.year(),this.month(),this.date()+1)-1;break;case"hour":u=this._d.valueOf(),u+=Li-cs(u+(this._isUTC?0:this.utcOffset()*ls),Li)-1;break;case"minute":u=this._d.valueOf(),u+=ls-cs(u,ls)-1;break;case"second":u=this._d.valueOf(),u+=Ii-cs(u,Ii)-1;break}return this._d.setTime(u),e.updateOffset(this,!0),this}function U_(){return this._d.valueOf()-(this._offset||0)*6e4}function N_(){return Math.floor(this.valueOf()/1e3)}function B_(){return new Date(this.valueOf())}function V_(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function H_(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function W_(){return this.isValid()?this.toISOString():null}function K_(){return C(this)}function Y_(){return p({},y(this))}function J_(){return y(this).overflow}function q_(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}G("N",0,0,"eraAbbr"),G("NN",0,0,"eraAbbr"),G("NNN",0,0,"eraAbbr"),G("NNNN",0,0,"eraName"),G("NNNNN",0,0,"eraNarrow"),G("y",["y",1],"yo","eraYear"),G("y",["yy",2],0,"eraYear"),G("y",["yyy",3],0,"eraYear"),G("y",["yyyy",4],0,"eraYear"),X("N",Kl),X("NN",Kl),X("NNN",Kl),X("NNNN",sb),X("NNNNN",ob),De(["N","NN","NNN","NNNN","NNNNN"],function(a,u,h,m){var w=h._locale.erasParse(a,m,h._strict);w?y(h).era=w:y(h).invalidEra=a}),X("y",is),X("yy",is),X("yyy",is),X("yyyy",is),X("yo",ib),De(["y","yy","yyy","yyyy"],_t),De(["yo"],function(a,u,h,m){var w;h._locale._eraYearOrdinalRegex&&(w=a.match(h._locale._eraYearOrdinalRegex)),h._locale.eraYearOrdinalParse?u[_t]=h._locale.eraYearOrdinalParse(a,w):u[_t]=parseInt(a,10)});function j_(a,u){var h,m,w,b=this._eras||$r("en")._eras;for(h=0,m=b.length;h<m;++h){switch(typeof b[h].since){case"string":w=e(b[h].since).startOf("day"),b[h].since=w.valueOf();break}switch(typeof b[h].until){case"undefined":b[h].until=1/0;break;case"string":w=e(b[h].until).startOf("day").valueOf(),b[h].until=w.valueOf();break}}return b}function G_(a,u,h){var m,w,b=this.eras(),P,ee,pe;for(a=a.toUpperCase(),m=0,w=b.length;m<w;++m)if(P=b[m].name.toUpperCase(),ee=b[m].abbr.toUpperCase(),pe=b[m].narrow.toUpperCase(),h)switch(u){case"N":case"NN":case"NNN":if(ee===a)return b[m];break;case"NNNN":if(P===a)return b[m];break;case"NNNNN":if(pe===a)return b[m];break}else if([P,ee,pe].indexOf(a)>=0)return b[m]}function z_(a,u){var h=a.since<=a.until?1:-1;return u===void 0?e(a.since).year():e(a.since).year()+(u-a.offset)*h}function X_(){var a,u,h,m=this.localeData().eras();for(a=0,u=m.length;a<u;++a)if(h=this.clone().startOf("day").valueOf(),m[a].since<=h&&h<=m[a].until||m[a].until<=h&&h<=m[a].since)return m[a].name;return""}function Z_(){var a,u,h,m=this.localeData().eras();for(a=0,u=m.length;a<u;++a)if(h=this.clone().startOf("day").valueOf(),m[a].since<=h&&h<=m[a].until||m[a].until<=h&&h<=m[a].since)return m[a].narrow;return""}function Q_(){var a,u,h,m=this.localeData().eras();for(a=0,u=m.length;a<u;++a)if(h=this.clone().startOf("day").valueOf(),m[a].since<=h&&h<=m[a].until||m[a].until<=h&&h<=m[a].since)return m[a].abbr;return""}function eb(){var a,u,h,m,w=this.localeData().eras();for(a=0,u=w.length;a<u;++a)if(h=w[a].since<=w[a].until?1:-1,m=this.clone().startOf("day").valueOf(),w[a].since<=m&&m<=w[a].until||w[a].until<=m&&m<=w[a].since)return(this.year()-e(w[a].since).year())*h+w[a].offset;return this.year()}function tb(a){return o(this,"_erasNameRegex")||Yl.call(this),a?this._erasNameRegex:this._erasRegex}function rb(a){return o(this,"_erasAbbrRegex")||Yl.call(this),a?this._erasAbbrRegex:this._erasRegex}function nb(a){return o(this,"_erasNarrowRegex")||Yl.call(this),a?this._erasNarrowRegex:this._erasRegex}function Kl(a,u){return u.erasAbbrRegex(a)}function sb(a,u){return u.erasNameRegex(a)}function ob(a,u){return u.erasNarrowRegex(a)}function ib(a,u){return u._eraYearOrdinalRegex||is}function Yl(){var a=[],u=[],h=[],m=[],w,b,P=this.eras();for(w=0,b=P.length;w<b;++w)u.push(It(P[w].name)),a.push(It(P[w].abbr)),h.push(It(P[w].narrow)),m.push(It(P[w].name)),m.push(It(P[w].abbr)),m.push(It(P[w].narrow));this._erasRegex=new RegExp("^("+m.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+u.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+h.join("|")+")","i")}G(0,["gg",2],0,function(){return this.weekYear()%100}),G(0,["GG",2],0,function(){return this.isoWeekYear()%100});function $i(a,u){G(0,[a,a.length],0,u)}$i("gggg","weekYear"),$i("ggggg","weekYear"),$i("GGGG","isoWeekYear"),$i("GGGGG","isoWeekYear"),Ze("weekYear","gg"),Ze("isoWeekYear","GG"),Ae("weekYear",1),Ae("isoWeekYear",1),X("G",Ci),X("g",Ci),X("GG",Ie,Ot),X("gg",Ie,Ot),X("GGGG",Fl,Dl),X("gggg",Fl,Dl),X("GGGGG",ki,xi),X("ggggg",ki,xi),_o(["gggg","ggggg","GGGG","GGGGG"],function(a,u,h,m){u[m.substr(0,2)]=ye(a)}),_o(["gg","GG"],function(a,u,h,m){u[m]=e.parseTwoDigitYear(a)});function ab(a){return Bd.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function lb(a){return Bd.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)}function cb(){return Lr(this.year(),1,4)}function ub(){return Lr(this.isoWeekYear(),1,4)}function fb(){var a=this.localeData()._week;return Lr(this.year(),a.dow,a.doy)}function db(){var a=this.localeData()._week;return Lr(this.weekYear(),a.dow,a.doy)}function Bd(a,u,h,m,w){var b;return a==null?xo(this,m,w).year:(b=Lr(a,m,w),u>b&&(u=b),hb.call(this,a,u,h,m,w))}function hb(a,u,h,m,w){var b=yd(a,u,h,m,w),P=vo(b.year,0,b.dayOfYear);return this.year(P.getUTCFullYear()),this.month(P.getUTCMonth()),this.date(P.getUTCDate()),this}G("Q",0,"Qo","quarter"),Ze("quarter","Q"),Ae("quarter",7),X("Q",ad),De("Q",function(a,u){u[Or]=(ye(a)-1)*3});function pb(a){return a==null?Math.ceil((this.month()+1)/3):this.month((a-1)*3+this.month()%3)}G("D",["DD",2],"Do","date"),Ze("date","D"),Ae("date",9),X("D",Ie),X("DD",Ie,Ot),X("Do",function(a,u){return a?u._dayOfMonthOrdinalParse||u._ordinalParse:u._dayOfMonthOrdinalParseLenient}),De(["D","DD"],_r),De("Do",function(a,u){u[_r]=ye(a.match(Ie)[0])});var Vd=os("Date",!0);G("DDD",["DDDD",3],"DDDo","dayOfYear"),Ze("dayOfYear","DDD"),Ae("dayOfYear",4),X("DDD",Si),X("DDDD",ld),De(["DDD","DDDD"],function(a,u,h){h._dayOfYear=ye(a)});function mb(a){var u=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return a==null?u:this.add(a-u,"d")}G("m",["mm",2],0,"minute"),Ze("minute","m"),Ae("minute",14),X("m",Ie),X("mm",Ie,Ot),De(["m","mm"],rr);var gb=os("Minutes",!1);G("s",["ss",2],0,"second"),Ze("second","s"),Ae("second",15),X("s",Ie),X("ss",Ie,Ot),De(["s","ss"],Ir);var yb=os("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)}),G(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),G(0,["SSS",3],0,"millisecond"),G(0,["SSSS",4],0,function(){return this.millisecond()*10}),G(0,["SSSSS",5],0,function(){return this.millisecond()*100}),G(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),G(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),G(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),G(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),Ze("millisecond","ms"),Ae("millisecond",16),X("S",Si,ad),X("SS",Si,Ot),X("SSS",Si,ld);var ln,Hd;for(ln="SSSS";ln.length<=9;ln+="S")X(ln,is);function wb(a,u){u[Dn]=ye(("0."+a)*1e3)}for(ln="S";ln.length<=9;ln+="S")De(ln,wb);Hd=os("Milliseconds",!1),G("z",0,0,"zoneAbbr"),G("zz",0,0,"zoneName");function _b(){return this._isUTC?"UTC":""}function bb(){return this._isUTC?"Coordinated Universal Time":""}var K=M.prototype;K.add=d_,K.calendar=__,K.clone=b_,K.diff=T_,K.endOf=$_,K.format=M_,K.from=R_,K.fromNow=P_,K.to=O_,K.toNow=I_,K.get=xy,K.invalidAt=J_,K.isAfter=v_,K.isBefore=x_,K.isBetween=S_,K.isSame=k_,K.isSameOrAfter=C_,K.isSameOrBefore=E_,K.isValid=K_,K.lang=Id,K.locale=Od,K.localeData=Ld,K.max=Kw,K.min=Ww,K.parsingFlags=Y_,K.set=Sy,K.startOf=L_,K.subtract=h_,K.toArray=V_,K.toObject=H_,K.toDate=B_,K.toISOString=D_,K.inspect=F_,typeof Symbol!="undefined"&&Symbol.for!=null&&(K[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),K.toJSON=W_,K.toString=A_,K.unix=N_,K.valueOf=U_,K.creationData=q_,K.eraName=X_,K.eraNarrow=Z_,K.eraAbbr=Q_,K.eraYear=eb,K.year=gd,K.isLeapYear=Hy,K.weekYear=ab,K.isoWeekYear=lb,K.quarter=K.quarters=pb,K.month=pd,K.daysInMonth=Ny,K.week=K.weeks=jy,K.isoWeek=K.isoWeeks=Gy,K.weeksInYear=fb,K.weeksInWeekYear=db,K.isoWeeksInYear=cb,K.isoWeeksInISOWeekYear=ub,K.date=Vd,K.day=K.days=lw,K.weekday=cw,K.isoWeekday=uw,K.dayOfYear=mb,K.hour=K.hours=yw,K.minute=K.minutes=gb,K.second=K.seconds=yb,K.millisecond=K.milliseconds=Hd,K.utcOffset=Qw,K.utc=t_,K.local=r_,K.parseZone=n_,K.hasAlignedHourOffset=s_,K.isDST=o_,K.isLocal=a_,K.isUtcOffset=l_,K.isUtc=Dd,K.isUTC=Dd,K.zoneAbbr=_b,K.zoneName=bb,K.dates=I("dates accessor is deprecated. Use date instead.",Vd),K.months=I("months accessor is deprecated. Use month instead",pd),K.years=I("years accessor is deprecated. Use year instead",gd),K.zone=I("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",e_),K.isDSTShifted=I("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",i_);function vb(a){return Le(a*1e3)}function xb(){return Le.apply(null,arguments).parseZone()}function Wd(a){return a}var Ce=$.prototype;Ce.calendar=z,Ce.longDateFormat=lo,Ce.invalidDate=uo,Ce.ordinal=po,Ce.preparse=Wd,Ce.postformat=Wd,Ce.relativeTime=go,Ce.pastFuture=yo,Ce.set=ge,Ce.eras=j_,Ce.erasParse=G_,Ce.erasConvertYear=z_,Ce.erasAbbrRegex=rb,Ce.erasNameRegex=tb,Ce.erasNarrowRegex=nb,Ce.months=Iy,Ce.monthsShort=Ly,Ce.monthsParse=Uy,Ce.monthsRegex=Vy,Ce.monthsShortRegex=By,Ce.week=Ky,Ce.firstDayOfYear=qy,Ce.firstDayOfWeek=Jy,Ce.weekdays=nw,Ce.weekdaysMin=ow,Ce.weekdaysShort=sw,Ce.weekdaysParse=aw,Ce.weekdaysRegex=fw,Ce.weekdaysShortRegex=dw,Ce.weekdaysMinRegex=hw,Ce.isPM=mw,Ce.meridiem=ww;function Ui(a,u,h,m){var w=$r(),b=g().set(m,u);return w[h](b,a)}function Kd(a,u,h){if(c(a)&&(u=a,a=void 0),a=a||"",u!=null)return Ui(a,u,h,"month");var m,w=[];for(m=0;m<12;m++)w[m]=Ui(a,m,h,"month");return w}function Jl(a,u,h,m){typeof a=="boolean"?(c(u)&&(h=u,u=void 0),u=u||""):(u=a,h=u,a=!1,c(u)&&(h=u,u=void 0),u=u||"");var w=$r(),b=a?w._week.dow:0,P,ee=[];if(h!=null)return Ui(u,(h+b)%7,m,"day");for(P=0;P<7;P++)ee[P]=Ui(u,(P+b)%7,m,"day");return ee}function Sb(a,u){return Kd(a,u,"months")}function kb(a,u){return Kd(a,u,"monthsShort")}function Cb(a,u,h){return Jl(a,u,h,"weekdays")}function Eb(a,u,h){return Jl(a,u,h,"weekdaysShort")}function Tb(a,u,h){return Jl(a,u,h,"weekdaysMin")}an("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var u=a%10,h=ye(a%100/10)===1?"th":u===1?"st":u===2?"nd":u===3?"rd":"th";return a+h}}),e.lang=I("moment.lang is deprecated. Use moment.locale instead.",an),e.langData=I("moment.langData is deprecated. Use moment.localeData instead.",$r);var Ur=Math.abs;function Ab(){var a=this._data;return this._milliseconds=Ur(this._milliseconds),this._days=Ur(this._days),this._months=Ur(this._months),a.milliseconds=Ur(a.milliseconds),a.seconds=Ur(a.seconds),a.minutes=Ur(a.minutes),a.hours=Ur(a.hours),a.months=Ur(a.months),a.years=Ur(a.years),this}function Yd(a,u,h,m){var w=nr(u,h);return a._milliseconds+=m*w._milliseconds,a._days+=m*w._days,a._months+=m*w._months,a._bubble()}function Db(a,u){return Yd(this,a,u,1)}function Fb(a,u){return Yd(this,a,u,-1)}function Jd(a){return a<0?Math.floor(a):Math.ceil(a)}function Mb(){var a=this._milliseconds,u=this._days,h=this._months,m=this._data,w,b,P,ee,pe;return a>=0&&u>=0&&h>=0||a<=0&&u<=0&&h<=0||(a+=Jd(ql(h)+u)*864e5,u=0,h=0),m.milliseconds=a%1e3,w=wt(a/1e3),m.seconds=w%60,b=wt(w/60),m.minutes=b%60,P=wt(b/60),m.hours=P%24,u+=wt(P/24),pe=wt(qd(u)),h+=pe,u-=Jd(ql(pe)),ee=wt(h/12),h%=12,m.days=u,m.months=h,m.years=ee,this}function qd(a){return a*4800/146097}function ql(a){return a*146097/4800}function Rb(a){if(!this.isValid())return NaN;var u,h,m=this._milliseconds;if(a=R(a),a==="month"||a==="quarter"||a==="year")switch(u=this._days+m/864e5,h=this._months+qd(u),a){case"month":return h;case"quarter":return h/3;case"year":return h/12}else switch(u=this._days+Math.round(ql(this._months)),a){case"week":return u/7+m/6048e5;case"day":return u+m/864e5;case"hour":return u*24+m/36e5;case"minute":return u*1440+m/6e4;case"second":return u*86400+m/1e3;case"millisecond":return Math.floor(u*864e5)+m;default:throw new Error("Unknown unit "+a)}}function Pb(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+ye(this._months/12)*31536e6:NaN}function Nr(a){return function(){return this.as(a)}}var Ob=Nr("ms"),Ib=Nr("s"),Lb=Nr("m"),$b=Nr("h"),Ub=Nr("d"),Nb=Nr("w"),Bb=Nr("M"),Vb=Nr("Q"),Hb=Nr("y");function Wb(){return nr(this)}function Kb(a){return a=R(a),this.isValid()?this[a+"s"]():NaN}function Mn(a){return function(){return this.isValid()?this._data[a]:NaN}}var Yb=Mn("milliseconds"),Jb=Mn("seconds"),qb=Mn("minutes"),jb=Mn("hours"),Gb=Mn("days"),zb=Mn("months"),Xb=Mn("years");function Zb(){return wt(this.days()/7)}var Br=Math.round,us={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Qb(a,u,h,m,w){return w.relativeTime(u||1,!!h,a,m)}function ev(a,u,h,m){var w=nr(a).abs(),b=Br(w.as("s")),P=Br(w.as("m")),ee=Br(w.as("h")),pe=Br(w.as("d")),Fe=Br(w.as("M")),xt=Br(w.as("w")),Vr=Br(w.as("y")),cn=b<=h.ss&&["s",b]||b<h.s&&["ss",b]||P<=1&&["m"]||P<h.m&&["mm",P]||ee<=1&&["h"]||ee<h.h&&["hh",ee]||pe<=1&&["d"]||pe<h.d&&["dd",pe];return h.w!=null&&(cn=cn||xt<=1&&["w"]||xt<h.w&&["ww",xt]),cn=cn||Fe<=1&&["M"]||Fe<h.M&&["MM",Fe]||Vr<=1&&["y"]||["yy",Vr],cn[2]=u,cn[3]=+a>0,cn[4]=m,Qb.apply(null,cn)}function tv(a){return a===void 0?Br:typeof a=="function"?(Br=a,!0):!1}function rv(a,u){return us[a]===void 0?!1:u===void 0?us[a]:(us[a]=u,a==="s"&&(us.ss=u-1),!0)}function nv(a,u){if(!this.isValid())return this.localeData().invalidDate();var h=!1,m=us,w,b;return typeof a=="object"&&(u=a,a=!1),typeof a=="boolean"&&(h=a),typeof u=="object"&&(m=Object.assign({},us,u),u.s!=null&&u.ss==null&&(m.ss=u.s-1)),w=this.localeData(),b=ev(this,!h,m,w),h&&(b=w.pastFuture(+this,b)),w.postformat(b)}var jl=Math.abs;function fs(a){return(a>0)-(a<0)||+a}function Ni(){if(!this.isValid())return this.localeData().invalidDate();var a=jl(this._milliseconds)/1e3,u=jl(this._days),h=jl(this._months),m,w,b,P,ee=this.asSeconds(),pe,Fe,xt,Vr;return ee?(m=wt(a/60),w=wt(m/60),a%=60,m%=60,b=wt(h/12),h%=12,P=a?a.toFixed(3).replace(/\.?0+$/,""):"",pe=ee<0?"-":"",Fe=fs(this._months)!==fs(ee)?"-":"",xt=fs(this._days)!==fs(ee)?"-":"",Vr=fs(this._milliseconds)!==fs(ee)?"-":"",pe+"P"+(b?Fe+b+"Y":"")+(h?Fe+h+"M":"")+(u?xt+u+"D":"")+(w||m||a?"T":"")+(w?Vr+w+"H":"")+(m?Vr+m+"M":"")+(a?Vr+P+"S":"")):"P0D"}var ve=Ri.prototype;ve.isValid=Gw,ve.abs=Ab,ve.add=Db,ve.subtract=Fb,ve.as=Rb,ve.asMilliseconds=Ob,ve.asSeconds=Ib,ve.asMinutes=Lb,ve.asHours=$b,ve.asDays=Ub,ve.asWeeks=Nb,ve.asMonths=Bb,ve.asQuarters=Vb,ve.asYears=Hb,ve.valueOf=Pb,ve._bubble=Mb,ve.clone=Wb,ve.get=Kb,ve.milliseconds=Yb,ve.seconds=Jb,ve.minutes=qb,ve.hours=jb,ve.days=Gb,ve.weeks=Zb,ve.months=zb,ve.years=Xb,ve.humanize=nv,ve.toISOString=Ni,ve.toString=Ni,ve.toJSON=Ni,ve.locale=Od,ve.localeData=Ld,ve.toIsoString=I("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ni),ve.lang=Id,G("X",0,0,"unix"),G("x",0,0,"valueOf"),X("x",Ci),X("X",Cy),De("X",function(a,u,h){h._d=new Date(parseFloat(a)*1e3)}),De("x",function(a,u,h){h._d=new Date(ye(a))});return e.version="2.29.4",t(Le),e.fn=K,e.min=Yw,e.max=Jw,e.now=qw,e.utc=g,e.unix=vb,e.months=Sb,e.isDate=f,e.locale=an,e.invalid=v,e.duration=nr,e.isMoment=O,e.weekdays=Cb,e.parseZone=xb,e.localeData=$r,e.isDuration=Pi,e.monthsShort=kb,e.weekdaysMin=Tb,e.defineLocale=Il,e.updateLocale=xw,e.locales=Sw,e.weekdaysShort=Eb,e.normalizeUnits=R,e.relativeTimeRounding=tv,e.relativeTimeThreshold=rv,e.calendarFormat=w_,e.prototype=K,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var YE={};zl(YE,{default:()=>Al});module.exports=uv(YE);var An=require("obsidian"),by=require("obsidian");var lt=()=>new Map,Bi=n=>{let e=lt();return n.forEach((t,r)=>{e.set(r,t)}),e},sr=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},Gd=(n,e)=>{let t=[];for(let[r,s]of n)t.push(e(s,r));return t},zd=(n,e)=>{for(let[t,r]of n)if(e(r,t))return!0;return!1};var br=()=>new Set;var Vi=n=>n[n.length-1];var Xd=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},or=Array.from;var Zl=Array.isArray;var Hi=class{constructor(){this._observers=lt()}on(e,t){return sr(this._observers,e,br).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return or((this._observers.get(e)||lt()).values()).forEach(r=>r(...t))}destroy(){this._observers=lt()}},un=class{constructor(){this._observers=lt()}on(e,t){sr(this._observers,e,br).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return or((this._observers.get(e)||lt()).values()).forEach(r=>r(...t))}destroy(){this._observers=lt()}};var Mt=Math.floor;var ds=Math.abs;var hs=(n,e)=>n<e?n:e,ir=(n,e)=>n>e?n:e,jE=Number.isNaN;var Wi=n=>n!==0?n<0:1/n<0;var ec=Number.MAX_SAFE_INTEGER,GE=Number.MIN_SAFE_INTEGER,zE=1<<31;var Zd=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Mt(n)===n),XE=Number.isNaN,ZE=Number.parseInt;var fv=String.fromCharCode,QE=String.fromCodePoint,eT=fv(65535),dv=n=>n.toLowerCase(),hv=/^\s*/g,pv=n=>n.replace(hv,""),mv=/([A-Z])/g,tc=(n,e)=>pv(n.replace(mv,t=>`${e}${dv(t)}`));var gv=n=>{let e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},gs=typeof TextEncoder!="undefined"?new TextEncoder:null,yv=n=>gs.encode(n),eh=gs?yv:gv;var ms=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ms&&ms.decode(new Uint8Array).length===1&&(ms=null);var Rn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},On=()=>new Rn;var wv=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e};var Lt=n=>{let e=new Uint8Array(wv(n)),t=0;for(let r=0;r<n.bufs.length;r++){let s=n.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},_v=(n,e)=>{let t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(ir(t,e)*2),n.cpos=0)},ct=(n,e)=>{let t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e};var Yi=ct;var fe=(n,e)=>{for(;e>127;)ct(n,128|127&e),e=Mt(e/128);ct(n,127&e)},Ji=(n,e)=>{let t=Wi(e);for(t&&(e=-e),ct(n,(e>63?128:0)|(t?64:0)|63&e),e=Mt(e/64);e>0;)ct(n,(e>127?128:0)|127&e),e=Mt(e/128)},nc=new Uint8Array(3e4),bv=nc.length/3,vv=(n,e)=>{if(e.length<bv){let t=gs.encodeInto(e,nc).written||0;fe(n,t);for(let r=0;r<t;r++)ct(n,nc[r])}else ut(n,eh(e))},xv=(n,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;fe(n,r);for(let s=0;s<r;s++)ct(n,t.codePointAt(s))},Hr=gs&&gs.encodeInto?vv:xv;var Fo=(n,e)=>{let t=n.cbuf.length,r=n.cpos,s=hs(t-r,e.length),o=e.length-s;n.cbuf.set(e.subarray(0,s),r),n.cpos+=s,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(ir(t*2,o)),n.cbuf.set(e.subarray(s)),n.cpos=o)},ut=(n,e)=>{fe(n,e.byteLength),Fo(n,e)},sc=(n,e)=>{_v(n,e);let t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},Sv=(n,e)=>sc(n,4).setFloat32(0,e,!1),kv=(n,e)=>sc(n,8).setFloat64(0,e,!1),Cv=(n,e)=>sc(n,8).setBigInt64(0,e,!1);var rh=new DataView(new ArrayBuffer(4)),Ev=n=>(rh.setFloat32(0,n),rh.getFloat32(0)===n),ws=(n,e)=>{switch(typeof e){case"string":ct(n,119),Hr(n,e);break;case"number":Zd(e)&&ds(e)<=2147483647?(ct(n,125),Ji(n,e)):Ev(e)?(ct(n,124),Sv(n,e)):(ct(n,123),kv(n,e));break;case"bigint":ct(n,122),Cv(n,e);break;case"object":if(e===null)ct(n,126);else if(Zl(e)){ct(n,117),fe(n,e.length);for(let t=0;t<e.length;t++)ws(n,e[t])}else if(e instanceof Uint8Array)ct(n,116),ut(n,e);else{ct(n,118);let t=Object.keys(e);fe(n,t.length);for(let r=0;r<t.length;r++){let s=t[r];Hr(n,s),ws(n,e[s])}}break;case"boolean":ct(n,e?120:121);break;default:ct(n,127)}},Do=class extends Rn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&fe(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var nh=n=>{n.count>0&&(Ji(n.encoder,n.count===1?n.s:-n.s),n.count>1&&fe(n.encoder,n.count-2))},Pn=class{constructor(){this.encoder=new Rn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(nh(this),this.count=1,this.s=e)}toUint8Array(){return nh(this),Lt(this.encoder)}};var sh=n=>{if(n.count>0){let e=n.diff*2+(n.count===1?0:1);Ji(n.encoder,e),n.count>1&&fe(n.encoder,n.count-2)}},_s=class{constructor(){this.encoder=new Rn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(sh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return sh(this),Lt(this.encoder)}},Ki=class{constructor(){this.sarr=[],this.s="",this.lensE=new Pn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Rn;return this.sarr.push(this.s),this.s="",Hr(e,this.sarr.join("")),Fo(e,this.lensE.toUint8Array()),Lt(e)}};var Kt=n=>new Error(n),ar=()=>{throw Kt("Method unimplemented")},Yt=()=>{throw Kt("Unexpected case")};var oh=Kt("Unexpected end of array"),ih=Kt("Integer out of Range"),bs=class{constructor(e){this.arr=e,this.pos=0}},vr=n=>new bs(n),ah=n=>n.pos!==n.arr.length;var Tv=(n,e)=>{let t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},ht=n=>Tv(n,ce(n));var In=n=>n.arr[n.pos++];var ce=n=>{let e=0,t=1,r=n.arr.length;for(;n.pos<r;){let s=n.arr[n.pos++];if(e=e+(s&127)*t,t*=128,s<128)return e;if(e>ec)throw ih}throw oh},ji=n=>{let e=n.arr[n.pos++],t=e&63,r=64,s=(e&64)>0?-1:1;if(!(e&128))return s*t;let o=n.arr.length;for(;n.pos<o;){if(e=n.arr[n.pos++],t=t+(e&127)*r,r*=128,e<128)return s*t;if(t>ec)throw ih}throw oh};var Av=n=>{let e=ce(n);if(e===0)return"";{let t=String.fromCodePoint(In(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(In(n));else for(;e>0;){let r=e<1e4?e:1e4,s=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},Dv=n=>ms.decode(ht(n)),lr=ms?Dv:Av;var ac=(n,e)=>{let t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},Fv=n=>ac(n,4).getFloat32(0,!1),Mv=n=>ac(n,8).getFloat64(0,!1),Rv=n=>ac(n,8).getBigInt64(0,!1);var Pv=[n=>{},n=>null,ji,Fv,Mv,Rv,n=>!1,n=>!0,lr,n=>{let e=ce(n),t={};for(let r=0;r<e;r++){let s=lr(n);t[s]=vs(n)}return t},n=>{let e=ce(n),t=[];for(let r=0;r<e;r++)t.push(vs(n));return t},ht],vs=n=>Pv[127-In(n)](n),Mo=class extends bs{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ah(this)?this.count=ce(this)+1:this.count=-1),this.count--,this.s}};var Ln=class extends bs{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=ji(this);let e=Wi(this.s);this.count=1,e&&(this.s=-this.s,this.count=ce(this)+2)}return this.count--,this.s}};var xs=class extends bs{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=ji(this),t=e&1;this.diff=Mt(e/2),this.count=1,t&&(this.count=ce(this)+2)}return this.s+=this.diff,this.count--,this.s}},qi=class{constructor(e){this.decoder=new Ln(e),this.str=lr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var nT=crypto.subtle,lh=crypto.getRandomValues.bind(crypto);var Ro=()=>lh(new Uint32Array(1))[0];var Ov=[1e7]+-1e3+-4e3+-8e3+-1e11,zi=()=>Ov.replace(/[018]/g,n=>(n^Ro()&15>>n/4).toString(16));var $n=Date.now;var Wr=n=>new Promise(n);var Iv=Promise.all.bind(Promise);var cc=n=>n===void 0?null:n;var uc=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},fh=new uc,$v=!0;try{typeof localStorage!="undefined"&&localStorage&&(fh=localStorage,$v=!1)}catch(n){}var dh=fh;var hh=Object.assign,Nv=Object.keys,ph=(n,e)=>{for(let t in n)e(n[t],t)};var Po=n=>Nv(n).length;var mh=n=>{for(let e in n)return!1;return!0},Bv=(n,e)=>{for(let t in n)if(!e(n[t],t))return!1;return!0},fc=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),dc=(n,e)=>n===e||Po(n)===Po(e)&&Bv(n,(t,r)=>(t!==void 0||fc(e,r))&&e[r]===t);var Oo=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&Oo(n,e,t+1)}};var yh=n=>n,Vv=(n,e)=>n===e;var Ss=(n,e)=>{if(n==null||e==null)return Vv(n,e);if(n.constructor!==e.constructor)return!1;if(n===e)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(let t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(let t of n.keys())if(!e.has(t)||!Ss(n.get(t),e.get(t)))return!1;break}case Object:if(Po(n)!==Po(e))return!1;for(let t in n)if(!fc(n,t)||!Ss(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Ss(n[t],e[t]))return!1;break;default:return!1}return!0},wh=(n,e)=>e.includes(n);var Io=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var iT=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,xr,Hv=[],Wv=()=>{if(xr===void 0)if(Io){xr=lt();let n=process.argv,e=null;for(let t=0;t<n.length;t++){let r=n[t];r[0]==="-"?(e!==null&&xr.set(e,""),e=r):e!==null?(xr.set(e,r),e=null):Hv.push(r)}e!==null&&xr.set(e,"")}else typeof location=="object"?(xr=lt(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){let[e,t]=n.split("=");xr.set(`--${tc(e,"-")}`,t),xr.set(`-${tc(e,"-")}`,t)}})):xr=lt();return xr},pc=n=>Wv().has(n);var mc=n=>Io?cc(process.env[n.toUpperCase().replaceAll("-","_")]):cc(dh.getItem(n));var Kv=n=>pc("--"+n)||mc(n)!==null,aT=Kv("production"),_h=Io&&wh(process.env.FORCE_COLOR,["true","1","2"]),bh=!pc("no-colors")&&(!Io||process.stdout.isTTY||_h)&&(!Io||pc("color")||_h||mc("COLORTERM")!==null||(mc("TERM")||"").includes("color"));var Jv=n=>new Uint8Array(n);var vh=n=>{let e=Jv(n.byteLength);return e.set(n),e};var gc=class{constructor(e,t){this.left=e,this.right=t}},St=(n,e)=>new gc(n,e);var xh=(n,e)=>n.forEach(t=>e(t.left,t.right));var Sr=typeof document!="undefined"?document:{},jv=n=>Sr.createElement(n),Gv=()=>Sr.createDocumentFragment(),zv=n=>Sr.createTextNode(n),lT=typeof DOMParser!="undefined"?new DOMParser:null;var Xv=(n,e)=>(xh(e,(t,r)=>{r===!1?n.removeAttribute(t):r===!0?n.setAttribute(t,""):n.setAttribute(t,r)}),n);var Zv=n=>{let e=Gv();for(let t=0;t<n.length;t++)Ch(e,n[t]);return e},Sh=(n,e)=>(Ch(n,Zv(e)),n);var Lo=(n,e=[],t=[])=>Sh(Xv(jv(n),e),t);var ks=zv;var kh=n=>Gd(n,(e,t)=>`${t}:${e};`).join("");var Ch=(n,e)=>n.appendChild(e),cT=Sr.ELEMENT_NODE,uT=Sr.TEXT_NODE,fT=Sr.CDATA_SECTION_NODE,dT=Sr.COMMENT_NODE,hT=Sr.DOCUMENT_NODE,pT=Sr.DOCUMENT_TYPE_NODE,mT=Sr.DOCUMENT_FRAGMENT_NODE;var kr=Symbol;var $o=kr(),Uo=kr(),wc=kr(),_c=kr(),bc=kr(),No=kr(),vc=kr(),Bo=kr(),xc=kr(),Th=n=>{var s;n.length===1&&((s=n[0])==null?void 0:s.constructor)===Function&&(n=n[0]());let e=[],t=[],r=0;for(;r<n.length;r++){let o=n[r];o===void 0?e.push("undefined"):o.constructor===String||o.constructor===Number?e.push(o):o.constructor===Object&&t.push(JSON.stringify(o))}return t};var gT=$n();var tx={[$o]:St("font-weight","bold"),[Uo]:St("font-weight","normal"),[wc]:St("color","blue"),[bc]:St("color","green"),[_c]:St("color","grey"),[No]:St("color","red"),[vc]:St("color","purple"),[Bo]:St("color","orange"),[xc]:St("color","black")},rx=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());let e=[],t=[],r=lt(),s=[],o=0;for(;o<n.length;o++){let l=n[o],c=tx[l];if(c!==void 0)r.set(c.left,c.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){let f=kh(r);o>0||f.length>0?(e.push("%c"+l),t.push(f)):e.push(l)}else break}}for(o>0&&(s=t,s.unshift(e.join("")));o<n.length;o++){let l=n[o];l instanceof Symbol||s.push(l)}return s},nx=bh?rx:Th,Ah=(...n)=>{console.log(...nx(n)),sx.forEach(e=>e.print(n))};var sx=br();var Dh=n=>({[Symbol.iterator](){return this},next:n}),Fh=(n,e)=>Dh(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),Xi=(n,e)=>Dh(()=>{let{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});var Ho=class{constructor(e,t){this.clock=e,this.len=t}},Un=class{constructor(){this.clients=new Map}},Yh=(n,e,t)=>e.clients.forEach((r,s)=>{let o=n.doc.store.clients.get(s);for(let i=0;i<r.length;i++){let l=r[i];rp(n,o,l.clock,l.len,t)}}),cx=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){let s=Mt((t+r)/2),o=n[s],i=o.clock;if(i<=e){if(e<i+o.len)return s;t=s+1}else r=s-1}return null},Jh=(n,e)=>{let t=n.clients.get(e.client);return t!==void 0&&cx(t,e.clock)!==null},$c=n=>{n.clients.forEach(e=>{e.sort((s,o)=>s.clock-o.clock);let t,r;for(t=1,r=1;t<e.length;t++){let s=e[r-1],o=e[t];s.clock+s.len>=o.clock?s.len=ir(s.len,o.clock+o.len-s.clock):(r<t&&(e[r]=o),r++)}e.length=r})},ux=n=>{let e=new Un;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){let o=r.slice();for(let i=t+1;i<n.length;i++)Xd(o,n[i].clients.get(s)||[]);e.clients.set(s,o)}});return $c(e),e},sa=(n,e,t,r)=>{sr(n.clients,e,()=>[]).push(new Ho(t,r))},qh=()=>new Un,fx=n=>{let e=qh();return n.clients.forEach((t,r)=>{let s=[];for(let o=0;o<t.length;o++){let i=t[o];if(i.deleted){let l=i.id.clock,c=i.length;if(o+1<t.length)for(let f=t[o+1];o+1<t.length&&f.deleted;f=t[++o+1])c+=f.length;s.push(new Ho(l,c))}}s.length>0&&e.clients.set(r,s)}),e},Rs=(n,e)=>{fe(n.restEncoder,e.clients.size),or(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),fe(n.restEncoder,t);let s=r.length;fe(n.restEncoder,s);for(let o=0;o<s;o++){let i=r[o];n.writeDsClock(i.clock),n.writeDsLen(i.len)}})},pa=n=>{let e=new Un,t=ce(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();let s=ce(n.restDecoder),o=ce(n.restDecoder);if(o>0){let i=sr(e.clients,s,()=>[]);for(let l=0;l<o;l++)i.push(new Ho(n.readDsClock(),n.readDsLen()))}}return e},Ph=(n,e,t)=>{let r=new Un,s=ce(n.restDecoder);for(let o=0;o<s;o++){n.resetDsCurVal();let i=ce(n.restDecoder),l=ce(n.restDecoder),c=t.clients.get(i)||[],f=Qe(t,i);for(let d=0;d<l;d++){let p=n.readDsClock(),g=p+n.readDsLen();if(p<f){f<g&&sa(r,i,f,g-f);let _=Er(c,p),y=c[_];for(!y.deleted&&y.id.clock<p&&(c.splice(_+1,0,ha(e,y,p-y.id.clock)),_++);_<c.length&&(y=c[_++],y.id.clock<g);)y.deleted||(g<y.id.clock+y.length&&c.splice(_,0,ha(e,y,g-y.id.clock)),y.delete(e))}else sa(r,i,p,g-p)}}if(r.clients.size>0){let o=new Yr;return fe(o.restEncoder,0),Rs(o,r),o.toUint8Array()}return null};var jh=Ro,Cr=class extends Hi{constructor({guid:e=zi(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=jh(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new ca,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Wr(f=>{this.on("load",()=>{this.isLoaded=!0,f(this)})});let c=()=>Wr(f=>{let d=p=>{(p===void 0||p===!0)&&(this.off("sync",d),f())};this.on("sync",d)});this.on("sync",f=>{f===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=f===void 0||f===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Me(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(or(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Me(this,e,t)}get(e,t=it){let r=sr(this.share,e,()=>{let o=new t;return o._integrate(this,null),o}),s=r.constructor;if(t!==it&&s!==t)if(s===it){let o=new t;o._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=o}),o._start=r._start;for(let i=o._start;i!==null;i=i.right)i.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,mn)}getText(e=""){return this.get(e,wn)}getMap(e=""){return this.get(e,yn)}getXmlElement(e=""){return this.get(e,_n)}getXmlFragment(e=""){return this.get(e,Jr)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){or(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new Cr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Me(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},oa=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ce(this.restDecoder)}readDsLen(){return ce(this.restDecoder)}},Wo=class extends oa{readLeftID(){return me(ce(this.restDecoder),ce(this.restDecoder))}readRightID(){return me(ce(this.restDecoder),ce(this.restDecoder))}readClient(){return ce(this.restDecoder)}readInfo(){return In(this.restDecoder)}readString(){return lr(this.restDecoder)}readParentInfo(){return ce(this.restDecoder)===1}readTypeRef(){return ce(this.restDecoder)}readLen(){return ce(this.restDecoder)}readAny(){return vs(this.restDecoder)}readBuf(){return vh(ht(this.restDecoder))}readJSON(){return JSON.parse(lr(this.restDecoder))}readKey(){return lr(this.restDecoder)}},kc=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ce(this.restDecoder),this.dsCurrVal}readDsLen(){let e=ce(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Kr=class extends kc{constructor(e){super(e),this.keys=[],ce(e),this.keyClockDecoder=new xs(ht(e)),this.clientDecoder=new Ln(ht(e)),this.leftClockDecoder=new xs(ht(e)),this.rightClockDecoder=new xs(ht(e)),this.infoDecoder=new Mo(ht(e),In),this.stringDecoder=new qi(ht(e)),this.parentInfoDecoder=new Mo(ht(e),In),this.typeRefDecoder=new Ln(ht(e)),this.lenDecoder=new Ln(ht(e))}readLeftID(){return new pn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new pn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vs(this.restDecoder)}readBuf(){return ht(this.restDecoder)}readJSON(){return vs(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},ia=class{constructor(){this.restEncoder=On()}toUint8Array(){return Lt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){fe(this.restEncoder,e)}writeDsLen(e){fe(this.restEncoder,e)}},Nn=class extends ia{writeLeftID(e){fe(this.restEncoder,e.client),fe(this.restEncoder,e.clock)}writeRightID(e){fe(this.restEncoder,e.client),fe(this.restEncoder,e.clock)}writeClient(e){fe(this.restEncoder,e)}writeInfo(e){Yi(this.restEncoder,e)}writeString(e){Hr(this.restEncoder,e)}writeParentInfo(e){fe(this.restEncoder,e?1:0)}writeTypeRef(e){fe(this.restEncoder,e)}writeLen(e){fe(this.restEncoder,e)}writeAny(e){ws(this.restEncoder,e)}writeBuf(e){ut(this.restEncoder,e)}writeJSON(e){Hr(this.restEncoder,JSON.stringify(e))}writeKey(e){Hr(this.restEncoder,e)}},aa=class{constructor(){this.restEncoder=On(),this.dsCurrVal=0}toUint8Array(){return Lt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,fe(this.restEncoder,t)}writeDsLen(e){e===0&&Yt(),fe(this.restEncoder,e-1),this.dsCurrVal+=e}},Yr=class extends aa{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new _s,this.clientEncoder=new Pn,this.leftClockEncoder=new _s,this.rightClockEncoder=new _s,this.infoEncoder=new Do(Yi),this.stringEncoder=new Ki,this.parentInfoEncoder=new Do(Yi),this.typeRefEncoder=new Pn,this.lenEncoder=new Pn}toUint8Array(){let e=On();return fe(e,0),ut(e,this.keyClockEncoder.toUint8Array()),ut(e,this.clientEncoder.toUint8Array()),ut(e,this.leftClockEncoder.toUint8Array()),ut(e,this.rightClockEncoder.toUint8Array()),ut(e,Lt(this.infoEncoder)),ut(e,this.stringEncoder.toUint8Array()),ut(e,Lt(this.parentInfoEncoder)),ut(e,this.typeRefEncoder.toUint8Array()),ut(e,this.lenEncoder.toUint8Array()),Fo(e,Lt(this.restEncoder)),Lt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ws(this.restEncoder,e)}writeBuf(e){ut(this.restEncoder,e)}writeJSON(e){ws(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},dx=(n,e,t,r)=>{r=ir(r,e[0].id.clock);let s=Er(e,r);fe(n.restEncoder,e.length-s),n.writeClient(t),fe(n.restEncoder,r);let o=e[s];o.write(n,r-o.id.clock);for(let i=s+1;i<e.length;i++)e[i].write(n,0)},Uc=(n,e,t)=>{let r=new Map;t.forEach((s,o)=>{Qe(e,o)>s&&r.set(o,s)}),ma(e).forEach((s,o)=>{t.has(o)||r.set(o,0)}),fe(n.restEncoder,r.size),or(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{dx(n,e.clients.get(s),s,o)})},hx=(n,e)=>{let t=lt(),r=ce(n.restDecoder);for(let s=0;s<r;s++){let o=ce(n.restDecoder),i=new Array(o),l=n.readClient(),c=ce(n.restDecoder);t.set(l,{i:0,refs:i});for(let f=0;f<o;f++){let d=n.readInfo();switch(31&d){case 0:{let p=n.readLen();i[f]=new Rt(me(l,c),p),c+=p;break}case 10:{let p=ce(n.restDecoder);i[f]=new Pt(me(l,c),p),c+=p;break}default:{let p=(d&192)===0,g=new Be(me(l,c),null,(d&128)===128?n.readLeftID():null,null,(d&64)===64?n.readRightID():null,p?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,p&&(d&32)===32?n.readString():null,xp(n,d));i[f]=g,c+=g.length}}}}return t},px=(n,e,t)=>{let r=[],s=or(t.keys()).sort((_,y)=>_-y);if(s.length===0)return null;let o=()=>{if(s.length===0)return null;let _=t.get(s[s.length-1]);for(;_.refs.length===_.i;)if(s.pop(),s.length>0)_=t.get(s[s.length-1]);else return null;return _},i=o();if(i===null)return null;let l=new ca,c=new Map,f=(_,y)=>{let x=c.get(_);(x==null||x>y)&&c.set(_,y)},d=i.refs[i.i++],p=new Map,g=()=>{for(let _ of r){let y=_.id.client,x=t.get(y);x?(x.i--,l.clients.set(y,x.refs.slice(x.i)),t.delete(y),x.i=0,x.refs=[]):l.clients.set(y,[_]),s=s.filter(C=>C!==y)}r.length=0};for(;;){if(d.constructor!==Pt){let y=sr(p,d.id.client,()=>Qe(e,d.id.client))-d.id.clock;if(y<0)r.push(d),f(d.id.client,d.id.clock-1),g();else{let x=d.getMissing(n,e);if(x!==null){r.push(d);let C=t.get(x)||{refs:[],i:0};if(C.refs.length===C.i)f(x,Qe(e,x)),g();else{d=C.refs[C.i++];continue}}else(y===0||y<d.length)&&(d.integrate(n,y),p.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(i!==null&&i.i<i.refs.length)d=i.refs[i.i++];else{if(i=o(),i===null)break;d=i.refs[i.i++]}}if(l.clients.size>0){let _=new Yr;return Uc(_,l,new Map),fe(_.restEncoder,0),{missing:c,update:_.toUint8Array()}}return null},mx=(n,e)=>Uc(n,e.doc.store,e.beforeState),gx=(n,e,t,r=new Kr(n))=>Me(e,s=>{s.local=!1;let o=!1,i=s.doc,l=i.store,c=hx(r,i),f=px(s,l,c),d=l.pendingStructs;if(d){for(let[g,_]of d.missing)if(_<Qe(l,g)){o=!0;break}if(f){for(let[g,_]of f.missing){let y=d.missing.get(g);(y==null||y>_)&&d.missing.set(g,_)}d.update=ua([d.update,f.update])}}else l.pendingStructs=f;let p=Ph(r,s,l);if(l.pendingDs){let g=new Kr(vr(l.pendingDs));ce(g.restDecoder);let _=Ph(g,s,l);p&&_?l.pendingDs=ua([p,_]):l.pendingDs=p||_}else l.pendingDs=p;if(o){let g=l.pendingStructs.update;l.pendingStructs=null,Gh(s.doc,g)}},t,!1);var Gh=(n,e,t,r=Kr)=>{let s=vr(e);gx(s,n,t,new r(s))},Wn=(n,e,t)=>Gh(n,e,t,Wo),yx=(n,e,t=new Map)=>{Uc(n,e.store,t),Rs(n,fx(e.store))},wx=(n,e=new Uint8Array([0]),t=new Yr)=>{let r=zh(e);yx(t,n,r);let s=[t.toUint8Array()];if(n.store.pendingDs&&s.push(n.store.pendingDs),n.store.pendingStructs&&s.push(Rx(n.store.pendingStructs.update,e)),s.length>1){if(t.constructor===Nn)return Fx(s.map((o,i)=>i===0?o:Ox(o)));if(t.constructor===Yr)return ua(s)}return s[0]},Kn=(n,e)=>wx(n,e,new Nn),_x=n=>{let e=new Map,t=ce(n.restDecoder);for(let r=0;r<t;r++){let s=ce(n.restDecoder),o=ce(n.restDecoder);e.set(s,o)}return e},zh=n=>_x(new oa(vr(n))),Xh=(n,e)=>(fe(n.restEncoder,e.size),or(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{fe(n.restEncoder,t),fe(n.restEncoder,r)}),n),bx=(n,e)=>Xh(n,ma(e.store)),vx=(n,e=new aa)=>(n instanceof Map?Xh(e,n):bx(e,n),e.toUint8Array()),Zh=n=>vx(n,new ia),Cc=class{constructor(){this.l=[]}},Oh=()=>new Cc,Ih=(n,e)=>n.l.push(e),Lh=(n,e)=>{let t=n.l,r=t.length;n.l=t.filter(s=>e!==s),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Qh=(n,e,t)=>Oo(n.l,[e,t]),pn=class{constructor(e,t){this.client=e,this.clock=t}},Es=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,me=(n,e)=>new pn(n,e);var ep=n=>{for(let[e,t]of n.doc.share.entries())if(t===n)return e;throw Yt()};var la=class{constructor(e,t,r,s=0){this.type=e,this.tname=t,this.item=r,this.assoc=s}};var Nc=n=>new la(n.type==null?null:me(n.type.client,n.type.clock),n.tname||null,n.item==null?null:me(n.item.client,n.item.clock),n.assoc==null?0:n.assoc),Ec=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},xx=(n,e,t=0)=>new Ec(n,e,t),Zi=(n,e,t)=>{let r=null,s=null;return n._item===null?s=ep(n):r=me(n._item.id.client,n._item.id.clock),new la(r,s,e,t)},Bc=(n,e,t=0)=>{let r=n._start;if(t<0){if(e===0)return Zi(n,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Zi(n,me(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Zi(n,r.lastId,t);r=r.right}return Zi(n,null,t)};var Vc=(n,e)=>{let t=e.store,r=n.item,s=n.type,o=n.tname,i=n.assoc,l=null,c=0;if(r!==null){if(Qe(t,r.client)<=r.clock)return null;let f=Kh(t,r),d=f.item;if(!(d instanceof Be))return null;if(l=d.parent,l._item===null||!l._item.deleted){c=d.deleted||!d.countable?0:f.diff+(i>=0?0:1);let p=d.left;for(;p!==null;)!p.deleted&&p.countable&&(c+=p.length),p=p.left}}else{if(o!==null)l=e.get(o);else if(s!==null){if(Qe(t,s.client)<=s.clock)return null;let{item:f}=Kh(t,s);if(f instanceof Be&&f.content instanceof qt)l=f.content.type;else return null}else throw Yt();i>=0?c=l._length:c=0}return xx(l,c,n.assoc)},Hc=(n,e)=>n===e||n!==null&&e!==null&&n.tname===e.tname&&Es(n.item,e.item)&&Es(n.type,e.type)&&n.assoc===e.assoc,Tc=class{constructor(e,t){this.ds=e,this.sv=t}};var Sx=(n,e)=>new Tc(n,e),ET=Sx(qh(),new Map);var Cs=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!Jh(e.ds,n.id),Ac=(n,e)=>{let t=sr(n.meta,Ac,br),r=n.doc.store;t.has(e)||(e.sv.forEach((s,o)=>{s<Qe(r,o)&&gn(n,me(o,s))}),Yh(n,e.ds,s=>{}),t.add(e))};var ca=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},ma=n=>{let e=new Map;return n.clients.forEach((t,r)=>{let s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},Qe=(n,e)=>{let t=n.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},tp=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Yt()}t.push(e)},Er=(n,e)=>{let t=0,r=n.length-1,s=n[r],o=s.id.clock;if(o===e)return r;let i=Mt(e/(o+s.length-1)*r);for(;t<=r;){if(s=n[i],o=s.id.clock,o<=e){if(e<o+s.length)return i;t=i+1}else r=i-1;i=Mt((t+r)/2)}throw Yt()},kx=(n,e)=>{let t=n.clients.get(e.client);return t[Er(t,e.clock)]},ta=kx,Dc=(n,e,t)=>{let r=Er(e,t),s=e[r];return s.id.clock<t&&s instanceof Be?(e.splice(r+1,0,ha(n,s,t-s.id.clock)),r+1):r},gn=(n,e)=>{let t=n.doc.store.clients.get(e.client);return t[Dc(n,t,e.clock)]},$h=(n,e,t)=>{let r=e.clients.get(t.client),s=Er(r,t.clock),o=r[s];return t.clock!==o.id.clock+o.length-1&&o.constructor!==Rt&&r.splice(s+1,0,ha(n,o,t.clock-o.id.clock+1)),o},Cx=(n,e,t)=>{let r=n.clients.get(e.id.client);r[Er(r,e.id.clock)]=t},rp=(n,e,t,r,s)=>{if(r===0)return;let o=t+r,i=Dc(n,e,t),l;do l=e[i++],o<l.id.clock+l.length&&Dc(n,e,o),s(l);while(i<e.length&&e[i].id.clock<o)},Fc=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Un,this.beforeState=ma(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},Uh=(n,e)=>e.deleteSet.clients.size===0&&!zd(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:($c(e.deleteSet),mx(n,e),Rs(n,e.deleteSet),!0),Nh=(n,e,t)=>{let r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&sr(n.changed,e,br).add(t)},ra=(n,e)=>{let t=n[e],r=n[e-1],s=e;for(;s>0;t=r,r=n[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Be&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let o=e-s;return o&&n.splice(e+1-o,o),o},Ex=(n,e,t)=>{for(let[r,s]of n.clients.entries()){let o=e.clients.get(r);for(let i=s.length-1;i>=0;i--){let l=s[i],c=l.clock+l.len;for(let f=Er(o,l.clock),d=o[f];f<o.length&&d.id.clock<c;d=o[++f]){let p=o[f];if(l.clock+l.len<=p.id.clock)break;p instanceof Be&&p.deleted&&!p.keep&&t(p)&&p.gc(e,!1)}}}},Tx=(n,e)=>{n.clients.forEach((t,r)=>{let s=e.clients.get(r);for(let o=t.length-1;o>=0;o--){let i=t[o],l=hs(s.length-1,1+Er(s,i.clock+i.len-1));for(let c=l,f=s[c];c>0&&f.id.clock>=i.clock;f=s[c])c-=1+ra(s,c)}})};var np=(n,e)=>{if(e<n.length){let t=n[e],r=t.doc,s=r.store,o=t.deleteSet,i=t._mergeStructs;try{$c(o),t.afterState=ma(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let l=[];t.changed.forEach((c,f)=>l.push(()=>{(f._item===null||!f._item.deleted)&&f._callObserver(t,c)})),l.push(()=>{t.changedParentTypes.forEach((c,f)=>{f._dEH.l.length>0&&(f._item===null||!f._item.deleted)&&(c=c.filter(d=>d.target._item===null||!d.target._item.deleted),c.forEach(d=>{d.currentTarget=f,d._path=null}),c.sort((d,p)=>d.path.length-p.path.length),Qh(f._dEH,c,t))})}),l.push(()=>r.emit("afterTransaction",[t,r])),Oo(l,[]),t._needFormattingCleanup&&Yx(t)}finally{r.gc&&Ex(o,s,r.gcFilter),Tx(o,s),t.afterState.forEach((d,p)=>{let g=t.beforeState.get(p)||0;if(g!==d){let _=s.clients.get(p),y=ir(Er(_,g),1);for(let x=_.length-1;x>=y;)x-=1+ra(_,x)}});for(let d=i.length-1;d>=0;d--){let{client:p,clock:g}=i[d].id,_=s.clients.get(p),y=Er(_,g);y+1<_.length&&ra(_,y+1)>1||y>0&&ra(_,y)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Ah(Bo,$o,"[yjs] ",Uo,No,"Changed the client-id because another client seems to be using it."),r.clientID=jh()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let d=new Nn;Uh(d,t)&&r.emit("update",[d.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let d=new Yr;Uh(d,t)&&r.emit("updateV2",[d.toUint8Array(),t.origin,r,t])}let{subdocsAdded:l,subdocsLoaded:c,subdocsRemoved:f}=t;(l.size>0||f.size>0||c.size>0)&&(l.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),f.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:c,added:l,removed:f},r,t]),f.forEach(d=>d.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):np(n,e+1)}}},Me=(n,e,t=null,r=!0)=>{let s=n._transactionCleanups,o=!1,i=null;n._transaction===null&&(o=!0,n._transaction=new Fc(n,t,r),s.push(n._transaction),s.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{i=e(n._transaction)}finally{if(o){let l=n._transaction===s[0];n._transaction=null,l&&np(s,0)}}return i};function*Ax(n){let e=ce(n.restDecoder);for(let t=0;t<e;t++){let r=ce(n.restDecoder),s=n.readClient(),o=ce(n.restDecoder);for(let i=0;i<r;i++){let l=n.readInfo();if(l===10){let c=ce(n.restDecoder);yield new Pt(me(s,o),c),o+=c}else if(31&l){let c=(l&192)===0,f=new Be(me(s,o),null,(l&128)===128?n.readLeftID():null,null,(l&64)===64?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(l&32)===32?n.readString():null,xp(n,l));yield f,o+=f.length}else{let c=n.readLen();yield new Rt(me(s,o),c),o+=c}}}}var Ts=class{constructor(e,t){this.gen=Ax(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Pt);return this.curr}};var sp=n=>Dx(n,Wo),Dx=(n,e=Kr)=>{let t=[],r=new e(vr(n)),s=new Ts(r,!1);for(let o=s.curr;o!==null;o=s.next())t.push(o);return{structs:t,ds:pa(r)}},Ko=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Fx=n=>ua(n,Wo,Nn);var Mx=(n,e)=>{if(n.constructor===Rt){let{client:t,clock:r}=n.id;return new Rt(me(t,r+e),n.length-e)}else if(n.constructor===Pt){let{client:t,clock:r}=n.id;return new Pt(me(t,r+e),n.length-e)}else{let t=n,{client:r,clock:s}=t.id;return new Be(me(r,s+e),null,me(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},ua=(n,e=Kr,t=Yr)=>{if(n.length===1)return n[0];let r=n.map(d=>new e(vr(d))),s=r.map(d=>new Ts(d,!0)),o=null,i=new t,l=new Ko(i);for(;s=s.filter(g=>g.curr!==null),s.sort((g,_)=>{if(g.curr.id.client===_.curr.id.client){let y=g.curr.id.clock-_.curr.id.clock;return y===0?g.curr.constructor===_.curr.constructor?0:g.curr.constructor===Pt?1:-1:y}else return _.curr.id.client-g.curr.id.client}),s.length!==0;){let d=s[0],p=d.curr.id.client;if(o!==null){let g=d.curr,_=!1;for(;g!==null&&g.id.clock+g.length<=o.struct.id.clock+o.struct.length&&g.id.client>=o.struct.id.client;)g=d.next(),_=!0;if(g===null||g.id.client!==p||_&&g.id.clock>o.struct.id.clock+o.struct.length)continue;if(p!==o.struct.id.client)dn(l,o.struct,o.offset),o={struct:g,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<g.id.clock)if(o.struct.constructor===Pt)o.struct.length=g.id.clock+g.length-o.struct.id.clock;else{dn(l,o.struct,o.offset);let y=g.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Pt(me(p,o.struct.id.clock+o.struct.length),y),offset:0}}else{let y=o.struct.id.clock+o.struct.length-g.id.clock;y>0&&(o.struct.constructor===Pt?o.struct.length-=y:g=Mx(g,y)),o.struct.mergeWith(g)||(dn(l,o.struct,o.offset),o={struct:g,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let g=d.curr;g!==null&&g.id.client===p&&g.id.clock===o.struct.id.clock+o.struct.length&&g.constructor!==Pt;g=d.next())dn(l,o.struct,o.offset),o={struct:g,offset:0}}o!==null&&(dn(l,o.struct,o.offset),o=null),Wc(l);let c=r.map(d=>pa(d)),f=ux(c);return Rs(i,f),i.toUint8Array()},Rx=(n,e,t=Kr,r=Yr)=>{let s=zh(e),o=new r,i=new Ko(o),l=new t(vr(n)),c=new Ts(l,!1);for(;c.curr;){let d=c.curr,p=d.id.client,g=s.get(p)||0;if(c.curr.constructor===Pt){c.next();continue}if(d.id.clock+d.length>g)for(dn(i,d,ir(g-d.id.clock,0)),c.next();c.curr&&c.curr.id.client===p;)dn(i,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===p&&c.curr.id.clock+c.curr.length<=g;)c.next()}Wc(i);let f=pa(l);return Rs(o,f),o.toUint8Array()};var op=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:Lt(n.encoder.restEncoder)}),n.encoder.restEncoder=On(),n.written=0)},dn=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&op(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),fe(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},Wc=n=>{op(n);let e=n.encoder.restEncoder;fe(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){let r=n.clientStructs[t];fe(e,r.written),Fo(e,r.restEncoder)}},Px=(n,e,t,r)=>{let s=new t(vr(n)),o=new Ts(s,!1),i=new r,l=new Ko(i);for(let f=o.curr;f!==null;f=o.next())dn(l,e(f),0);Wc(l);let c=pa(s);return Rs(i,c),i.toUint8Array()};var Ox=n=>Px(n,yh,Kr,Nn),Bh="You must not compute changes after the event-handler fired.",As=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ix(this.currentTarget,this.target))}deletes(e){return Jh(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Kt(Bh);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){let o=t._map.get(s),i,l;if(this.adds(o)){let c=o.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(o))if(c!==null&&this.deletes(c))i="delete",l=Vi(c.content.getContent());else return;else c!==null&&this.deletes(c)?(i="update",l=Vi(c.content.getContent())):(i="add",l=void 0)}else if(this.deletes(o))i="delete",l=Vi(o.content.getContent());else return;e.set(s,{action:i,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Kt(Bh);let t=this.target,r=br(),s=br(),o=[];if(e={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(t).has(null)){let l=null,c=()=>{l&&o.push(l)};for(let f=t._start;f!==null;f=f.right)f.deleted?this.deletes(f)&&!this.adds(f)&&((l===null||l.delete===void 0)&&(c(),l={delete:0}),l.delete+=f.length,s.add(f)):this.adds(f)?((l===null||l.insert===void 0)&&(c(),l={insert:[]}),l.insert=l.insert.concat(f.content.getContent()),r.add(f)):((l===null||l.retain===void 0)&&(c(),l={retain:0}),l.retain+=f.length);l!==null&&l.retain===void 0&&c()}this._changes=e}return e}},Ix=(n,e)=>{let t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;t.unshift(r)}e=e._item.parent}return t},ip=80,Kc=0,Mc=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Kc++}},Lx=n=>{n.timestamp=Kc++},ap=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=Kc++},$x=(n,e,t)=>{if(n.length>=ip){let r=n.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return ap(r,e,t),r}else{let r=new Mc(e,t);return n.push(r),r}},ga=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;let t=n._searchMarker.length===0?null:n._searchMarker.reduce((o,i)=>ds(e-o.index)<ds(e-i.index)?o:i),r=n._start,s=0;for(t!==null&&(r=t.p,s=t.index,Lx(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&ds(t.index-s)<r.parent.length/ip?(ap(t,r,s),t):$x(n._searchMarker,r,s)},Yo=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){let s=n[r];if(t>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){n.splice(r,1);continue}s.p=o,o.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=ir(e,s.index+t))}};var ya=(n,e,t)=>{let r=n,s=e.changedParentTypes;for(;sr(s,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;Qh(r._eH,t,e)},it=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Oh(),this._dEH=Oh(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw ar()}clone(){throw ar()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Ih(this._eH,e)}observeDeep(e){Ih(this._dEH,e)}unobserve(e){Lh(this._eH,e)}unobserveDeep(e){Lh(this._dEH,e)}toJSON(){}},lp=(n,e,t)=>{e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e,s=[],o=n._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){let i=o.content.getContent();if(i.length<=e)e-=i.length;else{for(let l=e;l<i.length&&r>0;l++)s.push(i[l]),r--;e=0}}o=o.right}return s},cp=n=>{let e=[],t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e};var Jo=(n,e)=>{let t=0,r=n._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let o=0;o<s.length;o++)e(s[o],t++,n)}r=r.right}},up=(n,e)=>{let t=[];return Jo(n,(r,s)=>{t.push(e(r,s,n))}),t},Ux=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},fp=(n,e)=>{let t=ga(n,e),r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},fa=(n,e,t,r)=>{let s=t,o=n.doc,i=o.clientID,l=o.store,c=t===null?e._start:t.right,f=[],d=()=>{f.length>0&&(s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new cr(f)),s.integrate(n,0),f=[])};r.forEach(p=>{if(p===null)f.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:f.push(p);break;default:switch(d(),p.constructor){case Uint8Array:case ArrayBuffer:s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new Bn(new Uint8Array(p))),s.integrate(n,0);break;case Cr:s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new Hn(p)),s.integrate(n,0);break;default:if(p instanceof it)s=new Be(me(i,Qe(l,i)),s,s&&s.lastId,c,c&&c.id,e,null,new qt(p)),s.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},dp=()=>Kt("Length exceeded!"),hp=(n,e,t,r)=>{if(t>e._length)throw dp();if(t===0)return e._searchMarker&&Yo(e._searchMarker,t,r.length),fa(n,e,null,r);let s=t,o=ga(e,t),i=e._start;for(o!==null&&(i=o.p,t-=o.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&gn(n,me(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&Yo(e._searchMarker,s,r.length),fa(n,e,i,r)},Nx=(n,e,t)=>{let s=(e._searchMarker||[]).reduce((o,i)=>i.index>o.index?i:o,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return fa(n,e,s,t)},pp=(n,e,t,r)=>{if(r===0)return;let s=t,o=r,i=ga(e,t),l=e._start;for(i!==null&&(l=i.p,t-=i.index);l!==null&&t>0;l=l.right)!l.deleted&&l.countable&&(t<l.length&&gn(n,me(l.id.client,l.id.clock+t)),t-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&gn(n,me(l.id.client,l.id.clock+r)),l.delete(n),r-=l.length),l=l.right;if(r>0)throw dp();e._searchMarker&&Yo(e._searchMarker,s,-o+r)},da=(n,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(n)},Yc=(n,e,t,r)=>{let s=e._map.get(t)||null,o=n.doc,i=o.clientID,l;if(r==null)l=new cr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:l=new cr([r]);break;case Uint8Array:l=new Bn(r);break;case Cr:l=new Hn(r);break;default:if(r instanceof it)l=new qt(r);else throw new Error("Unexpected content type")}new Be(me(i,Qe(o.store,i)),s,s&&s.lastId,null,null,e,t,l).integrate(n,0)},Jc=(n,e)=>{let t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},mp=n=>{let e={};return n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},gp=(n,e)=>{let t=n._map.get(e);return t!==void 0&&!t.deleted};var Bx=(n,e)=>{let t={};return n._map.forEach((r,s)=>{let o=r;for(;o!==null&&(!e.sv.has(o.id.client)||o.id.clock>=(e.sv.get(o.id.client)||0));)o=o.left;o!==null&&Cs(o,e)&&(t[s]=o.content.getContent()[o.length-1])}),t},Qi=n=>Fh(n.entries(),e=>!e[1].deleted),Rc=class extends As{constructor(e,t){super(e,t),this._transaction=t}},mn=class extends it{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new mn;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new mn}clone(){let e=new mn;return e.insert(0,this.toArray().map(t=>t instanceof it?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),ya(this,e,new Rc(this,e))}insert(e,t){this.doc!==null?Me(this.doc,r=>{hp(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Me(this.doc,t=>{Nx(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Me(this.doc,r=>{pp(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return fp(this,e)}toArray(){return cp(this)}slice(e=0,t=this.length){return lp(this,e,t)}toJSON(){return this.map(e=>e instanceof it?e.toJSON():e)}map(e){return up(this,e)}forEach(e){Jo(this,e)}[Symbol.iterator](){return Ux(this)}_write(e){e.writeTypeRef(a0)}},Vx=n=>new mn,Pc=class extends As{constructor(e,t,r){super(e,t),this.keysChanged=r}},yn=class extends it{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new yn}clone(){let e=new yn;return this.forEach((t,r)=>{e.set(r,t instanceof it?t.clone():t)}),e}_callObserver(e,t){ya(this,e,new Pc(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof it?s.toJSON():s}}),e}get size(){return[...Qi(this._map)].length}keys(){return Xi(Qi(this._map),e=>e[0])}values(){return Xi(Qi(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Xi(Qi(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Me(this.doc,t=>{da(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Me(this.doc,r=>{Yc(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Jc(this,e)}has(e){return gp(this,e)}clear(){this.doc!==null?Me(this.doc,e=>{this.forEach(function(t,r,s){da(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(l0)}},Hx=n=>new yn,hn=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&dc(n,e),qo=class{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Yt(),this.right.content.constructor){case je:this.right.deleted||Ps(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Vh=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case je:e.right.deleted||Ps(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&gn(n,me(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ea=(n,e,t,r)=>{let s=new Map,o=r?ga(e,t):null;if(o){let i=new qo(o.p.left,o.p,o.index,s);return Vh(n,i,t-o.index)}else{let i=new qo(null,e._start,0,s);return Vh(n,i,t)}},yp=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===je&&hn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let s=n.doc,o=s.clientID;r.forEach((i,l)=>{let c=t.left,f=t.right,d=new Be(me(o,Qe(s.store,o)),c,c&&c.lastId,f,f&&f.id,e,null,new je(l,i));d.integrate(n,0),t.right=d,t.forward()})},Ps=(n,e)=>{let{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},wp=(n,e)=>{var t;for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===je&&hn((t=e[n.right.content.key])!=null?t:null,n.right.content.value)))break;n.forward()}},_p=(n,e,t,r)=>{var l;let s=n.doc,o=s.clientID,i=new Map;for(let c in r){let f=r[c],d=(l=t.currentAttributes.get(c))!=null?l:null;if(!hn(d,f)){i.set(c,d);let{left:p,right:g}=t;t.right=new Be(me(o,Qe(s.store,o)),p,p&&p.lastId,g,g&&g.id,e,null,new je(c,f)),t.right.integrate(n,0),t.forward()}}return i},Sc=(n,e,t,r,s)=>{t.currentAttributes.forEach((g,_)=>{s[_]===void 0&&(s[_]=null)});let o=n.doc,i=o.clientID;wp(t,s);let l=_p(n,e,t,s),c=r.constructor===String?new Jt(r):r instanceof it?new qt(r):new qr(r),{left:f,right:d,index:p}=t;e._searchMarker&&Yo(e._searchMarker,t.index,c.getLength()),d=new Be(me(i,Qe(o.store,i)),f,f&&f.lastId,d,d&&d.id,e,null,c),d.integrate(n,0),t.right=d,t.index=p,t.forward(),yp(n,e,t,l)},Hh=(n,e,t,r,s)=>{let o=n.doc,i=o.clientID;wp(t,s);let l=_p(n,e,t,s);e:for(;t.right!==null&&(r>0||l.size>0&&(t.right.deleted||t.right.content.constructor===je));){if(!t.right.deleted)switch(t.right.content.constructor){case je:{let{key:c,value:f}=t.right.content,d=s[c];if(d!==void 0){if(hn(d,f))l.delete(c);else{if(r===0)break e;l.set(c,f)}t.right.delete(n)}else t.currentAttributes.set(c,f);break}default:r<t.right.length&&gn(n,me(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new Be(me(i,Qe(o.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Jt(c)),t.right.integrate(n,0),t.forward()}yp(n,e,t,l)},bp=(n,e,t,r,s)=>{var f,d;let o=e,i=lt();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===je){let p=o.content;i.set(p.key,p)}o=o.right}let l=0,c=!1;for(;e!==o;){if(t===e&&(c=!0),!e.deleted){let p=e.content;switch(p.constructor){case je:{let{key:g,value:_}=p,y=(f=r.get(g))!=null?f:null;(i.get(g)!==p||y===_)&&(e.delete(n),l++,!c&&((d=s.get(g))!=null?d:null)===_&&y!==_&&(y===null?s.delete(g):s.set(g,y))),!c&&!e.deleted&&Ps(s,p);break}}}e=e.right}return l},Wx=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===je){let r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},Kx=n=>{let e=0;return Me(n.doc,t=>{let r=n._start,s=n._start,o=lt(),i=Bi(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case je:Ps(i,s.content);break;default:e+=bp(t,r,s,o,i),o=Bi(i),r=s;break}s=s.right}}),e},Yx=n=>{let e=new Set,t=n.doc;for(let[r,s]of n.afterState.entries()){let o=n.beforeState.get(r)||0;s!==o&&rp(n,t.store.clients.get(r),o,s,i=>{!i.deleted&&i.content.constructor===je&&i.constructor!==Rt&&e.add(i.parent)})}Me(t,r=>{Yh(n,n.deleteSet,s=>{if(s instanceof Rt||!s.parent._hasFormatting||e.has(s.parent))return;let o=s.parent;s.content.constructor===je?e.add(o):Wx(r,s)});for(let s of e)Kx(s)})},Wh=(n,e,t)=>{let r=t,s=Bi(e.currentAttributes),o=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case qt:case qr:case Jt:t<e.right.length&&gn(n,me(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}o&&bp(n,o,e.right,s,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&Yo(i._searchMarker,e.index,-r+t),e},Oc=class extends As{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Me(e,r=>{var _,y,x;let s=new Map,o=new Map,i=this.target._start,l=null,c={},f="",d=0,p=0,g=()=>{if(l!==null){let C=null;switch(l){case"delete":p>0&&(C={delete:p}),p=0;break;case"insert":(typeof f=="object"||f.length>0)&&(C={insert:f},s.size>0&&(C.attributes={},s.forEach((v,D)=>{v!==null&&(C.attributes[D]=v)}))),f="";break;case"retain":d>0&&(C={retain:d},mh(c)||(C.attributes=hh({},c))),d=0;break}C&&t.push(C),l=null}};for(;i!==null;){switch(i.content.constructor){case qt:case qr:this.adds(i)?this.deletes(i)||(g(),l="insert",f=i.content.getContent()[0],g()):this.deletes(i)?(l!=="delete"&&(g(),l="delete"),p+=1):i.deleted||(l!=="retain"&&(g(),l="retain"),d+=1);break;case Jt:this.adds(i)?this.deletes(i)||(l!=="insert"&&(g(),l="insert"),f+=i.content.str):this.deletes(i)?(l!=="delete"&&(g(),l="delete"),p+=i.length):i.deleted||(l!=="retain"&&(g(),l="retain"),d+=i.length);break;case je:{let{key:C,value:v}=i.content;if(this.adds(i)){if(!this.deletes(i)){let D=(_=s.get(C))!=null?_:null;hn(D,v)?v!==null&&i.delete(r):(l==="retain"&&g(),hn(v,(y=o.get(C))!=null?y:null)?delete c[C]:c[C]=v)}}else if(this.deletes(i)){o.set(C,v);let D=(x=s.get(C))!=null?x:null;hn(D,v)||(l==="retain"&&g(),c[C]=D)}else if(!i.deleted){o.set(C,v);let D=c[C];D!==void 0&&(hn(D,v)?D!==null&&i.delete(r):(l==="retain"&&g(),v===null?delete c[C]:c[C]=v))}i.deleted||(l==="insert"&&g(),Ps(s,i.content));break}}i=i.right}for(g();t.length>0;){let C=t[t.length-1];if(C.retain!==void 0&&C.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},wn=class extends it{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new wn}clone(){let e=new wn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Oc(this,e,t);ya(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Jt&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Me(this.doc,r=>{let s=new qo(null,this._start,0,new Map);for(let o=0;o<e.length;o++){let i=e[o];if(i.insert!==void 0){let l=!t&&typeof i.insert=="string"&&o===e.length-1&&s.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof l!="string"||l.length>0)&&Sc(r,this,s,l,i.attributes||{})}else i.retain!==void 0?Hh(r,this,s,i.retain,i.attributes||{}):i.delete!==void 0&&Wh(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let s=[],o=new Map,i=this.doc,l="",c=this._start;function f(){if(l.length>0){let p={},g=!1;o.forEach((y,x)=>{g=!0,p[x]=y});let _={insert:l};g&&(_.attributes=p),s.push(_),l=""}}let d=()=>{for(;c!==null;){if(Cs(c,e)||t!==void 0&&Cs(c,t))switch(c.content.constructor){case Jt:{let p=o.get("ychange");e!==void 0&&!Cs(c,e)?(p===void 0||p.user!==c.id.client||p.type!=="removed")&&(f(),o.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!Cs(c,t)?(p===void 0||p.user!==c.id.client||p.type!=="added")&&(f(),o.set("ychange",r?r("added",c.id):{type:"added"})):p!==void 0&&(f(),o.delete("ychange")),l+=c.content.str;break}case qt:case qr:{f();let p={insert:c.content.getContent()[0]};if(o.size>0){let g={};p.attributes=g,o.forEach((_,y)=>{g[y]=_})}s.push(p);break}case je:Cs(c,e)&&(f(),Ps(o,c.content));break}c=c.right}f()};return e||t?Me(i,p=>{e&&Ac(p,e),t&&Ac(p,t),d()},"cleanup"):d(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;s!==null?Me(s,o=>{let i=ea(o,this,e,!r);r||(r={},i.currentAttributes.forEach((l,c)=>{r[c]=l})),Sc(o,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;s!==null?Me(s,o=>{let i=ea(o,this,e,!r);Sc(o,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Me(r,s=>{Wh(s,ea(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let s=this.doc;s!==null?Me(s,o=>{let i=ea(o,this,e,!1);i.right!==null&&Hh(o,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Me(this.doc,t=>{da(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Me(this.doc,r=>{Yc(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Jc(this,e)}getAttributes(){return mp(this)}_write(e){e.writeTypeRef(c0)}},Jx=n=>new wn,Vo=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===_n||t.constructor===Jr)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Jr=class extends it{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Jr}clone(){let e=new Jr;return e.insert(0,this.toArray().map(t=>t instanceof it?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Vo(this,e)}querySelector(e){e=e.toUpperCase();let r=new Vo(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),or(new Vo(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){ya(this,e,new Ic(this,t,e))}toString(){return up(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Jo(this,o=>{s.insertBefore(o.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?Me(this.doc,r=>{hp(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Me(this.doc,r=>{let s=e&&e instanceof it?e._item:e;fa(r,this,s,t)});else{let r=this._prelimContent,s=e===null?0:r.findIndex(o=>o===e)+1;if(s===0&&e!==null)throw Kt("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?Me(this.doc,r=>{pp(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return cp(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return fp(this,e)}slice(e=0,t=this.length){return lp(this,e,t)}forEach(e){Jo(this,e)}_write(e){e.writeTypeRef(f0)}},qx=n=>new Jr,_n=class extends Jr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new _n(this.nodeName)}clone(){let e=new _n(this.nodeName),t=this.getAttributes();return ph(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof it?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let l in e)r.push(l);r.sort();let s=r.length;for(let l=0;l<s;l++){let c=r[l];t.push(c+'="'+e[c]+'"')}let o=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${o}${i}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?Me(this.doc,t=>{da(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Me(this.doc,r=>{Yc(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Jc(this,e)}hasAttribute(e){return gp(this,e)}getAttributes(e){return e?Bx(this,e):mp(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),o=this.getAttributes();for(let i in o){let l=o[i];typeof l=="string"&&s.setAttribute(i,l)}return Jo(this,i=>{s.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(u0),e.writeKey(this.nodeName)}},jx=n=>new _n(n.readKey()),Ic=class extends As{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Ds=class extends yn{constructor(e){super(),this.hookName=e}_copy(){return new Ds(this.hookName)}clone(){let e=new Ds(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s=t[this.hookName],o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(d0),e.writeKey(this.hookName)}},Gx=n=>new Ds(n.readKey()),Fs=class extends wn{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Fs}clone(){let e=new Fs;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let s in e.attributes){let o=[];for(let i in e.attributes[s])o.push({key:i,value:e.attributes[s][i]});o.sort((i,l)=>i.key<l.key?-1:1),t.push({nodeName:s,attrs:o})}t.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){let o=t[s];r+=`<${o.nodeName}`;for(let i=0;i<o.attrs.length;i++){let l=o.attrs[i];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(h0)}},zx=n=>new Fs,jo=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw ar()}mergeWith(e){return!1}write(e,t,r){throw ar()}integrate(e,t){throw ar()}},Xx=0,Rt=class extends jo{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),tp(e.doc.store,this)}write(e,t){e.writeInfo(Xx),e.writeLen(this.length-t)}getMissing(e,t){return null}},Bn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Bn(this.content)}splice(e){throw ar()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},Zx=n=>new Bn(n.readBuf()),Vn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Vn(this.len)}splice(e){let t=new Vn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){sa(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Qx=n=>new Vn(n.readLen()),vp=(n,e)=>new Cr({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Hn=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Hn(vp(this.doc.guid,this.opts))}splice(e){throw ar()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},e0=n=>new Hn(vp(n.readString(),n.readAny())),qr=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new qr(this.embed)}splice(e){throw ar()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},t0=n=>new qr(n.readJSON()),je=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.key,this.value)}splice(e){throw ar()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},r0=n=>new je(n.readKey(),n.readJSON()),Ms=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ms(this.arr)}splice(e){let t=new Ms(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let o=this.arr[s];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}},n0=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++){let s=n.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new Ms(t)},cr=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new cr(this.arr)}splice(e){let t=new cr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let o=this.arr[s];e.writeAny(o)}}getRef(){return 8}},s0=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new cr(t)},Jt=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Jt(this.str)}splice(e){let t=new Jt(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},o0=n=>new Jt(n.readString()),i0=[Vx,Hx,Jx,jx,qx,Gx,zx],a0=0,l0=1,c0=2,u0=3,f0=4,d0=5,h0=6,qt=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new qt(this.type._copy())}splice(e){throw ar()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},p0=n=>new qt(i0[n.readTypeRef()](n)),Kh=(n,e)=>{let t=e,r=0,s;do r>0&&(t=me(t.client,t.clock+r)),s=ta(n,t),r=t.clock-s.id.clock,t=s.redone;while(t!==null&&s instanceof Be);return{item:s,diff:r}};var ha=(n,e,t)=>{let{client:r,clock:s}=e.id,o=new Be(me(r,s+t),e,me(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=me(e.redone.client,e.redone.clock+t)),e.right=o,o.right!==null&&(o.right.left=o),n._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=t,o};var Be=class extends jo{constructor(e,t,r,s,o,i,l,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=o,this.parent=i,this.parentSub=l,this.redone=null,this.content=c,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Qe(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Qe(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===pn&&this.id.client!==this.parent.client&&this.parent.clock>=Qe(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=$h(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=gn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Rt||this.right&&this.right.constructor===Rt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Be&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Be&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===pn){let r=ta(t,this.parent);r.constructor===Rt?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=$h(e,e.doc.store,me(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let o=new Set,i=new Set;for(;s!==null&&s!==this.right;){if(i.add(s),o.add(s),Es(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Es(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&i.has(ta(e.doc.store,s.origin)))o.has(ta(e.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),tp(e.doc.store,this),this.content.integrate(e,this),Nh(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Rt(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:me(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Es(e.origin,this.lastId)&&this.right===e&&Es(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),sa(e.deleteSet,this.id.client,this.id.clock,this.length),Nh(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Yt();this.content.gc(e),t?Cx(e,this,new Rt(this.id,this.length)):this.content=new Vn(this.length)}write(e,t){let r=t>0?me(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,o=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(o===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){let l=this.parent;if(l._item!==void 0){let c=l._item;if(c===null){let f=ep(l);e.writeParentInfo(!0),e.writeString(f)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===pn?(e.writeParentInfo(!1),e.writeLeftID(l)):Yt();o!==null&&e.writeString(o)}this.content.write(e,t)}},xp=(n,e)=>m0[e&31](n),m0=[()=>{Yt()},Qx,n0,Zx,o0,t0,r0,p0,s0,e0,()=>{Yt()}],g0=10,Pt=class extends jo{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Yt()}write(e,t){e.writeInfo(g0),fe(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Sp=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},kp="__ $YJS$ __";Sp[kp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Sp[kp]=!0;var Ct=require("obsidian");var Yn=n=>Wr((e,t)=>{n.onerror=r=>t(new Error(r.target.error)),n.onsuccess=r=>e(r.target.result)}),Cp=(n,e)=>Wr((t,r)=>{let s=indexedDB.open(n);s.onupgradeneeded=o=>e(o.target.result),s.onerror=o=>r(Kt(o.target.error)),s.onsuccess=o=>{let i=o.target.result;i.onversionchange=()=>{i.close()},t(i)}}),Ep=n=>Yn(indexedDB.deleteDatabase(n)),Tp=(n,e)=>e.forEach(t=>n.createObjectStore.apply(n,t)),Os=(n,e,t="readwrite")=>{let r=n.transaction(e,t);return e.map(s=>b0(r,s))},qc=(n,e)=>Yn(n.count(e)),Ap=(n,e)=>Yn(n.get(e)),jc=(n,e)=>Yn(n.delete(e)),Dp=(n,e,t)=>Yn(n.put(e,t));var wa=(n,e)=>Yn(n.add(e)),Fp=(n,e,t)=>Yn(n.getAll(e,t));var y0=(n,e,t)=>{let r=null;return _0(n,e,s=>(r=s,!1),t).then(()=>r)},Mp=(n,e=null)=>y0(n,e,"prev");var w0=(n,e)=>Wr((t,r)=>{n.onerror=r,n.onsuccess=async s=>{let o=s.target.result;if(o===null||await e(o)===!1)return t();o.continue()}});var _0=(n,e,t,r="next")=>w0(n.openKeyCursor(e,r),s=>t(s.key)),b0=(n,e)=>n.objectStore(e);var Rp=(n,e)=>IDBKeyRange.upperBound(n,e),Pp=(n,e)=>IDBKeyRange.lowerBound(n,e);var Gc="custom",Op="updates",Ip=500,Ls=(n,e=()=>{},t=()=>{})=>{let[r]=Os(n.db,[Op]);return Fp(r,Pp(n._dbref,!1)).then(s=>{n._destroyed||(e(r),Me(n.doc,()=>{s.forEach(o=>Wn(n.doc,o))},n,!1),t(r))}).then(()=>Mp(r).then(s=>{n._dbref=s+1})).then(()=>qc(r).then(s=>{n._dbsize=s})).then(()=>r)},x0=(n,e=!0)=>Ls(n).then(t=>{(e||n._dbsize>=Ip)&&wa(t,Kn(n.doc)).then(()=>jc(t,Rp(n._dbref,!0))).then(()=>qc(t).then(r=>{n._dbsize=r}))});var Is=class extends un{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Cp(e,r=>Tp(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Wr(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Ls(this,i=>wa(i,Kn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[o]=Os(this.db,[Op]);wa(o,r),++this._dbsize>=Ip&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{x0(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Ep(this.name)})}get(e){return this._db.then(t=>{let[r]=Os(t,[Gc],"readonly");return Ap(r,e)})}set(e,t){return this._db.then(r=>{let[s]=Os(r,[Gc]);return Dp(s,t,e)})}del(e){return this._db.then(t=>{let[r]=Os(t,[Gc]);return jc(r,e)})}};var _a,S0=new Uint8Array(16);function zc(){if(!_a&&(_a=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _a(S0)}var pt=[];for(let n=0;n<256;++n)pt.push((n+256).toString(16).slice(1));function Lp(n,e=0){return pt[n[e+0]]+pt[n[e+1]]+pt[n[e+2]]+pt[n[e+3]]+"-"+pt[n[e+4]]+pt[n[e+5]]+"-"+pt[n[e+6]]+pt[n[e+7]]+"-"+pt[n[e+8]]+pt[n[e+9]]+"-"+pt[n[e+10]]+pt[n[e+11]]+pt[n[e+12]]+pt[n[e+13]]+pt[n[e+14]]+pt[n[e+15]]}var k0=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Xc={randomUUID:k0};function C0(n,e,t){if(Xc.randomUUID&&!e&&!n)return Xc.randomUUID();n=n||{};let r=n.random||(n.rng||zc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Lp(r)}var $s=C0;var Xt=To(ba());var Np=0,va=1,Bp=2,xa=(n,e)=>{fe(n,Np);let t=Zh(e);ut(n,t)},Zc=(n,e,t)=>{fe(n,va),ut(n,Kn(e,t))},T0=(n,e,t)=>Zc(e,t,ht(n)),Vp=(n,e,t)=>{try{Wn(e,ht(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Hp=(n,e)=>{fe(n,Bp),ut(n,e)},A0=Vp,Wp=(n,e,t,r)=>{let s=ce(n);switch(s){case Np:T0(n,e,t);break;case va:Vp(n,t,r);break;case Bp:A0(n,t,r);break;default:throw new Error("Unknown message type")}return s};var F0=0;var Kp=(n,e,t)=>{switch(ce(n)){case F0:t(e,lr(n))}};var Qc=3e4,Sa=class extends un{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=$n();this.getLocalState()!==null&&Qc/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,o)=>{o!==this.clientID&&Qc<=t-s.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&ka(this,r,"timeout")},Mt(Qc/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,o=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:$n()});let i=[],l=[],c=[],f=[];e===null?f.push(t):o==null?e!=null&&i.push(t):(l.push(t),Ss(o,e)||c.push(t)),(i.length>0||c.length>0||f.length>0)&&this.emit("change",[{added:i,updated:c,removed:f},"local"]),this.emit("update",[{added:i,updated:l,removed:f},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},ka=(n,e,t)=>{let r=[];for(let s=0;s<e.length;s++){let o=e[s];if(n.states.has(o)){if(n.states.delete(o),o===n.clientID){let i=n.meta.get(o);n.meta.set(o,{clock:i.clock+1,lastUpdated:$n()})}r.push(o)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},t]),n.emit("update",[{added:[],updated:[],removed:r},t]))},Ns=(n,e,t=n.states)=>{let r=e.length,s=On();fe(s,r);for(let o=0;o<r;o++){let i=e[o],l=t.get(i)||null,c=n.meta.get(i).clock;fe(s,i),fe(s,c),Hr(s,JSON.stringify(l))}return Lt(s)};var Yp=(n,e,t)=>{let r=vr(e),s=$n(),o=[],i=[],l=[],c=[],f=ce(r);for(let d=0;d<f;d++){let p=ce(r),g=ce(r),_=JSON.parse(lr(r)),y=n.meta.get(p),x=n.states.get(p),C=y===void 0?0:y.clock;(C<g||C===g&&_===null&&n.states.has(p))&&(_===null?p===n.clientID&&n.getLocalState()!=null?g++:n.states.delete(p):n.states.set(p,_),n.meta.set(p,{clock:g,lastUpdated:s}),y===void 0&&_!==null?o.push(p):y!==void 0&&_===null?c.push(p):_!==null&&(Ss(_,x)||l.push(p),i.push(p)))}(o.length>0||l.length>0||c.length>0)&&n.emit("change",[{added:o,updated:l,removed:c},t]),(o.length>0||i.length>0||c.length>0)&&n.emit("update",[{added:o,updated:i,removed:c},t])};var Vs=()=>new Map,zp=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},Xp=()=>new Set,P0=Array.from,BT=Array.isArray,Zp=String.fromCharCode,VT=String.fromCodePoint,HT=Zp(65535),O0=n=>n.toLowerCase(),I0=/^\s*/g,L0=n=>n.replace(I0,""),$0=/([A-Z])/g,Jp=(n,e)=>L0(n.replace($0,t=>`${e}${O0(t)}`)),U0=n=>{let e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},zo=typeof TextEncoder!="undefined"?new TextEncoder:null,N0=n=>zo.encode(n),B0=zo?N0:U0,eu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});eu&&eu.decode(new Uint8Array).length===1&&(eu=null);var qp=n=>n===void 0?null:n,V0=class{constructor(){this.map=new Map}setItem(n,e){this.map.set(n,e)}getItem(n){return this.map.get(n)}},Qp=new V0,iu=!0;try{typeof localStorage!="undefined"&&(Qp=localStorage,iu=!1)}catch(n){}var em=Qp,H0=n=>iu||addEventListener("storage",n),W0=n=>iu||removeEventListener("storage",n),K0=(n,e)=>{let t=[];for(let r in n)t.push(e(n[r],r));return t},Y0=(n,e)=>e.includes(n),Ks=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),tm=typeof window!="undefined"&&typeof document!="undefined"&&!Ks,WT=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Ar,J0=[],q0=()=>{if(Ar===void 0)if(Ks){Ar=Vs();let n=process.argv,e=null;for(let t=0;t<n.length;t++){let r=n[t];r[0]==="-"?(e!==null&&Ar.set(e,""),e=r):e!==null?(Ar.set(e,r),e=null):J0.push(r)}e!==null&&Ar.set(e,"")}else typeof location=="object"?(Ar=Vs(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){let[e,t]=n.split("=");Ar.set(`--${Jp(e,"-")}`,t),Ar.set(`-${Jp(e,"-")}`,t)}})):Ar=Vs();return Ar},ru=n=>q0().has(n),nu=n=>qp(Ks?process.env[n.toUpperCase()]:em.getItem(n)),j0=n=>ru("--"+n)||nu(n)!==null,KT=j0("production"),jp=Ks&&Y0(process.env.FORCE_COLOR,["true","1","2"]),YT=!ru("no-colors")&&(!Ks||process.stdout.isTTY||jp)&&(!Ks||ru("color")||jp||nu("COLORTERM")!==null||(nu("TERM")||"").includes("color")),rm=Math.floor,nm=(n,e)=>n<e?n:e,G0=(n,e)=>n>e?n:e,JT=Number.isNaN,z0=Math.pow,sm=128,X0=1<<17,Z0=1<<18,Q0=1<<19,e1=1<<20,t1=1<<21,r1=1<<22,n1=1<<23,s1=1<<24,o1=1<<25,i1=1<<26,a1=1<<27,l1=1<<28,c1=1<<29,u1=1<<30,qT=1<<31,Ca=127,jT=X0-1,GT=Z0-1,zT=Q0-1,XT=e1-1,ZT=t1-1,QT=r1-1,eA=n1-1,tA=s1-1,rA=o1-1,nA=i1-1,sA=a1-1,oA=l1-1,iA=c1-1,aA=u1-1,f1=Number.MAX_SAFE_INTEGER,lA=Number.MIN_SAFE_INTEGER,cA=1<<31,uA=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&rm(n)===n),fA=Number.isNaN,dA=Number.parseInt,d1=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},ur=()=>new d1,au=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},jt=n=>{let e=new Uint8Array(au(n)),t=0;for(let r=0;r<n.bufs.length;r++){let s=n.bufs[r];e.set(s,t),t+=s.length}return e.set(am(n.cbuf.buffer,0,n.cpos),t),e},Ea=(n,e)=>{let t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},kt=(n,e)=>{for(;e>Ca;)Ea(n,sm|Ca&e),e=rm(e/128);Ea(n,Ca&e)},su=new Uint8Array(3e4),h1=su.length/3,p1=(n,e)=>{if(e.length<h1){let t=zo.encodeInto(e,su).written||0;kt(n,t);for(let r=0;r<t;r++)Ea(n,su[r])}else Hs(n,B0(e))},m1=(n,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;kt(n,r);for(let s=0;s<r;s++)Ea(n,t.codePointAt(s))},hA=zo&&zo.encodeInto?p1:m1,g1=(n,e)=>{let t=n.cbuf.length,r=n.cpos,s=nm(t-r,e.length),o=e.length-s;n.cbuf.set(e.subarray(0,s),r),n.cpos+=s,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(G0(t*2,o)),n.cbuf.set(e.subarray(s)),n.cpos=o)},Hs=(n,e)=>{kt(n,e.byteLength),g1(n,e)},pA=new DataView(new ArrayBuffer(4)),om=n=>new Error(n),y1=om("Unexpected end of array"),w1=om("Integer out of Range"),_1=class{constructor(n){this.arr=n,this.pos=0}},b1=n=>new _1(n),v1=(n,e)=>{let t=am(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},x1=n=>v1(n,im(n)),im=n=>{let e=0,t=1,r=n.arr.length;for(;n.pos<r;){let s=n.arr[n.pos++];if(e=e+(s&Ca)*t,t*=128,s<sm)return e;if(e>f1)throw w1}throw y1},S1=n=>new Uint8Array(n),am=(n,e,t)=>new Uint8Array(n,e,t),k1=n=>new Uint8Array(n),C1=n=>{let e="";for(let t=0;t<n.byteLength;t++)e+=Zp(n[t]);return btoa(e)},E1=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),T1=n=>{let e=atob(n),t=S1(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},A1=n=>{let e=Buffer.from(n,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},D1=tm?C1:E1,F1=tm?T1:A1,lm=new Map,M1=class{constructor(n){this.room=n,this.onmessage=null,this._onChange=e=>e.key===n&&this.onmessage!==null&&this.onmessage({data:F1(e.newValue||"")}),H0(this._onChange)}postMessage(n){em.setItem(this.room,D1(k1(n)))}close(){W0(this._onChange)}},R1=typeof BroadcastChannel=="undefined"?M1:BroadcastChannel,lu=n=>zp(lm,n,()=>{let e=Xp(),t=new R1(n);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),P1=(n,e)=>(lu(n).subs.add(e),e),O1=(n,e)=>{let t=lu(n),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),lm.delete(n)),r},Bs=(n,e,t=null)=>{let r=lu(n);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},ou=Date.now,I1=class{constructor(){this._observers=Vs()}on(n,e){zp(this._observers,n,Xp).add(e)}once(n,e){let t=(...r)=>{this.off(n,t),e(...r)};this.on(n,t)}off(n,e){let t=this._observers.get(n);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(n))}emit(n,e){return P0((this._observers.get(n)||Vs()).values()).forEach(t=>t(...e))}destroy(){this._observers=Vs()}},L1=n=>K0(n,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Jn=0,cm=3,Ws=1,$1=2,Xo=[];Xo[Jn]=(n,e,t,r,s)=>{kt(n,Jn);let o=Wp(e,n,t.doc,t);r&&o===va&&!t.synced&&(t.synced=!0)};Xo[cm]=(n,e,t,r,s)=>{kt(n,Ws),Hs(n,Ns(t.awareness,Array.from(t.awareness.getStates().keys())))};Xo[Ws]=(n,e,t,r,s)=>{Yp(t.awareness,x1(e),t)};Xo[$1]=(n,e,t,r,s)=>{Kp(e,t.doc,(o,i)=>U1(t,i))};var Gp=3e4,U1=(n,e)=>console.warn(`Permission denied to access ${n.url}.
${e}`),um=(n,e,t)=>{let r=b1(e),s=ur(),o=im(r),i=n.messageHandlers[o];return i?i(s,r,n,t,o):console.error("Unable to compute message"),s},fm=n=>{if(n.shouldConnect&&n.ws===null){let e=new n._WS(n.url);e.binaryType="arraybuffer",n.ws=e,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,e.onmessage=t=>{n.wsLastMessageReceived=ou();let r=um(n,new Uint8Array(t.data),!0);au(r)>1&&e.send(jt(r))},e.onerror=t=>{n.emit("connection-error",[t,n])},e.onclose=t=>{n.emit("connection-close",[t,n]),n.ws=null,n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,ka(n.awareness,Array.from(n.awareness.getStates().keys()).filter(r=>r!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(fm,nm(z0(2,n.wsUnsuccessfulReconnects)*100,n.maxBackoffTime),n)},e.onopen=()=>{n.wsLastMessageReceived=ou(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);let t=ur();if(kt(t,Jn),xa(t,n.doc),e.send(jt(t)),n.awareness.getLocalState()!==null){let r=ur();kt(r,Ws),Hs(r,Ns(n.awareness,[n.doc.clientID])),e.send(jt(r))}},n.emit("status",[{status:"connecting"}])}},tu=(n,e)=>{let t=n.ws;n.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),n.bcconnected&&Bs(n.bcChannel,e,n)},dm=class extends I1{constructor(n,e,t,{connect:r=!0,awareness:s=new Sa(t),params:o={},WebSocketPolyfill:i=WebSocket,resyncInterval:l=-1,maxBackoffTime:c=2500,disableBc:f=!1}={}){for(super();n[n.length-1]==="/";)n=n.slice(0,n.length-1);let d=L1(o);this.maxBackoffTime=c,this.bcChannel=n+"/"+e,this.url=n+"/"+e+(d.length===0?"":"?"+d),this.roomname=e,this.doc=t,this._WS=i,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Xo.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,l>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let p=ur();kt(p,Jn),xa(p,t),this.ws.send(jt(p))}},l)),this._bcSubscriber=(p,g)=>{if(g!==this){let _=um(this,new Uint8Array(p),!1);au(_)>1&&Bs(this.bcChannel,jt(_),this)}},this._updateHandler=(p,g)=>{if(g!==this){let _=ur();kt(_,Jn),Hp(_,p),tu(this,jt(_))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:p,updated:g,removed:_},y)=>{let x=p.concat(g).concat(_),C=ur();kt(C,Ws),Hs(C,Ns(s,x)),tu(this,jt(C))},this._unloadHandler=()=>{ka(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var p;this.wsconnected&&Gp<ou()-this.wsLastMessageReceived&&((p=this.ws)==null||p.close())},Gp/10),r&&this.connect()}get synced(){return this._synced}set synced(n){this._synced!==n&&(this._synced=n,this.emit("synced",[n]),this.emit("sync",[n]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(P1(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let n=ur();kt(n,Jn),xa(n,this.doc),Bs(this.bcChannel,jt(n),this);let e=ur();kt(e,Jn),Zc(e,this.doc),Bs(this.bcChannel,jt(e),this);let t=ur();kt(t,cm),Bs(this.bcChannel,jt(t),this);let r=ur();kt(r,Ws),Hs(r,Ns(this.awareness,[this.doc.clientID])),Bs(this.bcChannel,jt(r),this)}disconnectBc(){let n=ur();kt(n,Ws),Hs(n,Ns(this.awareness,[this.doc.clientID],new Map)),tu(this,jt(n)),this.bcconnected&&(O1(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(fm(this),this.connectBc())}};var cu=require("obsidian"),fr=new WeakMap,hm=!1;function Ta(n){hm=n}function N1(n){return new cu.Notice(n.name+`
`+n.message),n}function B1(n){return new cu.Notice(n.name+`:
An error has occurred, please reload Obsidian.`),n}function Q(n,e="log"){return hm?(...t)=>console[e](n,": ",...t):(...t)=>{}}var V1=!1,uu=V1?N1:B1;function Da(n,e){let t,r=new Promise((s,o)=>{t=window.setTimeout(()=>{try{throw new Error("Timeout")}catch(i){Q("[Promise]","error")("Timeout on promise",n)}o("Timeout after "+e+" ms")},e)});return Promise.race([n,r]).finally(()=>{clearTimeout(t)})}var Aa=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction();return e?Promise.resolve(t):(this.currentPromise||(this.currentPromise=this.promiseFunction().then(r=>(this.currentPromise=null,r),r=>{throw this.currentPromise=null,r})),this.currentPromise)}};var fu=class{constructor(){this.platform="s3rn";this.product="relay"}},du=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Gt=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},dr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},bn=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},qn=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Dr=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,s,o,i,l,c,f]=t;if(!this.validateUUID(o))throw new Error("Invalid UUID");if(l&&!this.validateUUID(l))throw new Error("Invalid UUID");if(f&&!this.validateUUID(f))throw new Error("Invalid UUID");if(r==="relay"&&s==="relay"&&i==="folder"&&c==="doc")return new dr(o,l,f);if(r==="relay"&&s==="relay"&&i=="folder")return new Gt(o,l);if(r==="relay"&&s==="folder"&&i==="document")return new qn(o,l);if(r==="relay"&&s==="folder")return new bn(o);if(r==="relay"&&s==="relay")return new du(o);if(s===void 0)return new fu;throw new Error("Invalid s3rn format for the given product type")}};var mm=require("obsidian");var H1={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function pm(n,e,t){let r={token:n.token},s=new dm(n.url,n.docId,e,{connect:!1,params:r,disableBc:!0});return t&&s.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),s}var Ys=class{constructor(e,t,r){this.PROVIDER_MAX_ERRORS=3;this.debug=Q("[HasProvider]","debug");this.log=Q("[HasProvider]","log");this.warn=Q("[HasProvider]","warn");this.error=Q("[HasProvider]","error");var l;this._s3rn=e,this.listeners=new Map,this.loginManager=r,this.ydoc=new Cr,this.tokenStore=t,this.clientToken=this.tokenStore.getTokenSync(Dr.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0};let s=(l=this.loginManager)==null?void 0:l.user;this._provider=pm(this.clientToken,this.ydoc,s);let o=this.providerConnectionErrorSubscription(c=>{this.log(`[${this.path}] disconnection event`,c);let f=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),f&&this.connect()});o.on(),this._offConnectionError=o.off;let i=this.providerStateSubscription(c=>{this.notifyListeners()});i.on(),this._offState=i.off}get s3rn(){return this._s3rn}set s3rn(e){this._s3rn=e,this.refreshProvider(this.clientToken)}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(e=>{e(this.state)})}subscribe(e,t){return this.listeners.set(e,t),()=>{this.unsubscribe(e)}}unsubscribe(e){this.listeners.delete(e)}async getProviderToken(){this.log("get provider token");let e=this.tokenStore.getToken(Dr.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this));return mm.Platform.isIosApp?e:Da(e,1e4)}providerActive(){var e;if(this.clientToken){let t=this._provider.url==this.clientToken.url,r=Date.now()>(((e=this.clientToken)==null?void 0:e.expiryTime)||0);return t&&!r}return!1}refreshProvider(e){var o;this.clientToken=e;let t=new Cr,r=pm(e,t),s=r.url;if(this._provider)this._provider.url!==s&&(this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0,this.log(`Token Refreshed: setting new provider url, ${this._provider.url}`),(o=this._provider.ws)==null||o.close());else throw new Error("missing provider!");r.awareness.destroy(),r.destroy(),t.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(e=>(this.refreshProvider(e),this._provider.connect(),this.notifyListeners(),!0)).catch(e=>!1)}get state(){var e;return{status:H1[((e=this._provider.ws)==null?void 0:e.readyState)||3],intent:this._provider.shouldConnect?"connected":"disconnected"}}get synced(){return this._provider.synced}disconnect(){var e;this._provider.shouldConnect=!1,(e=this._provider.ws)==null||e.close(),this._provider.ws=null,this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(e=>{e(this)}):this.getProviderToken().then(e=>this)}onceConnected(){return new Promise(e=>{let t=r=>{r.status==="connected"&&e()};this._provider.on("status",t)})}onceProviderSynced(){var e;return(e=this._provider)!=null&&e.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",t)})}_injectIntent(e){return r=>{var o;let s=(o=this._provider)!=null&&o.shouldConnect?"connected":"disconnected";e({status:r.status,intent:s})}}providerConnectionErrorSubscription(e){return{on:()=>{this._provider.on("connection-error",e)},off:()=>{this._provider.off("connection-error",e)}}}providerStateSubscription(e){return{on:()=>{this._provider.on("status",this._injectIntent(e))},off:()=>{this._provider.off("status",this._injectIntent(e))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var vn=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Fa=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((s,o)=>{let c=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});c.onerror=()=>o(c.error),c.onsuccess=()=>s()})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{let l=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);l.onerror=()=>s(l.error),l.onsuccess=()=>r(l.result?l.result.contents:null)})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{let l=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);l.onerror=()=>s(l.error),l.onsuccess=()=>r()})}async close(){this.dbPromise&&((await this.dbPromise).close(),this.dbPromise=null)}};var xn=class extends Ys{constructor(t,r,s,o){let i=o.relayId?new dr(o.relayId,o.guid,r):new qn(o.guid,r);super(i,o.tokenStore,s);this.guid=r,this._parent=o,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault.app.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.setLoggers(`[SharedDoc](${this.path})`),this._persistence=new Is(this.guid,this.ydoc),this.ydoc.on("update",(l,c,f)=>{this.updateStats()}),this._tfile=null}setLoggers(t){this.debug=Q(t,"debug"),this.log=Q(t,"log"),this.warn=Q(t,"warn"),this.error=Q(t,"error")}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedDoc](${this.path})`),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}getInvalidLinks(){if(!this.tfile)return[];let t=this._parent.vault.app,r=t.metadataCache.getFileCache(this.tfile);if(!r||!r.links)return[];let s=[];return r.links.forEach(o=>{var l;let i=t.metadataCache.getFirstLinkpathDest(o.link,this.path);if(i&&!this._parent.checkPath(i.path)){let c=o.position.end.offset-2-(((l=o.displayText)==null?void 0:l.length)||1),f=o.position.end.offset-2;s.push({from:c,to:f})}}),s}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r,s=await this._parent.diskBufferStore.loadDiskBuffer(this.guid);return s!==null?r=s:r=await this._parent.read(this),this.setDiskBuffer(r)}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new vn(this._parent.vault.app.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid)}async checkStale(){await this.whenReady();let t=await this.diskBuffer();return this.text.trim()!==t.contents.trim()}connect(){return this.sharedFolder.s3rn instanceof bn?Promise.resolve(!1):(this.s3rn instanceof qn&&(this.sharedFolder.relayId?this.s3rn=new dr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new qn(this.sharedFolder.guid,this.guid)),this.sharedFolder.connect().then(t=>super.connect()))}async whenReady(){let t=[];return this._persistence.synced||t.push(this.whenSynced()),this._provider||t.push(this.withActiveProvider()),Promise.all(t).then(r=>this)}whenSynced(){return this._persistence.synced?Promise.resolve():new Promise(t=>{this._persistence.once("synced",t)})}hasKnownPeers(){return this._hasKnownPeers!==void 0?Promise.resolve(this._hasKnownPeers):this.whenSynced().then(async()=>(await Ls(this._persistence),this._hasKnownPeers=this._persistence._dbsize>3,this.log("update count",this.path,this._persistence._dbsize),this._hasKnownPeers))}destroy(){this._persistence&&this._persistence.destroy(),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0)}async read(){return this.text}async rename(t){this.move(t)}async delete(){this.destroy()}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Js=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(e,t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}};var mt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return mt.instance||(mt.instance=new mt(new Js),fr.set(this.instance,"postie")),mt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let s={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(s),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Q("[postie]","debug");for(let[t,r]of this.mailboxes){for(let s of r)t(s),e("send",s,t),this.deliveredMailLog.push({sender:s,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Q("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Q("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Q("[postie]","warn");e.forEach((r,s)=>{t(`Mail #${s+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let s=200,o=t.replace(/\s+/g," ").slice(0,s);return o.length===s&&(o+="..."),`AnonymousFunction(${o})`}static destroy(){mt.instance&&(mt.instance.mailboxes=null,mt.instance.allMailLog=[],mt.instance.deliveredMailLog=[],mt.instance.timeProvider.destroy(),mt.instance.timeProvider=null,mt.instance.isDelivering=!1,mt.instance.isInTransaction=!1,mt.instance.currentTransactionId=0,mt._destroyed=!0,mt.instance=void 0)}},zt=mt;zt._destroyed=!1;var hu=new Map;function gm(){for(let[,n]of hu)n();hu.clear()}var $t=class{constructor(e){this.observableName=e;let t=Q("[Observable]","warn");hu.set(this,()=>{this._listeners&&this._listeners.size>0&&t(`Missing tear down of ${this._listeners.size} listeners`,this,this._listeners)}),this._listeners=new Set}notifyListeners(){for(let e of this._listeners)zt.getInstance().send(this,e)}on(e){return this._listeners.add(e),()=>{this.off(e)}}subscribe(e){return this._listeners.add(e),zt.getInstance().send(this,e,!0),()=>{this.unsubscribe(e)}}off(e){this._listeners.delete(e)}unsubscribe(e){this._listeners.delete(e)}destroy(){this._listeners.clear(),this._listeners=null}};var Zo=class extends $t{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let s of this._set)t(s)&&r.push(s);return r}};var pu=require("obsidian");var Ma={enableUpdateYDocFromDiskBuffer:!1,enableInvalidLinkDecoration:!1,enableDiffResolution:!1,enableDownloadOnAddToVault:!1,enableUploadOnShare:!1,enableDocumentStatus:!1,enableFolderConnectionToggle:!1};function W1(){return new Proxy({},{get:(n,e)=>e})}var jr=W1();function Gr(n,e){et.getInstance().flags[n]&&e()}var et=class extends $t{constructor(){super();this.flags=Ma}static getInstance(){return et.instance||(et.instance=new et),et.instance}async setFlags(t,r=!1){let s=Object.keys(this.flags).reduce((o,i)=>(i in t&&(o[i]=t[i]),o),{});this.flags!==s&&(this.flags={...this.flags,...s},r&&this.notifyListeners())}getFlag(t){return this.flags[t]}setFlag(t,r,s=!1){this.flags[t]=r,s&&this.notifyListeners()}static destroy(){et.instance=null}};var mu=class extends Zo{constructor(){super(...arguments);this.notifyListeners=(0,Ct.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){return this._set.add(t),r&&this.notifyListeners(),this}},Ra=class extends Ys{constructor(t,r,s,o,i,l,c,f,d,p=!0){let g=d?new Gt(d,t):new bn(t);super(g,l,s);this.backgroundSync=f;this.readyPromise=null;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.vault.getFiles(),r=[],s=[];t.forEach(i=>{this.checkPath(i.path)&&(i instanceof Ct.TFolder||this.ids.has(i.path)||s.push(this.getVirtualPath(i.path)))});let o=this.placeHold(s);t.forEach(i=>{if(!this.checkPath(i.path)||i instanceof Ct.TFolder)return;let l=this.ids.get(this.getVirtualPath(i.path)),c=l&&o.contains(l)||!1,f=p=>{Gr(jr.enableUploadOnShare,()=>{this.backgroundSync.putDocument(p)})},d=this.createFile(i.path,c,!1,f);r.push(d)}),r.length>0&&this.docset.update()};this.log=Q("[SharedFolder]","log"),this.warn=Q("[SharedFolder]","warn"),this.debug=Q("[SharedFolder]","debug"),this.error=Q("[SharedFolder]","error"),this.guid=t,this.fileManager=i,this.vault=o,this.path=r,this.ids=this.ydoc.getMap("docs"),this.docs=new Map,this.docset=new mu,this.relayManager=c,this._awaitingUpdates=p,this.relayId=d,this.diskBufferStore=new Fa,this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(_=>{this.remote=_.find(y=>y.guid==this.guid)})),this._persistence=new Is(this.guid,this.ydoc),this._persistence.once("synced",()=>{this.log("",this.ids)}),s.loggedIn&&this.connect(),this.whenReady().then(()=>{this.addLocalDocs()}),this.ydoc.on("update",async(_,y,x)=>{y!=this&&(this.log("file tree",this._debugFileTree()),await this.syncFileTree(x))})}connect(){return this.s3rn instanceof Gt?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get settings(){return{guid:this.guid,path:this.path,relay:this.relayId}}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Gt(this.relayId,this.guid):new bn(this.guid),this.notifyListeners())}get ready(){let t=this._persistence.synced,r=this.synced&&this.connected;return t&&(!this._awaitingUpdates||r)}async awaitingUpdates(){return await this.whenSynced(),this._awaitingUpdates&&(await Ls(this._persistence),this.log("update count",this.path,this._persistence._dbsize),this._awaitingUpdates=this._persistence._dbsize<3),this._awaitingUpdates}async whenReady(){let t=async()=>await this.awaitingUpdates()?(await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Aa(t,()=>[this.ready,this]),this.readyPromise.getPromise()}_debugFileTree(){let t=new Map;return this.ydoc.getMap("docs")._map.forEach((r,s)=>{r.content instanceof cr?t.set(s,r.content.arr[0]):t.set(s,r.content)}),t}whenSynced(){return this._persistence.synced?new Promise(t=>{t()}):new Promise(t=>{this._persistence.once("synced",t)})}async _handleServerRename(t,r,s,o){o==null||o.push(`${s.path} was renamed to ${r}`);let i=(0,Xt.dirname)(r);this.existsSync(i)||(await this.mkdir(i),o==null||o.push(`creating directory ${i}`)),this.fileManager.renameFile(s,(0,Ct.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let s=this.createDoc(t,!1,!1),o=Promise.resolve(),i=(0,Xt.dirname)(t);this.existsSync(i)||(o=this.mkdir(i),r==null||r.push(`creating directory ${i}`));let l=pu.moment.now();await s.whenReady();let c=pu.moment.now();return this.debug(`receive delay: received content for ${s.path} after ${c-l}ms`,s.text.toString()),await o,this.flush(s,s.text.toString()),r==null||r.push(`created local file for remotely added doc ${t}`),s}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.ids.delete(t);return}}applyRemoteState(t,r,s,o){let i=this.docs.get(t);if(this.existsSync(r))return{op:"noop",path:r,promise:Promise.resolve()};if(s.has(t)&&i){let c=this.getPath(i.path),f=this.vault.getAbstractFileByPath(c);if(f){let d=this._handleServerRename(i,r,f,o);return{op:"rename",path:r,from:c,to:r,promise:d}}}let l=this._handleServerCreate(r,o);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let s=this.vault.getFiles(),o=[];return s.forEach(i=>{var d,p;let l=this.checkPath(i.path),c=t.contains(i.path.slice(this.path.length)),f=((d=this._provider)==null?void 0:d.synced)&&((p=this._persistence)==null?void 0:p.synced);if(l&&!c&&f){r.push(`deleted local file ${i.path} for remotely deleted doc`);let g=this.vault.adapter.trashLocal(i.path);o.push({op:"delete",path:i.path,promise:g})}}),o}async syncFileTree(t){let r=[],s=t.getMap("docs"),o=[];this.ydoc.transact(()=>{s.forEach((p,g)=>{this._assertNamespacing(g)});let d=new Set(this.ids.values());s.forEach((p,g)=>{this._assertNamespacing(g),r.push(this.applyRemoteState(p,g,d,o))})});let i=r.filter(d=>d.op==="create"),l=r.filter(d=>d.op==="rename"),c=r.map(d=>d.path);await Promise.all([...i,...l].map(d=>d.promise));let f=this.cleanupExtraLocalFiles(c,o);[...l,...i,...f].length>0&&this.docset.update(),this.log(`syncFileTree diff:
`+o.join(`
`))}read(t){let r=(0,Xt.join)(this.path,t.path);return this.vault.adapter.read((0,Ct.normalizePath)(r))}existsSync(t){let r=(0,Ct.normalizePath)((0,Xt.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Xt.join)(this.path,t.path);return this.vault.adapter.exists((0,Ct.normalizePath)(r))}flush(t,r){let s=(0,Xt.join)(this.path,t.path);return this.vault.adapter.write((0,Ct.normalizePath)(s),r)}getPath(t){return(0,Xt.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Xt.join)(this.path,t);return this.vault.adapter.mkdir((0,Ct.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Xt.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getFile(t,r=!0,s=!1,o=!0){let i=this.getVirtualPath(t);return this.getDoc(i,r,s,o)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof Ct.TFile?r:null}getDoc(t,r=!0,s=!1,o=!0){let i=this.ids.get(t);if(i!==void 0){let l=this.docs.get(i);return l!==void 0?(l.move(t),l):(this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,!1,o))}else{if(r)return this.log("[getDoc]: creating new shared ID for existing file"),this.createDoc(t,s,o);throw new Error("No shared doc for vpath: "+t)}}createFile(t,r=!1,s=!0,o=i=>{}){let i=this.getVirtualPath(t);return this.createDoc(i,r,s,o)}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(s=>{if(!this.ids.has(s)){this.debug("creating entirely new doc for",s);let o=$s();r.push(o),this.ids.set(s,o)}})},this),r}createDoc(t,r=!1,s=!0,o=i=>{}){!this.synced&&!this.ids.get(t)&&this.warn(`potential for document split at ${t}`);let i=this.ids.get(t),l;if(i===void 0){if(!r)throw new Error("attempting to create a new doc without a local file");l=$s(),this.ydoc.transact(()=>{this.ids.set(t,l)},this)}else l=i;let c=this.docs.get(l)||new xn(t,l,this.loginManager,this),f=c.hasKnownPeers(),d=this.awaitingUpdates();return r&&(async()=>{if(!await this.exists(c))return;let[g,_,y]=await Promise.all([this.read(c),f,d]),x=c.ydoc.getText("contents");!y&&!_&&g&&x.toString()!=g&&(this.log(`[${c.path}] No Known Peers: Syncing file into ytext.`),x.insert(0,g),o(c))})(),this.docs.set(l,c),this.docset.add(c,s),c}deleteFile(t){let r=this.getVirtualPath(t);return this.deleteDoc(r)}deleteDoc(t){let r=this.ids.get(t);r&&(this.ydoc.transact(()=>{var o;this.ids.delete(t);let s=(o=this.docs.get(r))==null?void 0:o.destroy();s&&this.docset.delete(s),this.docs.delete(r)},this),this.diskBufferStore.removeDiskBuffer(r))}renameFile(t,r){let s="",o="";try{s=this.getVirtualPath(t)}catch(i){this.log("Moving out of shared folder")}try{o=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!s&&!o))if(!o)this.assertPath(t),this.createDoc(s,!0,!0);else{let i=this.ids.get(o);if(!i)return;let l=this.docs.get(i);if(!s)this.ydoc.transact(()=>{this.ids.delete(o)},this),l&&(l.destroy(),this.docset.delete(l)),this.docs.delete(i);else{let c=this.ids.get(o);if(!c)return;this.ydoc.transact(()=>{this.ids.set(s,c),this.ids.delete(o),l&&l.move(s)},this)}}}destroy(){this.docs.forEach(t=>{t.destroy(),this.docs.delete(t.guid)}),super.destroy(),this._persistence&&this._persistence.destroy(),this.ydoc.destroy(),this.docset.clear(),this.unsubscribes.forEach(t=>{t()}),this.diskBufferStore.close(),this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.vault=null}},Pa=class extends Zo{constructor(t,r){super();this.relayManager=t;this.update=(0,Ct.debounce)(this.notifyListeners,100);this.folderBuilder=r,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(s=>{let o=!1;this.items().forEach(i=>{let l=s.find(c=>c.guid==i.guid);i.remote!=l&&(o=!0),i.remote=l}),o&&this.update()}))}toSettings(){return this.items().map(t=>t.settings)}delete(t){return t==null||t.destroy(),super.delete(t)}lookup(t){let r=this.find(s=>s.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.relayManager=null,this.folderBuilder=null}async _new(t,r,s,o){let i=this.find(d=>d.path==t&&d.guid==r);if(i)return i;let l=this.find(d=>d.guid==r);if(l)throw new Error(`This folder is already mounted at ${l.path}.`);if(this.find(d=>d.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let f=await this.folderBuilder(t,r,s,o);return this._set.add(f),f}async new(t,r,s,o){let i=await this._new(t,r,s,o);return this.notifyListeners(),i}};var Jm=require("@codemirror/state"),Xn=require("obsidian");function Z(){}function Ee(n,e){for(let t in e)n[t]=e[t];return n}function gu(n){return n()}function Oa(){return Object.create(null)}function Te(n){n.forEach(gu)}function tt(n){return typeof n=="function"}function te(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function ym(n){return Object.keys(n).length===0}function Et(n,...e){if(n==null){for(let r of e)r(void 0);return Z}let t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Re(n,e,t){n.$$.on_destroy.push(Et(e,t))}function Ve(n,e,t,r){if(n){let s=wm(n,e,t,r);return n[0](s)}}function wm(n,e,t,r){return n[1]&&r?Ee(t.ctx.slice(),n[1](r(e))):t.ctx}function He(n,e,t,r){if(n[2]&&r){let s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){let o=[],i=Math.max(e.dirty.length,s.length);for(let l=0;l<i;l+=1)o[l]=e.dirty[l]|s[l];return o}return e.dirty|s}return e.dirty}function We(n,e,t,r,s,o){if(s){let i=wm(e,t,r,o);n.p(i,s)}}function Ke(n){if(n.ctx.length>32){let e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Ge(n){let e={};for(let t in n)t[0]!=="$"&&(e[t]=n[t]);return e}function yu(n,e){let t={};e=new Set(e);for(let r in n)!e.has(r)&&r[0]!=="$"&&(t[r]=n[r]);return t}function qs(n){return n==null?"":n}function Qo(n,e,t){return n.set(t),e}var wu=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var js=class{constructor(e){at(this,"_listeners","WeakMap"in wu?new WeakMap:void 0);at(this,"_observer");at(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let s of t)js.entries.set(s.target,s),(r=this._listeners.get(s.target))==null||r(s)})}};js.entries="WeakMap"in wu?new WeakMap:void 0;var _m=!1;function bm(){_m=!0}function vm(){_m=!1}function J(n,e){n.appendChild(e)}function rt(n,e,t){let r=xm(n);if(!r.getElementById(e)){let s=L("style");s.id=e,s.textContent=t,J1(r,s)}}function xm(n){if(!n)return document;let e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function J1(n,e){return J(n.head||n,e),e.sheet}function T(n,e,t){n.insertBefore(e,t||null)}function E(n){n.parentNode&&n.parentNode.removeChild(n)}function Zt(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function L(n){return document.createElement(n)}function _u(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function ae(n){return document.createTextNode(n)}function q(){return ae(" ")}function $e(){return ae("")}function re(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function F(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function ei(n,e){for(let t in e)F(n,t,e[t])}function Sm(n){return Array.from(n.childNodes)}function we(n,e){e=""+e,n.data!==e&&(n.data=e)}function Qt(n,e){n.value=e==null?"":e}function bt(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,r?"important":"")}function bu(n,e,t){n.classList.toggle(e,!!t)}function Ia(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function km(n){let e={};return n.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}var Sn;function zr(n){Sn=n}function La(){if(!Sn)throw new Error("Function called outside component initialization");return Sn}function hr(n){La().$$.on_mount.push(n)}function vu(n){La().$$.on_destroy.push(n)}function pr(){let n=La();return(e,t,{cancelable:r=!1}={})=>{let s=n.$$.callbacks[e];if(s){let o=Ia(e,t,{cancelable:r});return s.slice().forEach(i=>{i.call(n,o)}),!o.defaultPrevented}return!0}}var jn=[];var Xs=[],zs=[],Cm=[],Z1=Promise.resolve(),Su=!1;function Em(){Su||(Su=!0,Z1.then($a))}function ti(n){zs.push(n)}var xu=new Set,Gs=0;function $a(){if(Gs!==0)return;let n=Sn;do{try{for(;Gs<jn.length;){let e=jn[Gs];Gs++,zr(e),Q1(e.$$)}}catch(e){throw jn.length=0,Gs=0,e}for(zr(null),jn.length=0,Gs=0;Xs.length;)Xs.pop()();for(let e=0;e<zs.length;e+=1){let t=zs[e];xu.has(t)||(xu.add(t),t())}zs.length=0}while(jn.length);for(;Cm.length;)Cm.pop()();Su=!1,xu.clear(),zr(n)}function Q1(n){if(n.fragment!==null){n.update(),Te(n.before_update);let e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(ti)}}function Tm(n){let e=[],t=[];zs.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),zs=e}var Ua=new Set,Gn;function xe(){Gn={r:0,c:[],p:Gn}}function Se(){Gn.r||Te(Gn.c),Gn=Gn.p}function k(n,e){n&&n.i&&(Ua.delete(n),n.i(e))}function A(n,e,t,r){if(n&&n.o){if(Ua.has(n))return;Ua.add(n),Gn.c.push(()=>{Ua.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}function ze(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Tt(n,e){let t={},r={},s={$$scope:1},o=n.length;for(;o--;){let i=n[o],l=e[o];if(l){for(let c in i)c in l||(r[c]=1);for(let c in l)s[c]||(t[c]=l[c],s[c]=1);n[o]=l}else for(let c in i)s[c]=1}for(let i in r)i in t||(t[i]=void 0);return t}function er(n){return typeof n=="object"&&n!==null?n:{}}var eS=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],tS=new Set([...eS]);function V(n){n&&n.c()}function N(n,e,t){let{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),ti(()=>{let o=n.$$.on_mount.map(gu).filter(tt);n.$$.on_destroy?n.$$.on_destroy.push(...o):Te(o),n.$$.on_mount=[]}),s.forEach(ti)}function B(n,e){let t=n.$$;t.fragment!==null&&(Tm(t.after_update),Te(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function nS(n,e){n.$$.dirty[0]===-1&&(jn.push(n),Em(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ie(n,e,t,r,s,o,i=null,l=[-1]){let c=Sn;zr(n);let f=n.$$={fragment:null,ctx:[],props:o,update:Z,not_equal:s,bound:Oa(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Oa(),dirty:l,skip_bound:!1,root:e.target||c.$$.root};i&&i(f.root);let d=!1;if(f.ctx=t?t(n,e.props||{},(p,g,..._)=>{let y=_.length?_[0]:g;return f.ctx&&s(f.ctx[p],f.ctx[p]=y)&&(!f.skip_bound&&f.bound[p]&&f.bound[p](y),d&&nS(n,p)),g}):[],f.update(),d=!0,Te(f.before_update),f.fragment=r?r(f.ctx):!1,e.target){if(e.hydrate){bm();let p=Sm(e.target);f.fragment&&f.fragment.l(p),p.forEach(E)}else f.fragment&&f.fragment.c();e.intro&&k(n.$$.fragment),N(n,e.target,e.anchor),vm(),$a()}zr(c)}var sS;typeof HTMLElement=="function"&&(sS=class extends HTMLElement{constructor(e,t,r){super();at(this,"$$ctor");at(this,"$$s");at(this,"$$c");at(this,"$$cn",!1);at(this,"$$d",{});at(this,"$$r",!1);at(this,"$$p_d",{});at(this,"$$l",{});at(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let s=this.$$c.$on(e,t);this.$$l_u.set(t,s)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(o){return()=>{let i;return{c:function(){i=L("slot"),o!=="default"&&F(i,"name",o)},m:function(f,d){T(f,i,d)},d:function(f){f&&E(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=km(this);for(let o of this.$$s)o in r&&(t[o]=[e(o)]);for(let o of this.attributes){let i=this.$$g_p(o.name);i in this.$$d||(this.$$d[i]=ku(i,o.value,this.$$p_d,"toProp"))}for(let o in this.$$p_d)!(o in this.$$d)&&this[o]!==void 0&&(this.$$d[o]=this[o],delete this[o]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let o in this.$$p_d)if(this.$$d[o]=this.$$c.$$.ctx[this.$$c.$$.props[o]],this.$$p_d[o].reflect){let i=ku(o,this.$$d[o],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[o].attribute||o):this.setAttribute(this.$$p_d[o].attribute||o,i)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let o in this.$$l)for(let i of this.$$l[o]){let l=this.$$c.$on(o,i);this.$$l_u.set(i,l)}this.$$l={}}}attributeChangedCallback(e,t,r){var s;this.$$r||(e=this.$$g_p(e),this.$$d[e]=ku(e,r,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function ku(n,e,t,r){var o;let s=(o=t[n])==null?void 0:o.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[n])return e;if(r==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var ne=class{constructor(){at(this,"$$");at(this,"$$set")}$destroy(){B(this,1),this.$destroy=Z}$on(e,t){if(!tt(t))return Z;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!ym(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Am="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Am);var oS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Cu=oS;function Dm(n,e,t){let r=n.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Eu(n){let e,t=[n[12]],r={};for(let s=0;s<t.length;s+=1)r=Ee(r,t[s]);return{c(){e=_u(n[11]),ei(e,r)},m(s,o){T(s,e,o)},p(s,o){ei(e,r=Tt(t,[o&32&&s[12]]))},d(s){s&&E(e)}}}function Fm(n){let e=n[11],t,r=n[11]&&Eu(n);return{c(){r&&r.c(),t=$e()},m(s,o){r&&r.m(s,o),T(s,t,o)},p(s,o){s[11]?e?te(e,s[11])?(r.d(1),r=Eu(s),e=s[11],r.c(),r.m(t.parentNode,t)):r.p(s,o):(r=Eu(s),e=s[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=s[11])},d(s){s&&E(t),r&&r.d(s)}}}function iS(n){let e,t,r,s,o,i=ze(n[5]),l=[];for(let g=0;g<i.length;g+=1)l[g]=Fm(Dm(n,i,g));let c=n[10].default,f=Ve(c,n,n[9],null),d=[Cu,n[7],{width:n[2]},{height:n[2]},{stroke:n[1]},{"stroke-width":r=n[4]?Number(n[3])*24/Number(n[2]):n[3]},{class:s=n[6]("lucide-icon","lucide",n[0]?`lucide-${n[0]}`:"",n[8].class)}],p={};for(let g=0;g<d.length;g+=1)p=Ee(p,d[g]);return{c(){e=_u("svg");for(let g=0;g<l.length;g+=1)l[g].c();t=$e(),f&&f.c(),ei(e,p)},m(g,_){T(g,e,_);for(let y=0;y<l.length;y+=1)l[y]&&l[y].m(e,null);J(e,t),f&&f.m(e,null),o=!0},p(g,[_]){if(_&32){i=ze(g[5]);let y;for(y=0;y<i.length;y+=1){let x=Dm(g,i,y);l[y]?l[y].p(x,_):(l[y]=Fm(x),l[y].c(),l[y].m(e,t))}for(;y<l.length;y+=1)l[y].d(1);l.length=i.length}f&&f.p&&(!o||_&512)&&We(f,c,g,g[9],o?He(c,g[9],_,null):Ke(g[9]),null),ei(e,p=Tt(d,[Cu,_&128&&g[7],(!o||_&4)&&{width:g[2]},(!o||_&4)&&{height:g[2]},(!o||_&2)&&{stroke:g[1]},(!o||_&28&&r!==(r=g[4]?Number(g[3])*24/Number(g[2]):g[3]))&&{"stroke-width":r},(!o||_&257&&s!==(s=g[6]("lucide-icon","lucide",g[0]?`lucide-${g[0]}`:"",g[8].class)))&&{class:s}]))},i(g){o||(k(f,g),o=!0)},o(g){A(f,g),o=!1},d(g){g&&E(e),Zt(l,g),f&&f.d(g)}}}function aS(n,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],s=yu(e,r),{$$slots:o={},$$scope:i}=e,{name:l=void 0}=e,{color:c="currentColor"}=e,{size:f=24}=e,{strokeWidth:d=2}=e,{absoluteStrokeWidth:p=!1}=e,{iconNode:g}=e,_=(...y)=>y.filter((x,C,v)=>Boolean(x)&&v.indexOf(x)===C).join(" ");return n.$$set=y=>{t(8,e=Ee(Ee({},e),Ge(y))),t(7,s=yu(e,r)),"name"in y&&t(0,l=y.name),"color"in y&&t(1,c=y.color),"size"in y&&t(2,f=y.size),"strokeWidth"in y&&t(3,d=y.strokeWidth),"absoluteStrokeWidth"in y&&t(4,p=y.absoluteStrokeWidth),"iconNode"in y&&t(5,g=y.iconNode),"$$scope"in y&&t(9,i=y.$$scope)},e=Ge(e),[l,c,f,d,p,g,_,s,e,i,o]}var Tu=class extends ne{constructor(e){super(),ie(this,e,aS,iS,te,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},tr=Tu;function lS(n){let e,t=n[2].default,r=Ve(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?He(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){A(r,s),e=!1},d(s){r&&r.d(s)}}}function cS(n){let e,t,r=[{name:"arrow-right-left"},n[1],{iconNode:n[0]}],s={$$slots:{default:[lS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new tr({props:s}),{c(){V(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&er(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){A(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function uS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Au=class extends ne{constructor(e){super(),ie(this,e,uS,cS,te,{})}},Du=Au;function fS(n){let e,t=n[2].default,r=Ve(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?He(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){A(r,s),e=!1},d(s){r&&r.d(s)}}}function dS(n){let e,t,r=[{name:"chevron-left"},n[1],{iconNode:n[0]}],s={$$slots:{default:[fS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new tr({props:s}),{c(){V(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&er(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){A(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function hS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"m15 18-6-6 6-6"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Fu=class extends ne{constructor(e){super(),ie(this,e,hS,dS,te,{})}},Mu=Fu;function pS(n){let e,t=n[2].default,r=Ve(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?He(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){A(r,s),e=!1},d(s){r&&r.d(s)}}}function mS(n){let e,t,r=[{name:"folder"},n[1],{iconNode:n[0]}],s={$$slots:{default:[pS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new tr({props:s}),{c(){V(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&er(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){A(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function gS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Ru=class extends ne{constructor(e){super(),ie(this,e,gS,mS,te,{})}},ri=Ru;function yS(n){let e,t=n[2].default,r=Ve(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?He(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){A(r,s),e=!1},d(s){r&&r.d(s)}}}function wS(n){let e,t,r=[{name:"layers"},n[1],{iconNode:n[0]}],s={$$slots:{default:[yS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new tr({props:s}),{c(){V(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&er(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){A(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function _S(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Pu=class extends ne{constructor(e){super(),ie(this,e,_S,wS,te,{})}},Xr=Pu;function bS(n){let e,t=n[2].default,r=Ve(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?He(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){A(r,s),e=!1},d(s){r&&r.d(s)}}}function vS(n){let e,t,r=[{name:"satellite"},n[1],{iconNode:n[0]}],s={$$slots:{default:[bS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new tr({props:s}),{c(){V(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&er(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){A(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function xS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Ou=class extends ne{constructor(e){super(),ie(this,e,xS,vS,te,{})}},mr=Ou;function SS(n){let e,t=n[2].default,r=Ve(t,n,n[3],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&8)&&We(r,t,s,s[3],e?He(t,s[3],o,null):Ke(s[3]),null)},i(s){e||(k(r,s),e=!0)},o(s){A(r,s),e=!1},d(s){r&&r.d(s)}}}function kS(n){let e,t,r=[{name:"settings"},n[1],{iconNode:n[0]}],s={$$slots:{default:[SS]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=Ee(s,r[o]);return e=new tr({props:s}),{c(){V(e.$$.fragment)},m(o,i){N(e,o,i),t=!0},p(o,[i]){let l=i&3?Tt(r,[r[0],i&2&&er(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(l.$$scope={dirty:i,ctx:o}),e.$set(l)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){A(e.$$.fragment,o),t=!1},d(o){B(e,o)}}}function CS(n,e,t){let{$$slots:r={},$$scope:s}=e,o=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return n.$$set=i=>{t(1,e=Ee(Ee({},e),Ge(i))),"$$scope"in i&&t(3,s=i.$$scope)},e=Ge(e),[o,e,r,s]}var Iu=class extends ne{constructor(e){super(),ie(this,e,CS,kS,te,{})}},Lu=Iu;function ES(n){rt(n,"svelte-2kz9o8","button.system3-connected.svelte-2kz9o8{color:var(--color-accent)}button.system3-disconnected.svelte-2kz9o8{color:var(--color-base-40)}button.notebook.svelte-2kz9o8{color:var(--color-base-30);background-color:transparent}")}function TS(n){let e,t,r,s;return t=new Xr({props:{class:"svg-icon inline-icon"}}),{c(){var o;e=L("button"),V(t.$$.fragment),F(e,"class","notebook clickable-icon view-action svelte-2kz9o8"),F(e,"aria-label","Tracking Changes"),F(e,"tabindex","0"),F(e,"data-filename",r=(o=n[0].view.file)==null?void 0:o.name)},m(o,i){T(o,e,i),N(t,e,null),s=!0},p(o,i){var l;(!s||i&1&&r!==(r=(l=o[0].view.file)==null?void 0:l.name))&&F(e,"data-filename",r)},i(o){s||(k(t.$$.fragment,o),s=!0)},o(o){A(t.$$.fragment,o),s=!1},d(o){o&&E(e),B(t)}}}function AS(n){let e,t,r,s,o,i,l,c,f,d,p;return t=new Xr({props:{class:"svg-icon inline-icon"}}),i=new mr({props:{class:"svg-icon inline-icon"}}),{c(){var g;e=L("button"),V(t.$$.fragment),s=q(),o=L("button"),V(i.$$.fragment),F(e,"class","hidden notebook clickable-icon view-action system3-view-action svelte-2kz9o8"),F(e,"aria-label","Tracking Changes"),F(e,"tabindex","0"),F(e,"data-filename",r=(g=n[0].view.file)==null?void 0:g.name),F(o,"class",l="system3-"+n[1].status+" clickable-icon view-action system3-view-action svelte-2kz9o8"),F(o,"aria-label",c=`${n[2].relay.name} (${n[1].status})`),F(o,"tabindex","0")},m(g,_){T(g,e,_),N(t,e,null),T(g,s,_),T(g,o,_),N(i,o,null),f=!0,d||(p=[re(o,"click",n[3]),re(o,"keypress",n[4])],d=!0)},p(g,_){var y;(!f||_&1&&r!==(r=(y=g[0].view.file)==null?void 0:y.name))&&F(e,"data-filename",r),(!f||_&2&&l!==(l="system3-"+g[1].status+" clickable-icon view-action system3-view-action svelte-2kz9o8"))&&F(o,"class",l),(!f||_&6&&c!==(c=`${g[2].relay.name} (${g[1].status})`))&&F(o,"aria-label",c)},i(g){f||(k(t.$$.fragment,g),k(i.$$.fragment,g),f=!0)},o(g){A(t.$$.fragment,g),A(i.$$.fragment,g),f=!1},d(g){g&&(E(e),E(s),E(o)),B(t),B(i),d=!1,Te(p)}}}function DS(n){let e,t,r,s,o=[AS,TS],i=[];function l(c,f){return c[2]?0:1}return e=l(n,-1),t=i[e]=o[e](n),{c(){t.c(),r=$e()},m(c,f){i[e].m(c,f),T(c,r,f),s=!0},p(c,[f]){let d=e;e=l(c,f),e===d?i[e].p(c,f):(xe(),A(i[d],1,1,()=>{i[d]=null}),Se(),t=i[e],t?t.p(c,f):(t=i[e]=o[e](c),t.c()),k(t,1),t.m(r.parentNode,r))},i(c){s||(k(t),s=!0)},o(c){A(t),s=!1},d(c){c&&E(r),i[e].d(c)}}}function FS(n,e,t){var r;let{view:s}=e,{document:o}=e,{state:i}=e,l;!((r=o==null?void 0:o.sharedFolder)===null||r===void 0)&&r.remote&&(l=o.sharedFolder.remote);let c={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},f=()=>{s.toggleConnection()},d=p=>{p.key==="Enter"&&f()};return n.$$set=p=>{"view"in p&&t(0,s=p.view),"document"in p&&t(5,o=p.document),"state"in p&&t(1,i=p.state)},[s,i,l,f,d,o]}var $u=class extends ne{constructor(e){super(),ie(this,e,FS,DS,te,{view:0,document:5,state:1},ES)}},Mm=$u;var Zs=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".bannerBox");r||(r=document.createElement("div"),r.classList.add("bannerBox"),e.insertBefore(r,t));let s=e.querySelector(".banner");if(!s){s=document.createElement("div"),s.classList.add("banner");let o=s.createSpan();o.setText(this.text),s.appendChild(o),r.appendChild(s);let i=async()=>{await this.onClick()&&this.destroy()};s.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".bannerBox");return t&&t.replaceChildren(),!0}};var Na=require("@codemirror/state"),Rm=require("@codemirror/view");var zn=Na.Facet.define({combine(n){return n[n.length-1]}}),Uu=Na.Annotation.define(),Nu=class{constructor(e){this.initialSet=!1;this.log=e=>{};var t;this.editor=e,this.connectionManager=this.editor.state.facet(zn),this.view=this.connectionManager.findView(e),this.view&&(this.log=Q(`[LiveCMPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`),this.log("created"),this.view.document&&(this.view.document.whenSynced().then(()=>{this.setBuffer()}),this._observer=(r,s)=>{if(s.origin!==this){let o=r.delta,i=[],l=0;for(let c=0;c<o.length;c++){let f=o[c];f.insert!=null?i.push({from:l,to:l,insert:f.insert}):f.delete!=null?(i.push({from:l,to:l+f.delete,insert:""}),l+=f.delete):f.retain!=null&&(l+=f.retain)}this.log("dispatch"),e.dispatch({changes:i,annotations:[Uu.of(this)]})}},this._ytext=this.view.document.ytext,this._ytext.observe(this._observer)))}setBuffer(){var e,t,r;return(e=this.view)!=null&&e.document&&((t=this.view)==null?void 0:t.document.text)!==this.editor.state.doc.toString()&&(this.log(`setting buffer ${(r=this.view)==null?void 0:r.document} ${this.editor}`),Bu(this.view)&&this.editor.state.doc.toString()!==""&&this.view.document.diskBuffer(!0).then(()=>{!this.view||!Bu(this.view)||(et.getInstance().flags.enableDiffResolution&&this.view.checkStale(),this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:this.view.document.text},annotations:[Uu.of(this)]}))})),!1}update(e){var s,o,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Uu)===this)return;let t=e.view;this.view=this.connectionManager.findView(t);let r=(o=(s=this.view)==null?void 0:s.document)==null?void 0:o.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((c,f,d,p,g)=>{let _=g.sliceString(0,g.length,`
`);c!==f&&r.delete(c+l,f-c),_.length>0&&r.insert(c+l,_),l+=_.length-(f-c)})},this))}destroy(){var e;this._observer&&((e=this._ytext)==null||e.unobserve(this._observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Pm=Rm.ViewPlugin.fromClass(Nu);var Ba=require("@codemirror/state"),Ut=require("@codemirror/view");var Om=Ut.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),MS=Ba.Annotation.define(),Vu=class extends Ut.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Lo("span",[St("class","cm-ySelectionCaret"),St("style",`background-color: ${this.color}; border-color: ${this.color}`)],[ks("\u2060"),Lo("div",[St("class","cm-ySelectionCaretDot")]),ks("\u2060"),Lo("div",[St("class","cm-ySelectionInfo")],[ks(this.name)]),ks("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Hu=class{constructor(e){var r;this.editor=e,this.decorations=Ba.RangeSet.of([]),this.connectionManager=this.editor.state.facet(zn);let t=this.connectionManager.findView(e);if(t&&t instanceof kn){this.view=t;let s=(r=this.view.document)==null?void 0:r._provider;this._listener=({added:o,updated:i,removed:l},c,f)=>{o.concat(i).concat(l).findIndex(p=>{var g;return p!==((g=this._awareness)==null?void 0:g.doc.clientID)})>=0&&e.dispatch({annotations:[MS.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener))}update(e){var f,d,p,g;let t=e.view;this.view=(f=this.connectionManager)==null?void 0:f.findView(t);let r=(p=(d=this.view)==null?void 0:d.document)==null?void 0:p.ytext;if(!(this.view&&r&&r.doc))return;let s=(g=this.view.document)==null?void 0:g._provider;if(!s)return;this._awareness=s.awareness;let o=this._awareness,i=r.doc,l=[],c=this._awareness.getLocalState();if(c!=null){let _=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),y=_?e.state.selection.main:null,x=c.cursor==null?null:Nc(c.cursor.anchor),C=c.cursor==null?null:Nc(c.cursor.head);if(y!=null){let v=Bc(r,y.anchor),D=Bc(r,y.head);(c.cursor==null||!Hc(x,v)||!Hc(C,D))&&o.setLocalStateField("cursor",{anchor:v,head:D})}else c.cursor!=null&&_&&o.setLocalStateField("cursor",null)}o.getStates().forEach((_,y)=>{if(y===o.doc.clientID)return;let x=_.cursor;if(x==null||x.anchor==null||x.head==null)return;let C=Vc(x.anchor,i),v=Vc(x.head,i);if(C==null||v==null||C.type!==r||v.type!==r)return;let{color:D="#30bced",name:Y="Anonymous"}=_.user||{},S=_.user&&_.user.colorLight||D+"33",M=hs(C.index,v.index),O=ir(C.index,v.index),U=e.view.state.doc.lineAt(M),I=e.view.state.doc.lineAt(O);if(U.number===I.number)l.push({from:M,to:O,value:Ut.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})});else{l.push({from:M,to:U.from+U.length,value:Ut.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})}),l.push({from:I.from,to:O,value:Ut.Decoration.mark({attributes:{style:`background-color: ${S}`},class:"cm-ySelection"})});for(let oe=U.number+1;oe<I.number;oe++){let ue=e.view.state.doc.line(oe).from;l.push({from:ue,to:ue,value:Ut.Decoration.line({attributes:{style:`background-color: ${S}`,class:"cm-yLineSelection"}})})}}l.push({from:v.index,to:v.index,value:Ut.Decoration.widget({side:v.index-C.index>0?-1:1,block:!1,widget:new Vu(D,Y)})})}),this.decorations=Ut.Decoration.set(l,!0)}},Im=Ut.ViewPlugin.fromClass(Hu,{decorations:n=>n.decorations});var Lm=require("@codemirror/state"),Zr=require("@codemirror/view");var sM=Lm.Annotation.define(),Wu=class{constructor(e){this.log=e=>{};this.offMetadataUpdates=()=>{};var s;this.editor=e,this.connectionManager=this.editor.state.facet(zn),this.decorations=Zr.Decoration.none,this.linkRanges=[];let t=(o,i,l)=>{var c,f;o===((f=(c=this.view)==null?void 0:c.document)==null?void 0:f.tfile)&&this.updateFromMetadata()},r=app.metadataCache.on("changed",t);if(this.offMetadataUpdates=()=>{app.metadataCache.offref(r)},et.getInstance().flags.enableInvalidLinkDecoration){if(!this.connectionManager){Q("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}if(this.view=this.connectionManager.findView(e),!this.view)return;this.log=Q(`[InvalidLinkPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{this.updateFromMetadata(),this.updateDecorations()})}}updateFromMetadata(){!this.view||!this.view.document||(this.linkRanges=this.view.document.getInvalidLinks())}updateDecorations(){if(!et.getInstance().flags.enableInvalidLinkDecoration){this.decorations=Zr.Decoration.none;return}let e=this.linkRanges.map(({from:t,to:r})=>Zr.Decoration.mark({class:"invalid-link",attributes:{title:"This link points outside the shared folder and may not be accessible to other users."}}).range(t,r));e?this.decorations=Zr.Decoration.set(e):this.decorations=Zr.Decoration.none}update(e){return this.connectionManager&&(this.view=this.connectionManager.findView(e.view)),e.docChanged&&(this.linkRanges=this.linkRanges.map(t=>{let r=e.changes.mapPos(t.from),s=e.changes.mapPos(t.to);return{from:r,to:s}}).filter(t=>t.from!==t.to).filter(t=>t.to<e.state.doc.length),this.updateDecorations()),this.decorations}destroy(){this.offMetadataUpdates(),this.decorations=Zr.Decoration.none,this.connectionManager=null,this.view=void 0,this.editor=null}},$m=Zr.ViewPlugin.fromClass(Wu,{decorations:n=>n.decorations});function Qr(){}Qr.prototype={diff:function(e,t){var r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.callback;typeof s=="function"&&(o=s,s={}),this.options=s;var i=this;function l(S){return o?(setTimeout(function(){o(void 0,S)},0),!0):S}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var c=t.length,f=e.length,d=1,p=c+f;s.maxEditLength&&(p=Math.min(p,s.maxEditLength));var g=(r=s.timeout)!==null&&r!==void 0?r:1/0,_=Date.now()+g,y=[{oldPos:-1,lastComponent:void 0}],x=this.extractCommon(y[0],t,e,0);if(y[0].oldPos+1>=f&&x+1>=c)return l([{value:this.join(t),count:t.length}]);var C=-1/0,v=1/0;function D(){for(var S=Math.max(C,-d);S<=Math.min(v,d);S+=2){var M=void 0,O=y[S-1],U=y[S+1];O&&(y[S-1]=void 0);var I=!1;if(U){var oe=U.oldPos-S;I=U&&0<=oe&&oe<c}var ue=O&&O.oldPos+1<f;if(!I&&!ue){y[S]=void 0;continue}if(!ue||I&&O.oldPos+1<U.oldPos?M=i.addToPath(U,!0,void 0,0):M=i.addToPath(O,void 0,!0,1),x=i.extractCommon(M,t,e,S),M.oldPos+1>=f&&x+1>=c)return l(RS(i,M.lastComponent,t,e,i.useLongestToken));y[S]=M,M.oldPos+1>=f&&(v=Math.min(v,S-1)),x+1>=c&&(C=Math.max(C,S+1))}d++}if(o)(function S(){setTimeout(function(){if(d>p||Date.now()>_)return o();D()||S()},0)})();else for(;d<=p&&Date.now()<=_;){var Y=D();if(Y)return Y}},addToPath:function(e,t,r,s){var o=e.lastComponent;return o&&o.added===t&&o.removed===r?{oldPos:e.oldPos+s,lastComponent:{count:o.count+1,added:t,removed:r,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:r,previousComponent:o}}},extractCommon:function(e,t,r,s){for(var o=t.length,i=r.length,l=e.oldPos,c=l-s,f=0;c+1<o&&l+1<i&&this.equals(t[c+1],r[l+1]);)c++,l++,f++;return f&&(e.lastComponent={count:f,previousComponent:e.lastComponent}),e.oldPos=l,c},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function RS(n,e,t,r,s){for(var o=[],i;e;)o.push(e),i=e.previousComponent,delete e.previousComponent,e=i;o.reverse();for(var l=0,c=o.length,f=0,d=0;l<c;l++){var p=o[l];if(p.removed){if(p.value=n.join(r.slice(d,d+p.count)),d+=p.count,l&&o[l-1].added){var _=o[l-1];o[l-1]=o[l],o[l]=_}}else{if(!p.added&&s){var g=t.slice(f,f+p.count);g=g.map(function(x,C){var v=r[d+C];return v.length>x.length?v:x}),p.value=n.join(g)}else p.value=n.join(t.slice(f,f+p.count));f+=p.count,p.added||(d+=p.count)}}var y=o[c-1];return c>1&&typeof y.value=="string"&&(y.added||y.removed)&&n.equals("",y.value)&&(o[c-2].value+=y.value,o.pop()),o}var iM=new Qr;function PS(n,e){if(typeof n=="function")e.callback=n;else if(n)for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}var Um=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Nm=/\S/,ju=new Qr;ju.equals=function(n,e){return this.options.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n===e||this.options.ignoreWhitespace&&!Nm.test(n)&&!Nm.test(e)};ju.tokenize=function(n){for(var e=n.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Um.test(e[t])&&Um.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Bm(n,e,t){return t=PS(t,{ignoreWhitespace:!0}),ju.diff(n,e,t)}var Gu=new Qr;Gu.tokenize=function(n){this.options.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));var e=[],t=n.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var s=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};function OS(n,e,t){return Gu.diff(n,e,t)}var IS=new Qr;IS.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var LS=new Qr;LS.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function Va(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Va=function(e){return typeof e}:Va=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Va(n)}function Ku(n){return $S(n)||US(n)||NS(n)||BS()}function $S(n){if(Array.isArray(n))return Yu(n)}function US(n){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(n))return Array.from(n)}function NS(n,e){if(n){if(typeof n=="string")return Yu(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Yu(n,e)}}function Yu(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function BS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var VS=Object.prototype.toString,ni=new Qr;ni.useLongestToken=!0;ni.tokenize=Gu.tokenize;ni.castInput=function(n){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,s=r===void 0?function(o,i){return typeof i=="undefined"?t:i}:r;return typeof n=="string"?n:JSON.stringify(Ju(n,null,null,s),s,"  ")};ni.equals=function(n,e){return Qr.prototype.equals.call(ni,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Ju(n,e,t,r,s){e=e||[],t=t||[],r&&(n=r(s,n));var o;for(o=0;o<e.length;o+=1)if(e[o]===n)return t[o];var i;if(VS.call(n)==="[object Array]"){for(e.push(n),i=new Array(n.length),t.push(i),o=0;o<n.length;o+=1)i[o]=Ju(n[o],e,t,r,s);return e.pop(),t.pop(),i}if(n&&n.toJSON&&(n=n.toJSON()),Va(n)==="object"&&n!==null){e.push(n),i={},t.push(i);var l=[],c;for(c in n)n.hasOwnProperty(c)&&l.push(c);for(l.sort(),o=0;o<l.length;o+=1)c=l[o],i[c]=Ju(n[c],e,t,r,c);e.pop(),t.pop()}else i=n;return i}var qu=new Qr;qu.tokenize=function(n){return n.slice()};qu.join=qu.removeEmpty=function(n){return n};function Vm(n,e,t,r,s,o,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var l=OS(t,r,i);if(!l)return;l.push({value:"",lines:[]});function c(v){return v.map(function(D){return" "+D})}for(var f=[],d=0,p=0,g=[],_=1,y=1,x=function(D){var Y=l[D],S=Y.lines||Y.value.replace(/\n$/,"").split(`
`);if(Y.lines=S,Y.added||Y.removed){var M;if(!d){var O=l[D-1];d=_,p=y,O&&(g=i.context>0?c(O.lines.slice(-i.context)):[],d-=g.length,p-=g.length)}(M=g).push.apply(M,Ku(S.map(function($){return(Y.added?"+":"-")+$}))),Y.added?y+=S.length:_+=S.length}else{if(d)if(S.length<=i.context*2&&D<l.length-2){var U;(U=g).push.apply(U,Ku(c(S)))}else{var I,oe=Math.min(S.length,i.context);(I=g).push.apply(I,Ku(c(S.slice(0,oe))));var ue={oldStart:d,oldLines:_-d+oe,newStart:p,newLines:y-p+oe,lines:g};if(D>=l.length-2&&S.length<=i.context){var se=/\n$/.test(t),ge=/\n$/.test(r),be=S.length==0&&g.length>ue.oldLines;!se&&be&&t.length>0&&g.splice(ue.oldLines,0,"\\ No newline at end of file"),(!se&&!be||!ge)&&g.push("\\ No newline at end of file")}f.push(ue),d=0,p=0,g=[]}_+=S.length,y+=S.length}},C=0;C<l.length;C++)x(C);return{oldFileName:n,newFileName:e,oldHeader:s,newHeader:o,hunks:f}}var Km=require("obsidian");var Ha=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Wa=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let s=0,o=0;for(let i=0;i<r.lines.length;i+=1){let l=r.lines[i];if(l.startsWith("+")||l.startsWith("-")){let c=i,f=c;for(;f<r.lines.length-1&&(r.lines[f+1].startsWith("+")||r.lines[f+1].startsWith("-"));)f+=1;let d=r.lines.slice(c,f+1).filter(g=>g.startsWith("-")).map(g=>g.slice(1)),p=r.lines.slice(c,f+1).filter(g=>g.startsWith("+")).map(g=>g.slice(1));t.push(new Ha({file1Start:r.oldStart+c-o-1,file2Start:r.newStart+c-s-1,file1Lines:d,file2Lines:p})),s+=d.length,o+=p.length,i+=f-c}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function zu(n){let e=n.fullText.split(`
`);return e.splice(n.position,0,n.newLine),e.join(`
`)}function si(n){let e=n.fullText.split(`
`);return n.newLine===""?e.splice(n.position,n.linesToReplace):e.splice(n.position,n.linesToReplace,n.newLine),e.join(`
`)}function oi(n){let e=n.fullText.split(`
`);return e.splice(n.position,n.count),e.join(`
`)}function Qs(n){return n!==""?n:"\u200E"}var gr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var Cn=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Xu=require("obsidian");var Wm=To(Hm());function Ya(n,e){let t=n.getText("contents"),r=t.toString(),s=new Wm.diff_match_patch,o=s.diff_main(r,e);s.diff_cleanupSemantic(o);let i=0,l=Q("[updateYDocFromDiskBuffer]","debug");l("Updating YDoc:"),l("Current content length:",r.length),l("Disk buffer length:",e.length),o.length!=0&&(n.transact(()=>{for(let[c,f]of o)switch(c){case 1:l(`Inserting "${f}" at position ${i}`),t.insert(i,f),i+=f.length;break;case 0:l(`Keeping "${f}" (length: ${f.length})`),i+=f.length;break;case-1:l(`Deleting "${f}" at position ${i}`),t.delete(i,f.length);break}}),l("Update complete. New content length:",t.toString().length))}var Ka=class{constructor(e,t,r){this.loginManager=e;this.timeProvider=t;this.sharedFolders=r;this.subscriptions=[];this.downloadQueue=[];this.log=Q("[BackgroundSync]","log");this.debug=Q("[BackgroundSync]","debug");this.error=Q("[BackgroundSync]","error");fr.set(this,"BackgroundSync")}enqueueDownload(e){this.downloadQueue.push(e)}async downloadItem(e){var i;let t=e.s3rn;this.log("[downloadItem]",`${Dr.encode(t)}`);let r;if(t instanceof dr)r=t.documentId;else if(t instanceof Gt)r=t.folderId;else throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s={Authorization:`Bearer ${(i=this.loginManager.user)==null?void 0:i.token}`},o=await(0,Xu.requestUrl)({url:`https://api.system3.md/relay/${t.relayId}/doc/${r}/as-update`,method:"GET",headers:s});return o.status===200?this.debug("[downloadItem]",r,o.status,o.text):this.error("[downloadItem]",r,o.status,o.text),o}async uploadItem(e){var l;let t=e.s3rn;this.log("[uploadItem]",`${Dr.encode(t)}`);let r;if(t instanceof dr)r=t.documentId;else if(t instanceof Gt)r=t.folderId;else throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s={Authorization:`Bearer ${(l=this.loginManager.user)==null?void 0:l.token}`,"Content-Type":"application/octet-stream"},o=Kn(e.ydoc),i=await(0,Xu.requestUrl)({url:`https://api.system3.md/relay/${t.relayId}/doc/${r}/update`,method:"POST",headers:s,body:o.buffer,throw:!1});return i.status===200?this.debug("[uploadItem]",r,i.status,i.text):this.error("[uploadItem]",r,i.status,i.text),i}async getDocument(e){try{let r=(await this.downloadItem(e)).arrayBuffer,s=new Uint8Array(r),o=sp(s);Wn(e.ydoc,s),e.sharedFolder.flush(e,e.text)}catch(t){console.error(t);return}}async putDocument(e){try{let t=await this.uploadItem(e);if(t.status!==200)throw new Error(`Failed to upload document: ${t.status} ${t.text}`)}catch(t){console.error(t);return}}async putFolderFiles(e){await e.whenReady(),this.log("[putFolderFiles]",`Uploading ${e.docset.size} items`);let t=1;for(let r of e.docset.items())await r.whenReady(),r.text&&await this.uploadItem(r),this.log("[putFolderFiles]",`${t}/${e.docset.size}`),t++}async getFolder(e){let r=(await this.downloadItem(e)).arrayBuffer,s=new Uint8Array(r);Wn(e.ydoc,s)}async getFolderFiles(e){await e.whenReady(),this.log("[getFolderFiles]",`Downloading ${e.docset.size} files`);let t=1;for(let r of e.docset.items())await this.getDocument(r),this.log("[getFolderFiles]",`${t}/${e.docset.size}`),t++}destroy(){this.loginManager=null,this.sharedFolders=null,this.subscriptions.forEach(e=>e()),this.downloadQueue=[]}};var Ja=class{constructor(e){this.difference=e.difference,this.file1=e.file1,this.file2=e.file2,this.file1Content=e.file1Content,this.file2Content=e.file2Content,this.triggerRebuild=e.triggerRebuild}async modify(e,t){if(e instanceof xn){Ya(e.ydoc,t);return}else if(e instanceof vn){e.contents=t;return}await app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,s=this.difference.file2Lines.length>0;s&&r?(new gr({text:"Accept Top",onClick:o=>this.acceptTopClick(o,this.difference)}).build(t),Cn.build(t),new gr({text:"Accept Bottom",onClick:o=>this.acceptBottomClick(o,this.difference)}).build(t),Cn.build(t),new gr({text:"Accept All",onClick:o=>this.acceptAllClick(o,this.difference)}).build(t),Cn.build(t),new gr({text:"Accept None",onClick:o=>this.acceptNoneClick(o,this.difference)}).build(t)):r?(new gr({text:`Accept from ${this.file1.name}`,onClick:o=>this.insertFile1Difference(o,this.difference)}).build(t),Cn.build(t),new gr({text:"Discard",onClick:o=>this.discardFile1Difference(o,this.difference)}).build(t)):s&&(new gr({text:`Accept from ${this.file2.name}`,onClick:o=>this.insertFile2Difference(o,this.difference)}).build(t),Cn.build(t),new gr({text:"Discard",onClick:o=>this.discardFile2Difference(o,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=si({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=si({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),s=si({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s);let o=si({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,o),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=oi({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let s=oi({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=zu({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=zu({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,s),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=oi({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=oi({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var to="system3-differences-view";async function Ym(n,e){n.detachLeavesOfType(to);let t=n.getLeaf(!0);t.setViewState({type:to,active:!0,state:e}),n.revealLeaf(t)}var qa=class extends Km.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];this.registerEvent(this.app.vault.on("modify",async r=>{var s,o;r!==((s=this.state)==null?void 0:s.file1)&&r!==((o=this.state)==null?void 0:o.file2)||(await this.updateState(),this.build())}))}async getContent(t){return t instanceof xn?t.text:t instanceof vn?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return to}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,s;if(((r=this.state)==null?void 0:r.file1)==null||((s=this.state)==null?void 0:s.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),console.log("file 1 content",this.file1Content),this.file2Content=await this.getContent(this.state.file2),console.log("file 2 content",this.file2Content),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(o=>o.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(o=>o.trimEnd());let t=Vm(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=Wa.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildLines(t),this.scrollToFirstDifference()}buildLines(t){var i,l,c;let r=0,s=0,o=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((l=this.file2Lines)==null?void 0:l.length)||0);for(;r<=o||s<=o;){let f=(c=this.fileDifferences)==null?void 0:c.differences.find(d=>d.file1Start===r&&d.file2Start===s);if(f!=null){let d=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(d,f),r+=f.file1Lines.length,s+=f.file2Lines.length}else{let d=r<=s?this.file1Lines[r]:this.file2Lines[s];t.createDiv({text:Qs(d),cls:"file-diff__line"}),r+=1,s+=1}}}buildDifferenceVisualizer(t,r){var s;(s=this.state)!=null&&s.showMergeOption&&new Ja({difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.build()}}).build(t);for(let o=0;o<r.file1Lines.length;o+=1){let i=r.file1Lines[o],l=r.file2Lines[o],c=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),f=this.buildDiffLine(i,l,"file-diff_top-line__character");(o<r.file1Lines.length-1||r.file2Lines.length!==0)&&c.classList.add("file-diff__no-bottom-border"),o!==0&&c.classList.add("file-diff__no-top-border"),c.appendChild(f)}for(let o=0;o<r.file2Lines.length;o+=1){let i=r.file1Lines[o],l=r.file2Lines[o],c=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),f=this.buildDiffLine(l,i,"file-diff_bottom-line__character");(o==0&&r.file1Lines.length>0||o>0)&&c.classList.add("file-diff__no-top-border"),o<r.file2Lines.length-1&&c.classList.add("file-diff__no-bottom-border"),c.appendChild(f)}}buildDiffLine(t,r,s){let o=document.createElement("div");if(t!=null&&t.length===0)o.textContent=Qs(t);else if(t!=null&&r!=null){let i=Bm(r,t);for(let l of i){if(l.removed)continue;let c=document.createElement("span");c.textContent=Qs(l.value),l.added&&c.classList.add(s),o.appendChild(c)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=Qs(t),i.classList.add(s),o.appendChild(i)}else o.textContent=Qs(t);return o}scrollToFirstDifference(){var s;if(((s=this.fileDifferences)==null?void 0:s.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var KS=20;function YS(n,e){var t,r,s,o;if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(((t=n[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((s=n[i].document)==null?void 0:s.path)!==((o=e[i].document)==null?void 0:o.path))return!1;return!0}var Zu=class{constructor(e,t,r){this.document=null;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new Zs(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function Bu(n){return n instanceof kn}var kn=class{constructor(e,t,r,s=!0,o=!0){this._parent=e,this.view=t,this.document=r,this.shouldConnect=s,this.canConnect=o,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new Zs(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new Zs(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Mm({target:e,anchor:e.firstChild,props:{view:this,document:this.document,state:this.document.state}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,document:this.document,state:t})})),this._viewActions.$set({view:this,document:this.document,state:this.document.state}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}checkStale(){this.document.checkStale().then(e=>{var t,r;e&&((t=this.document._diskBuffer)!=null&&t.contents)&&this.document.text?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0)})}attach(){return this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this.shouldConnect&&this.canConnect&&this._parent.networkStatus.online&&this.connect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect()}destroy(){this.release(),this.clearViewActions(),this._parent=null,this.view=null,this.document=null}},ja=class{constructor(e,t,r,s){this.offListeners=[];this.folderListeners=new Map;this.workspace=e,this.sharedFolders=t,this.views=[],this.extensions=[],this._compartment=new Jm.Compartment,this._activePromise=null,this._stale="",this.loginManager=r,this.networkStatus=s,this.refreshQueue=[],this.log=Q("[LiveViews]","log"),this.warn=Q("[LiveViews]","warn"),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let o=i=>(i.ready||i.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(l=>{this.views.forEach(c=>{var f;((f=c.document)==null?void 0:f.sharedFolder)===i&&c.offlineBanner()})}),i.docset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.on(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((i,l)=>{this.sharedFolders.has(l)||(i(),this.folderListeners.delete(l))}),this.sharedFolders.forEach(i=>{this.folderListeners.has(i)||this.folderListeners.set(i,o(i))})}))}openDiffView(e){Ym(this.workspace.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return this.workspace.iterateMarkdownViews(t=>{var o;let r=(o=t.file)==null?void 0:o.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),[...e].length==0?[]:[...e]}async foldersReady(){let e=new Set;if(this.workspace.iterateMarkdownViews(r=>{var i;let s=(i=r.file)==null?void 0:i.path;if(!s)return;let o=this.sharedFolders.lookup(s);o&&e.add(o)}),[...e].length==0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}getViews(){let e=[];return this.workspace.iterateMarkdownViews(t=>{var o;let r=(o=t.file)==null?void 0:o.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn){let i=s.getFile(r,!0,!0,!0),l=new kn(this,t,i);e.push(l)}else{let i=new Zu(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof kn).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=KS){let r=this.workspace.workspace.getActiveViewOfType(Xn.MarkdownView),s=0;for(let o of e)o instanceof kn&&(o.view===r?o.canConnect=!0:(o.canConnect=s<t,s++));return s>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${s-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(s=>{let o=e.find(i=>{if(s.document==i.document&&s.view==i.view)return!0});o?(r.push(s),e.remove(o)):t.push(s)}),e.forEach(s=>{r.push(s)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,s=Q(r,"warn");s("Refresh"),await this.foldersReady();let o=[];try{o=this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&o.length===0)return this.extensions.length!==0&&(s("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,c]=this.deduplicate(o);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&YS(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",d)}else{let d=await this.viewsReady(l);s("Ready Views",d);let p=await this.viewsAttachedWithConnectionPool(d);s("Attached Views",p),this.views=l}s("loading plugins"),this.load();let f=Xn.moment.utc();return s(`refresh completed in ${f.diff(t)}ms`,r),!0}async refresh(e,t=3e3){let r=Q(e,"warn"),s=Xn.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,s)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;)this.refreshQueue.length>2&&(r("refreshQueue size:",this.refreshQueue.length),this.refreshQueue.slice(-2)),Xn.Platform.isIosApp?(this._activePromise=this.refreshQueue.pop()().finally(()=>{this._activePromise=null}),await this._activePromise):(this._activePromise=Da(this.refreshQueue.pop()(),t).catch(o=>(this.warn(`[System 3][Relay][Live Views] refresh views timed out... timeout=${t}`,o),this._activePromise=null,!1)).finally(()=>{this._activePromise=null}),await this._activePromise);return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(zn.of(this)),Pm,Om,Im,$m]),this.workspace.updateOptions())}destroy(){this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this._compartment=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null}};var ii=require("obsidian");var qm=To(ba()),Ga=class extends un{constructor(t){super();this.app=t,this.adapter=t.vault.adapter}getName(){return this.app.vault.getName()}cachedRead(t){return this.app.vault.cachedRead(t)}get root(){let t=this.app.vault.adapter;if(t instanceof ii.FileSystemAdapter)return t.getBasePath();throw new Error("Unexpected Adapter")}fullPath(t){return qm.default.join(this.root,t)}getFiles(){return this.app.vault.getFiles()}getAbstractFileByPath(t){return this.app.vault.getAbstractFileByPath(t)}getFolderByPath(t){let r=this.app.vault.getAbstractFileByPath(t);return r instanceof ii.TFolder?r:null}rename(t,r){this.app.vault.rename(t,r)}createFolder(t){return this.app.vault.createFolder(t)}iterateFolders(t){function r(o){t(o),o.children.forEach(i=>{i instanceof ii.TFolder&&r(i)})}let s=this.app.vault.getRoot();r(s)}};var jm=require("obsidian"),za=class{constructor(e){this.workspace=e}iterateMarkdownViews(e){this.workspace.iterateAllLeaves(t=>{t.view instanceof jm.MarkdownView&&e(t.view)})}getActiveViewOfType(e){return this.workspace.getActiveViewOfType(e)}updateOptions(){this.workspace.updateOptions()}};var ro=require("obsidian");function JS(n){rt(n,"svelte-3npei9",".folder-icons.svelte-3npei9{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05)}.icon.svelte-3npei9{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-3npei9{color:var(--color-accent)}span.system3-disconnected.svelte-3npei9{color:var(--color-base-40)}span.notebook.svelte-3npei9{color:var(--color-accent)}span.hidden.svelte-3npei9{display:none}")}function qS(n){let e,t,r;return t=new Xr({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=L("span"),V(t.$$.fragment),F(e,"class","notebook icon svelte-3npei9"),F(e,"aria-label","Tracking Changes")},m(s,o){T(s,e,o),N(t,e,null),r=!0},p:Z,i(s){r||(k(t.$$.fragment,s),r=!0)},o(s){A(t.$$.fragment,s),r=!1},d(s){s&&E(e),B(t)}}}function jS(n){let e,t,r,s,o,i,l,c;return t=new Xr({props:{class:"inline-icon",style:"width: 0.8em"}}),o=new mr({props:{class:"inline-icon"}}),{c(){e=L("span"),V(t.$$.fragment),r=q(),s=L("span"),V(o.$$.fragment),F(e,"class","notebook icon hidden svelte-3npei9"),F(e,"aria-label","Tracking Changes"),F(s,"class",i="satellite icon system3-"+n[0]+" svelte-3npei9"),F(s,"aria-label",l=`${n[1].relay.name} (${n[0]})`)},m(f,d){T(f,e,d),N(t,e,null),T(f,r,d),T(f,s,d),N(o,s,null),c=!0},p(f,d){(!c||d&1&&i!==(i="satellite icon system3-"+f[0]+" svelte-3npei9"))&&F(s,"class",i),(!c||d&3&&l!==(l=`${f[1].relay.name} (${f[0]})`))&&F(s,"aria-label",l)},i(f){c||(k(t.$$.fragment,f),k(o.$$.fragment,f),c=!0)},o(f){A(t.$$.fragment,f),A(o.$$.fragment,f),c=!1},d(f){f&&(E(e),E(r),E(s)),B(t),B(o)}}}function GS(n){let e,t,r,s,o=[jS,qS],i=[];function l(c,f){return c[1]?0:1}return t=l(n,-1),r=i[t]=o[t](n),{c(){e=L("div"),r.c(),F(e,"class","folder-icons svelte-3npei9")},m(c,f){T(c,e,f),i[t].m(e,null),s=!0},p(c,[f]){let d=t;t=l(c,f),t===d?i[t].p(c,f):(xe(),A(i[d],1,1,()=>{i[d]=null}),Se(),r=i[t],r?r.p(c,f):(r=i[t]=o[t](c),r.c()),k(r,1),r.m(e,null))},i(c){s||(k(r),s=!0)},o(c){A(r),s=!1},d(c){c&&E(e),i[t].d()}}}function zS(n,e,t){let{status:r="disconnected"}=e,{remote:s}=e;return n.$$set=o=>{"status"in o&&t(0,r=o.status),"remote"in o&&t(1,s=o.remote)},[r,s]}var Qu=class extends ne{constructor(e){super(),ie(this,e,zS,GS,te,{status:0,remote:1},JS)}},Gm=Qu;var ef=class{constructor(e,t){this.el=e;let r=new MutationObserver((s,o)=>{for(let i of s)i.type==="childList"&&e.nextSibling&&(t(e),o.disconnect())});r.observe(e.parentElement,{childList:!0,subtree:!0}),this.mutationObserver=r}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},ai=class{visitFolder(e,t,r,s){return null}visitFile(e,t,r,s){return null}},tf=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new ef(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},rf=class extends ai{visitFolder(e,t,r,s){return s?r||new tf(t.selfEl,s):(r&&r.destroy(),null)}},nf=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.el.addClass("system3-pill"),this.pill=new Gm({target:this.el,props:{status:this.sharedFolder.state.status,remote:this.sharedFolder.remote}}),this.unsubscribe=this.sharedFolder.subscribe(this.el,r=>{this.pill.$set({status:r.status,remote:this.sharedFolder.remote})})}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},sf=class extends ai{visitFolder(e,t,r,s){return s?r||new nf(t.selfEl,s):(r&&r.destroy(),null)}},of=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,s=>{this.docStatus(s)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},af=class extends ai{visitFile(e,t,r,s){if(s)try{let o=s.ids.get(s.getVirtualPath(e.path));if(!o)return null;let i=s.docs.get(o);return i?r||new of(t.el,i,e):null}catch(o){return null}return r&&r.destroy(),null}},Xa=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let s of this.visitors)this.storage.set(s,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(o=>o.path===e.path),s=this.getFileExplorerItem(this.fileExplorer,e);s&&this.storage.forEach((o,i)=>{let l=o.get(s),c=i.visitFolder(e,s,l,r);l&&!c?o.delete(s):c&&o.set(s,c)}),e.children.forEach(o=>{if(o instanceof ro.TFolder)this.walk(o,r);else if(o instanceof ro.TFile){let i=this.getFileExplorerItem(this.fileExplorer,o);this.storage.forEach((l,c)=>{let f=l.get(i),d=c.visitFile(o,i,f,r||t);f&&!d?l.delete(i):d&&l.set(i,d)})}})}destory(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},Za=class{constructor(e,t,r){this.vault=e,this.workspace=t,this.sharedFolders=r,this.treeState=new Map,this.workspace.onLayoutReady(()=>this.refresh()),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Gr(jr.enableDocumentStatus,()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.docset.on(()=>{this.refresh()}))})}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new rf),e.push(new sf),Gr(jr.enableDocumentStatus,()=>{e.push(new af)}),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let s=this.treeState.get(r)||new Xa(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,s);for(let o of t){let i=this.vault.getAbstractFileByPath(o);i instanceof ro.TFolder&&s.walk(i)}}}refresh(){let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new Xa(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let s=this.vault.getAbstractFileByPath("/");s instanceof ro.TFolder&&r.walk(s)}}destroy(){this.offFolderListener(),this.offDocumentListeners.forEach(e=>e()),this.offDocumentListeners.clear(),this.treeState.forEach(e=>{e.destory()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null}};var Bg=require("obsidian");function ft(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function l(d){try{f(r.next(d))}catch(p){i(p)}}function c(d){try{f(r.throw(d))}catch(p){i(p)}}function f(d){d.done?o(d.value):s(d.value).then(l,c)}f((r=r.apply(n,e||[])).next())})}var Fr=require("obsidian");function zm(n,e,t){let r=n.slice();return r[5]=e[t],r}var XS=n=>({}),Xm=n=>({}),ZS=n=>({}),Zm=n=>({});function QS(n){let e;return{c(){e=ae(n[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&we(e,t[0])},d(t){t&&E(e)}}}function ek(n){let e,t=ze(n[1]),r=[];for(let s=0;s<t.length;s+=1)r[s]=Qm(zm(n,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=$e()},m(s,o){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(s,o);T(s,e,o)},p(s,o){if(o&2){t=ze(s[1]);let i;for(i=0;i<t.length;i+=1){let l=zm(s,t,i);r[i]?r[i].p(l,o):(r[i]=Qm(l),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(s){s&&E(e),Zt(r,s)}}}function Qm(n){let e;return{c(){e=L("div"),e.textContent=`${n[5]} `},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function tk(n){let e,t=n[1].length>0&&ek(n);return{c(){t&&t.c(),e=$e()},m(r,s){t&&t.m(r,s),T(r,e,s)},p(r,s){r[1].length>0&&t.p(r,s)},d(r){r&&E(e),t&&t.d(r)}}}function rk(n){let e,t,r,s,o,i,l,c,f=n[4].name,d=Ve(f,n,n[3],Zm),p=d||QS(n),g=n[4].description,_=Ve(g,n,n[3],Xm),y=_||tk(n),x=n[4].default,C=Ve(x,n,n[3],null);return{c(){e=L("div"),t=L("div"),r=L("div"),p&&p.c(),s=q(),o=L("div"),y&&y.c(),i=q(),l=L("div"),C&&C.c(),F(r,"class","setting-item-name"),bt(r,"display","grid"),bt(r,"align-items","center"),F(o,"class","setting-item-description"),F(t,"class","setting-item-info"),bt(t,"display","grid"),F(l,"class","setting-item-control"),F(e,"class","setting-item")},m(v,D){T(v,e,D),J(e,t),J(t,r),p&&p.m(r,null),J(t,s),J(t,o),y&&y.m(o,null),J(e,i),J(e,l),C&&C.m(l,null),c=!0},p(v,[D]){d?d.p&&(!c||D&8)&&We(d,f,v,v[3],c?He(f,v[3],D,ZS):Ke(v[3]),Zm):p&&p.p&&(!c||D&1)&&p.p(v,c?D:-1),_&&_.p&&(!c||D&8)&&We(_,g,v,v[3],c?He(g,v[3],D,XS):Ke(v[3]),Xm),C&&C.p&&(!c||D&8)&&We(C,x,v,v[3],c?He(x,v[3],D,null):Ke(v[3]),null)},i(v){c||(k(p,v),k(y,v),k(C,v),c=!0)},o(v){A(p,v),A(y,v),A(C,v),c=!1},d(v){v&&E(e),p&&p.d(v),y&&y.d(v),C&&C.d(v)}}}function nk(n,e,t){let{$$slots:r={},$$scope:s}=e,{name:o=""}=e,{description:i}=e,l=i!==void 0?i.split(`
`):[];return n.$$set=c=>{"name"in c&&t(0,o=c.name),"description"in c&&t(2,i=c.description),"$$scope"in c&&t(3,s=c.$$scope)},[o,l,i,s,r]}var lf=class extends ne{constructor(e){super(),ie(this,e,nk,rk,te,{name:0,description:2})}},_e=lf;function sk(n){let e,t,r,s,o,i,l,c,f,d,p=n[3].default,g=Ve(p,n,n[2],null);return{c(){e=L("div"),t=L("div"),r=L("div"),s=ae(n[0]),o=q(),i=L("div"),l=ae(n[1]),c=q(),f=L("div"),g&&g.c(),F(r,"class","setting-item-name"),F(i,"class","setting-item-description"),F(t,"class","setting-item-info"),F(f,"class","setting-item-control"),F(e,"class","setting-item setting-item-heading")},m(_,y){T(_,e,y),J(e,t),J(t,r),J(r,s),J(t,o),J(t,i),J(i,l),J(e,c),J(e,f),g&&g.m(f,null),d=!0},p(_,[y]){(!d||y&1)&&we(s,_[0]),(!d||y&2)&&we(l,_[1]),g&&g.p&&(!d||y&4)&&We(g,p,_,_[2],d?He(p,_[2],y,null):Ke(_[2]),null)},i(_){d||(k(g,_),d=!0)},o(_){A(g,_),d=!1},d(_){_&&E(e),g&&g.d(_)}}}function ok(n,e,t){let{$$slots:r={},$$scope:s}=e,{name:o}=e,{description:i=""}=e;return n.$$set=l=>{"name"in l&&t(0,o=l.name),"description"in l&&t(1,i=l.description),"$$scope"in l&&t(2,s=l.$$scope)},[o,i,s,r]}var cf=class extends ne{constructor(e){super(),ie(this,e,ok,sk,te,{name:0,description:1})}},nt=cf;function ik(n){rt(n,"svelte-11qoyvs",".callout.svelte-11qoyvs{mix-blend-mode:normal !important}")}function ak(n){let e,t,r,s,o,i,l,c,f,d,p=n[2].default,g=Ve(p,n,n[1],null);return{c(){e=L("div"),t=L("div"),r=L("div"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg>',s=q(),o=L("div"),i=ae(n[0]),l=q(),c=L("div"),f=L("p"),g&&g.c(),F(r,"class","callout-icon"),F(r,"dir","auto"),F(o,"class","callout-title-inner"),F(o,"dir","auto"),F(t,"class","callout-title"),F(t,"dir","auto"),F(f,"dir","auto"),F(c,"class","callout-content"),F(c,"dir","auto"),F(e,"data-callout-metadata",""),F(e,"data-callout-fold",""),F(e,"data-callout","callout"),F(e,"class","callout svelte-11qoyvs"),F(e,"dir","auto")},m(_,y){T(_,e,y),J(e,t),J(t,r),J(t,s),J(t,o),J(o,i),J(e,l),J(e,c),J(c,f),g&&g.m(f,null),d=!0},p(_,[y]){(!d||y&1)&&we(i,_[0]),g&&g.p&&(!d||y&2)&&We(g,p,_,_[1],d?He(p,_[1],y,null):Ke(_[1]),null)},i(_){d||(k(g,_),d=!0)},o(_){A(g,_),d=!1},d(_){_&&E(e),g&&g.d(_)}}}function lk(n,e,t){let{$$slots:r={},$$scope:s}=e,{title:o}=e;return n.$$set=i=>{"title"in i&&t(0,o=i.title),"$$scope"in i&&t(1,s=i.$$scope)},[o,s,r]}var uf=class extends ne{constructor(e){super(),ie(this,e,lk,ak,te,{title:0},ik)}},ff=uf;var no=[];function ck(n,e){return{subscribe:Je(n,e).subscribe}}function Je(n,e=Z){let t,r=new Set;function s(l){if(te(n,l)&&(n=l,t)){let c=!no.length;for(let f of r)f[1](),no.push(f,n);if(c){for(let f=0;f<no.length;f+=2)no[f][0](no[f+1]);no.length=0}}}function o(l){s(l(n))}function i(l,c=Z){let f=[l,c];return r.add(f),r.size===1&&(t=e(s,o)||Z),l(n),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:s,update:o,subscribe:i}}function li(n,e,t){let r=!Array.isArray(n),s=r?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let o=e.length<2;return ck(t,(i,l)=>{let c=!1,f=[],d=0,p=Z,g=()=>{if(d)return;p();let y=e(r?f[0]:f,i,l);o?i(y):p=tt(y)?y:Z},_=s.map((y,x)=>Et(y,C=>{f[x]=C,d&=~(1<<x),c&&g()},()=>{d|=1<<x}));return c=!0,g(),function(){Te(_),p(),c=!1}})}var eg=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let n=["fetch","Response","FormData","Request","Headers"];for(let e of n)globalThis[e]=globalThis[`blink${e}`]}}catch(n){console.error(n)}var Zn=async(n,e)=>{let t=n instanceof URL?n.toString():n,r=(e==null?void 0:e.method)||"GET",s={url:t,method:r,body:e==null?void 0:e.body,headers:e==null?void 0:e.headers,throw:!1},o;if(o=await(0,eg.requestUrl)(s),!o.arrayBuffer.byteLength)return new Response(null,{status:o.status,statusText:o.status.toString(),headers:new Headers(o.headers)});let i=new Response(o.arrayBuffer,{status:o.status,statusText:o.status.toString(),headers:new Headers(o.headers)});Object.defineProperty(i,"json",{value:async()=>JSON.parse(o.text)});let c=o.status>=500?"error":o.status>=400?"warn":"log",f=o.text;if(Q("[CustomFetch]",c)(o.status.toString(),r,t,f),o.status>=500)throw new Error(f);return i};function uk(n){rt(n,"svelte-1h8zaiy",".object-state-display.svelte-1h8zaiy{padding:10px;margin-top:10px;font-family:monospace}pre.svelte-1h8zaiy{white-space:pre-wrap;word-wrap:break-word}")}function fk(n){let e,t,r=Object.keys(n[0]).join(`
`)+"",s,o;return{c(){e=L("div"),t=L("pre"),s=ae(r),o=ae(`
        `),F(t,"class","svelte-1h8zaiy"),F(e,"class","object-state-display svelte-1h8zaiy")},m(i,l){T(i,e,l),J(e,t),J(t,s),J(t,o)},p(i,[l]){l&1&&r!==(r=Object.keys(i[0]).join(`
`)+"")&&we(s,r)},i:Z,o:Z,d(i){i&&E(e)}}}function dk(n,e,t){let{object:r}=e;return n.$$set=s=>{"object"in s&&t(0,r=s.object)},[r]}var df=class extends ne{constructor(e){super(),ie(this,e,dk,fk,te,{object:0},uk)}},tg=df;function hk(n){rt(n,"svelte-1xhkojk","#login-issues.svelte-1xhkojk{color:var(--color-base-40)}")}function pk(n){let e,t,r,s,o,i;e=new nt({props:{name:"Account",$$slots:{default:[wk]},$$scope:{ctx:n}}});let l=[bk,_k],c=[];function f(d,p){return d[2]?0:1}return r=f(n,[-1,-1]),s=c[r]=l[r](n),{c(){V(e.$$.fragment),t=q(),s.c(),o=$e()},m(d,p){N(e,d,p),T(d,t,p),c[r].m(d,p),T(d,o,p),i=!0},p(d,p){let g={};p[0]&4|p[1]&16384&&(g.$$scope={dirty:p,ctx:d}),e.$set(g);let _=r;r=f(d,p),r===_?c[r].p(d,p):(xe(),A(c[_],1,1,()=>{c[_]=null}),Se(),s=c[r],s?s.p(d,p):(s=c[r]=l[r](d),s.c()),k(s,1),s.m(o.parentNode,o))},i(d){i||(k(e.$$.fragment,d),k(s),i=!0)},o(d){A(e.$$.fragment,d),A(s),i=!1},d(d){d&&(E(t),E(o)),B(e,d),c[r].d(d)}}}function mk(n){var c;let e,t,r,s,o;e=new nt({props:{name:"Account"}}),r=new _e({props:{name:"Your account",description:"You are currently logged in as: "+((c=n[1].user)==null?void 0:c.name)+".",$$slots:{default:[Lk]},$$scope:{ctx:n}}});let i=n[31].default,l=Ve(i,n,n[45],null);return{c(){V(e.$$.fragment),t=q(),V(r.$$.fragment),s=q(),l&&l.c()},m(f,d){N(e,f,d),T(f,t,d),N(r,f,d),T(f,s,d),l&&l.m(f,d),o=!0},p(f,d){var g;let p={};d[0]&2&&(p.description="You are currently logged in as: "+((g=f[1].user)==null?void 0:g.name)+"."),d[1]&16384&&(p.$$scope={dirty:d,ctx:f}),r.$set(p),l&&l.p&&(!o||d[1]&16384)&&We(l,i,f,f[45],o?He(i,f[45],d,null):Ke(f[45]),null)},i(f){o||(k(e.$$.fragment,f),k(r.$$.fragment,f),k(l,f),o=!0)},o(f){A(e.$$.fragment,f),A(r.$$.fragment,f),A(l,f),o=!1},d(f){f&&(E(t),E(s)),B(e,f),B(r,f),l&&l.d(f)}}}function gk(n){let e,t,r,s,o;return{c(){e=L("a"),e.innerHTML="<span>Back</span>",t=ae(`
			|
			`),r=L("a"),r.innerHTML='<span><svg width="1em" height="1em" viewBox="0 -28.5 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"><g><path d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z" fill="#5865F2" fill-rule="nonzero"></path></g></svg></span>',F(e,"href","#standard"),F(e,"role","button"),F(e,"tabindex","0"),F(r,"href","https://discord.system3.md")},m(i,l){T(i,e,l),T(i,t,l),T(i,r,l),s||(o=[re(e,"keydown",n[35]),re(e,"click",n[36])],s=!0)},p:Z,d(i){i&&(E(e),E(t),E(r)),s=!1,Te(o)}}}function yk(n){let e,t,r,s,o,i,l;return{c(){e=L("span"),t=ae("login issues? try the "),r=L("a"),r.textContent="debug flow.",s=ae(`
			|
			`),o=L("a"),o.innerHTML='<span><svg width="1em" height="1em" viewBox="0 -28.5 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"><g><path d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z" fill="#5865F2" fill-rule="nonzero"></path></g></svg></span>',F(r,"href","#debug"),F(r,"role","button"),F(r,"tabindex","0"),F(e,"id","login-issues"),F(e,"class","svelte-1xhkojk"),F(o,"href","https://discord.system3.md")},m(c,f){T(c,e,f),J(e,t),J(e,r),T(c,s,f),T(c,o,f),i||(l=[re(r,"keypress",n[33]),re(r,"click",n[34])],i=!0)},p:Z,d(c){c&&(E(e),E(s),E(o)),i=!1,Te(l)}}}function wk(n){let e;function t(o,i){return o[2]?yk:gk}let r=t(n,[-1,-1]),s=r(n);return{c(){s.c(),e=$e()},m(o,i){s.m(o,i),T(o,e,i)},p(o,i){r===(r=t(o,i))&&s?s.p(o,i):(s.d(1),s=r(o),s&&(s.c(),s.m(e.parentNode,e)))},d(o){o&&E(e),s.d(o)}}}function _k(n){let e,t,r,s,o,i,l,c,f,d,p,g,_,y,x,C,v,D,Y,S,M,O,U,I,oe,ue,se;e=new ff({props:{title:"Get Help",$$slots:{default:[vk]},$$scope:{ctx:n}}});let ge=n[4]&&rg(n);s=new _e({props:{name:"Login",description:"Please complete the login flow in your browser and wait a few seconds.",$$slots:{default:[Sk]},$$scope:{ctx:n}}}),i=new _e({props:{name:"",description:`If your browser doesn't open, you can login manually by
			visiting this URL in your browser. Clicking will copy the link to your clipboard.`,$$slots:{default:[kk]},$$scope:{ctx:n}}}),c=new nt({props:{name:"Environment",$$slots:{default:[Ck]},$$scope:{ctx:n}}}),d=new _e({props:{name:"User Agent",description:"",$$slots:{default:[Ek]},$$scope:{ctx:n}}}),g=new _e({props:{name:"Fetch",description:"",$$slots:{default:[Tk]},$$scope:{ctx:n}}}),y=new _e({props:{name:"Response",description:"",$$slots:{default:[Ak]},$$scope:{ctx:n}}}),C=new _e({props:{name:"Blink Fetch",description:"",$$slots:{default:[Dk]},$$scope:{ctx:n}}}),D=new nt({props:{name:"Connections"}}),S=new tg({props:{object:n[9].cancelControllers}}),O=new nt({props:{name:"Advanced"}}),I=new _e({props:{name:"Debug logs",description:"Enable debug logs to help diagnose issues.",$$slots:{default:[Fk]},$$scope:{ctx:n}}});let be=n[11]&&ng(n);return{c(){V(e.$$.fragment),t=q(),ge&&ge.c(),r=q(),V(s.$$.fragment),o=q(),V(i.$$.fragment),l=q(),V(c.$$.fragment),f=q(),V(d.$$.fragment),p=q(),V(g.$$.fragment),_=q(),V(y.$$.fragment),x=q(),V(C.$$.fragment),v=q(),V(D.$$.fragment),Y=q(),V(S.$$.fragment),M=q(),V(O.$$.fragment),U=q(),V(I.$$.fragment),oe=q(),be&&be.c(),ue=$e()},m($,j){N(e,$,j),T($,t,j),ge&&ge.m($,j),T($,r,j),N(s,$,j),T($,o,j),N(i,$,j),T($,l,j),N(c,$,j),T($,f,j),N(d,$,j),T($,p,j),N(g,$,j),T($,_,j),N(y,$,j),T($,x,j),N(C,$,j),T($,v,j),N(D,$,j),T($,Y,j),N(S,$,j),T($,M,j),N(O,$,j),T($,U,j),N(I,$,j),T($,oe,j),be&&be.m($,j),T($,ue,j),se=!0},p($,j){let H={};j[1]&16384&&(H.$$scope={dirty:j,ctx:$}),e.$set(H),$[4]?ge?(ge.p($,j),j[0]&16&&k(ge,1)):(ge=rg($),ge.c(),k(ge,1),ge.m(r.parentNode,r)):ge&&(xe(),A(ge,1,1,()=>{ge=null}),Se());let z={};j[0]&32|j[1]&16384&&(z.$$scope={dirty:j,ctx:$}),s.$set(z);let ke={};j[0]&32|j[1]&16384&&(ke.$$scope={dirty:j,ctx:$}),i.$set(ke);let vt={};j[1]&16384&&(vt.$$scope={dirty:j,ctx:$}),c.$set(vt);let st={};j[1]&16384&&(st.$$scope={dirty:j,ctx:$}),d.$set(st);let yt={};j[0]&64|j[1]&16384&&(yt.$$scope={dirty:j,ctx:$}),g.$set(yt);let le={};j[0]&128|j[1]&16384&&(le.$$scope={dirty:j,ctx:$}),y.$set(le);let G={};j[0]&256|j[1]&16384&&(G.$$scope={dirty:j,ctx:$}),C.$set(G);let sn={};j[0]&512&&(sn.object=$[9].cancelControllers),S.$set(sn);let Ht={};j[0]&1024|j[1]&16384&&(Ht.$$scope={dirty:j,ctx:$}),I.$set(Ht),$[11]?be?(be.p($,j),j[0]&2048&&k(be,1)):(be=ng($),be.c(),k(be,1),be.m(ue.parentNode,ue)):be&&(xe(),A(be,1,1,()=>{be=null}),Se())},i($){se||(k(e.$$.fragment,$),k(ge),k(s.$$.fragment,$),k(i.$$.fragment,$),k(c.$$.fragment,$),k(d.$$.fragment,$),k(g.$$.fragment,$),k(y.$$.fragment,$),k(C.$$.fragment,$),k(D.$$.fragment,$),k(S.$$.fragment,$),k(O.$$.fragment,$),k(I.$$.fragment,$),k(be),se=!0)},o($){A(e.$$.fragment,$),A(ge),A(s.$$.fragment,$),A(i.$$.fragment,$),A(c.$$.fragment,$),A(d.$$.fragment,$),A(g.$$.fragment,$),A(y.$$.fragment,$),A(C.$$.fragment,$),A(D.$$.fragment,$),A(S.$$.fragment,$),A(O.$$.fragment,$),A(I.$$.fragment,$),A(be),se=!1},d($){$&&(E(t),E(r),E(o),E(l),E(f),E(p),E(_),E(x),E(v),E(Y),E(M),E(U),E(oe),E(ue)),B(e,$),ge&&ge.d($),B(s,$),B(i,$),B(c,$),B(d,$),B(g,$),B(y,$),B(C,$),B(D,$),B(S,$),B(O,$),B(I,$),be&&be.d($)}}}function bk(n){let e,t,r,s,o=[Pk,Rk],i=[];function l(c,f){return c[3]?1:0}return e=l(n,[-1,-1]),t=i[e]=o[e](n),{c(){t.c(),r=$e()},m(c,f){i[e].m(c,f),T(c,r,f),s=!0},p(c,f){let d=e;e=l(c,f),e===d?i[e].p(c,f):(xe(),A(i[d],1,1,()=>{i[d]=null}),Se(),t=i[e],t?t.p(c,f):(t=i[e]=o[e](c),t.c()),k(t,1),t.m(r.parentNode,r))},i(c){s||(k(t),s=!0)},o(c){A(t),s=!1},d(c){c&&E(r),i[e].d(c)}}}function vk(n){let e;return{c(){e=L("p"),e.innerHTML='We&#39;re working on improving the login process. Please <a href="https://discord.system3.md">join our Discord</a> and we will help you.'},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function rg(n){let e,t;return e=new ff({props:{title:"Error",$$slots:{default:[xk]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&16|s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function xk(n){let e,t;return{c(){e=L("p"),t=ae(n[4])},m(r,s){T(r,e,s),J(e,t)},p(r,s){s[0]&16&&we(t,r[4])},d(r){r&&E(e)}}}function Sk(n){let e,t,r,s,o,i;return{c(){e=L("a"),t=L("button"),r=ae("Login"),t.disabled=s=n[5]==="please wait...",F(e,"href",n[5]),F(e,"target","_blank")},m(l,c){T(l,e,c),J(e,t),J(t,r),o||(i=re(t,"click",n[39]),o=!0)},p(l,c){c[0]&32&&s!==(s=l[5]==="please wait...")&&(t.disabled=s),c[0]&32&&F(e,"href",l[5])},d(l){l&&E(e),o=!1,i()}}}function kk(n){let e,t,r;return{c(){e=L("input"),F(e,"type","text"),e.value=n[5],e.readOnly=!0,bt(e,"width","100%"),F(e,"id","system3AuthUrl")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[29])),t=!0)},p(s,o){o[0]&32&&e.value!==s[5]&&(e.value=s[5])},d(s){s&&E(e),t=!1,r()}}}function Ck(n){let e,t,r;return{c(){e=L("button"),e.textContent="Refresh"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[40])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Ek(n){let e=navigator.userAgent+"",t;return{c(){t=ae(e)},m(r,s){T(r,t,s)},p:Z,d(r){r&&E(t)}}}function Tk(n){let e;return{c(){e=ae(n[6])},m(t,r){T(t,e,r)},p(t,r){r[0]&64&&we(e,t[6])},d(t){t&&E(e)}}}function Ak(n){let e;return{c(){e=ae(n[7])},m(t,r){T(t,e,r)},p(t,r){r[0]&128&&we(e,t[7])},d(t){t&&E(e)}}}function Dk(n){let e;return{c(){e=ae(n[8])},m(t,r){T(t,e,r)},p(t,r){r[0]&256&&we(e,t[8])},d(t){t&&E(e)}}}function Fk(n){let e,t,r,s,o;return{c(){e=L("div"),t=L("input"),F(t,"type","checkbox"),F(t,"tabindex","0"),F(e,"aria-label","custom fetch can help avoid some network restrictions"),F(e,"role","checkbox"),F(e,"aria-checked",n[10]),F(e,"tabindex","0"),F(e,"class",r="checkbox-container mod-small "+(n[10]?"is-enabled":""))},m(i,l){T(i,e,l),J(e,t),t.checked=n[10],s||(o=[re(t,"change",n[41]),re(e,"click",n[42]),re(e,"keydown",(0,Fr.debounce)(n[43]))],s=!0)},p(i,l){l[0]&1024&&(t.checked=i[10]),l[0]&1024&&F(e,"aria-checked",i[10]),l[0]&1024&&r!==(r="checkbox-container mod-small "+(i[10]?"is-enabled":""))&&F(e,"class",r)},d(i){i&&E(e),s=!1,Te(o)}}}function ng(n){let e,t;return e=new _e({props:{name:"Check",description:"Click here once you've completed login",$$slots:{default:[Mk]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Mk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Check"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[44])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Rk(n){let e,t;return e=new _e({props:{name:"Login",description:"Please complete the login flow in your browser and wait a few seconds.",$$slots:{default:[Ok]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Pk(n){let e,t;return e=new _e({props:{name:"Login",description:"You need to login to use this plugin.",$$slots:{default:[Ik]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[1]&16384&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Ok(n){let e,t,r;return{c(){e=L("button"),e.textContent="Cancel",F(e,"class","mod-destructive")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[38])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Ik(n){let e,t,r;return{c(){e=L("button"),e.textContent="Login with Google"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[37])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Lk(n){let e,t,r;return{c(){e=L("button"),e.textContent="Logout"},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Fr.debounce)(n[32])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function $k(n){let e,t,r,s,o=[mk,pk],i=[];function l(c,f){return c[1].hasUser?0:1}return e=l(n,[-1,-1]),t=i[e]=o[e](n),{c(){t.c(),r=$e()},m(c,f){i[e].m(c,f),T(c,r,f),s=!0},p(c,f){let d=e;e=l(c,f),e===d?i[e].p(c,f):(xe(),A(i[d],1,1,()=>{i[d]=null}),Se(),t=i[e],t?t.p(c,f):(t=i[e]=o[e](c),t.c()),k(t,1),t.m(r.parentNode,r))},i(c){s||(k(t),s=!0)},o(c){A(t),s=!1},d(c){c&&E(r),i[e].d(c)}}}function hf(){try{return Response.toString()}catch(n){return"undefined"}}function sg(){try{return fetch.toString()}catch(n){return"undefined"}}function og(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(n){return"No"}}function Uk(n,e,t){let r,s,o=Z,i=()=>(o(),o=Et(S,R=>t(1,s=R)),S),l,c,f,d,p,g,_,y,x,C;n.$$.on_destroy.push(()=>o());let{$$slots:v={},$$scope:D}=e,{plugin:Y}=e,S,M=Je(!0);Re(n,M,R=>t(2,l=R));let O=Je(!1);Re(n,O,R=>t(3,c=R)),i(S=Y.loginManager);let U=Je(!1);Re(n,U,R=>t(11,C=R));let I=Je(!1),oe=Je(!1),ue=Je(!0);Re(n,ue,R=>t(48,r=R));let se=Je("please wait...");Re(n,se,R=>t(5,d=R));let ge,be,$=Je("");Re(n,$,R=>t(4,f=R));let j=Je(Y.settings.debugging);Re(n,j,R=>t(10,x=R));function H(){j.set(Y.toggleDebugging(!0))}function z(){return ft(this,void 0,void 0,function*(){yield Y.loginManager.logout(),I.set(!1),U.set(!1)})}function ke(){return ft(this,void 0,void 0,function*(){try{yield Y.loginManager.login()}catch(R){M.set(!1),I.set(!1)}})}let vt=Je(hf());Re(n,vt,R=>t(7,g=R));let st=Je(sg());Re(n,st,R=>t(6,p=R));let yt=Je(og());Re(n,yt,R=>t(8,_=R));let le=Je(Y.loginManager.pb);Re(n,le,R=>t(9,y=R));function G(){vt.set(hf()),st.set(sg()),yt.set(og()),le.set(Y.loginManager.pb)}function sn(){try{let R=r?Zn:fetch;ge=void 0,se.set("please wait..."),S.initiateManualOAuth2CodeFlow(R).then(([de,Ue,Ae])=>{ge=Ue,be=Ae,se.set(de)}).catch(de=>{let Ue=de.message;throw Ue=Ue+`
`+hf(),$.set(Ue),de})}catch(R){$.set(R.message)}}hr(()=>{I.set(!1),sn()});function Ht(){return ft(this,void 0,void 0,function*(){if(!(!ge||!be))return yield Y.loginManager.poll(ge,be).then(R=>{I.set(!0),$.set("")}).catch(R=>{U.set(!0),I.set(!1),$.set(R.message)})})}function Rr(R){let de=R.target;de.focus(),de.select(),navigator.clipboard.writeText(de.value).then(()=>new Fr.Notice("Invite link copied")).catch(Ue=>{}),Ht()}let rs=()=>{z()},ns=R=>{R.key==="Enter"&&Qo(M,l=!l,l)},lo=()=>{Qo(M,l=!l,l)},co=R=>{R.key==="Enter"&&Qo(M,l=!l,l)},uo=()=>{Qo(M,l=!l,l)},fo=async()=>{await ke()},ho=()=>{O.set(!1)},po=()=>{oe.set(!0),Ht()},mo=()=>{G()};function go(){x=this.checked,j.set(x)}let yo=()=>{H()},Pr=R=>{R.key==="Enter"&&H()},Ze=()=>{Ht()};return n.$$set=R=>{"plugin"in R&&t(30,Y=R.plugin),"$$scope"in R&&t(45,D=R.$$scope)},[S,s,l,c,f,d,p,g,_,y,x,C,M,O,U,oe,ue,se,$,j,H,z,ke,vt,st,yt,le,G,Ht,Rr,Y,v,rs,ns,lo,co,uo,fo,ho,po,mo,go,yo,Pr,Ze,D]}var pf=class extends ne{constructor(e){super(),ie(this,e,Uk,$k,te,{plugin:30},hk,[-1,-1])}},ig=pf;function Nk(n){let e,t,r,s,o;return t=new Lu({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=L("div"),V(t.$$.fragment),F(e,"class","clickable-icon extra-setting-button"),F(e,"aria-label","Options"),F(e,"role","button"),F(e,"tabindex","0")},m(i,l){T(i,e,l),N(t,e,null),r=!0,s||(o=[re(e,"click",n[0]),re(e,"keydown",n[0])],s=!0)},p:Z,i(i){r||(k(t.$$.fragment,i),r=!0)},o(i){A(t.$$.fragment,i),r=!1},d(i){i&&E(e),B(t),s=!1,Te(o)}}}function Bk(n){let e=pr();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var mf=class extends ne{constructor(e){super(),ie(this,e,Bk,Nk,te,{})}},Qn=mf;function ag(n){let e,t,r,s=n[0].remote.relay.name+"",o,i;return e=new Du({props:{class:"svg-icon",style:"margin: 0 1em"}}),r=new mr({props:{class:"svg-icon"}}),{c(){V(e.$$.fragment),t=q(),V(r.$$.fragment),o=ae(s)},m(l,c){N(e,l,c),T(l,t,c),N(r,l,c),T(l,o,c),i=!0},p(l,c){(!i||c&1)&&s!==(s=l[0].remote.relay.name+"")&&we(o,s)},i(l){i||(k(e.$$.fragment,l),k(r.$$.fragment,l),i=!0)},o(l){A(e.$$.fragment,l),A(r.$$.fragment,l),i=!1},d(l){l&&(E(t),E(o)),B(e,l),B(r,l)}}}function Vk(n){let e,t,r=n[0].name+"",s,o,i;t=new ri({props:{class:"svg-icon",style:"margin-right: .2em; width: 1em;"}});let l=n[0].remote&&ag(n);return{c(){e=L("span"),V(t.$$.fragment),s=ae(r),o=q(),l&&l.c(),bt(e,"display","inline-flex"),bt(e,"align-items","center")},m(c,f){T(c,e,f),N(t,e,null),J(e,s),J(e,o),l&&l.m(e,null),i=!0},p(c,[f]){(!i||f&1)&&r!==(r=c[0].name+"")&&we(s,r),c[0].remote?l?(l.p(c,f),f&1&&k(l,1)):(l=ag(c),l.c(),k(l,1),l.m(e,null)):l&&(xe(),A(l,1,1,()=>{l=null}),Se())},i(c){i||(k(t.$$.fragment,c),k(l),i=!0)},o(c){A(t.$$.fragment,c),A(l),i=!1},d(c){c&&E(e),B(t),l&&l.d()}}}function Hk(n,e,t){let{folder:r}=e;return n.$$set=s=>{"folder"in s&&t(0,r=s.folder)},[r]}var gf=class extends ne{constructor(e){super(),ie(this,e,Hk,Vk,te,{folder:0})}},lg=gf;var so=require("obsidian");function Wk(n){rt(n,"svelte-18nm1sp","input.system3-input-invalid.svelte-18nm1sp{border:1px solid var(--color-red) !important}")}function cg(n,e,t){let r=n.slice();return r[18]=e[t],r}function ug(n,e,t){let r=n.slice();return r[21]=e[t],r}function Kk(n){let e,t,r,s,o,i;return{c(){e=L("input"),r=q(),s=L("button"),s.textContent="Join relay",F(e,"type","text"),F(e,"placeholder","Enter share key"),F(e,"class",t=qs(n[2]?"system3-input-invalid":"")+" svelte-18nm1sp"),F(s,"class","mod-cta")},m(l,c){T(l,e,c),Qt(e,n[1]),T(l,r,c),T(l,s,c),o||(i=[re(e,"input",n[12]),re(e,"input",n[8]),re(s,"click",function(){tt((0,so.debounce)(n[13]))&&(0,so.debounce)(n[13]).apply(this,arguments)})],o=!0)},p(l,c){n=l,c&4&&t!==(t=qs(n[2]?"system3-input-invalid":"")+" svelte-18nm1sp")&&F(e,"class",t),c&2&&e.value!==n[1]&&Qt(e,n[1])},d(l){l&&(E(e),E(r),E(s)),o=!1,Te(i)}}}function Yk(n){let e,t;function r(){return n[14](n[21])}return e=new Qn({}),e.$on("settings",r),{c(){V(e.$$.fragment)},m(s,o){N(e,s,o),t=!0},p(s,o){n=s},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){A(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function Jk(n){let e,t,r=n[21].name+"",s,o;return t=new mr({props:{class:"svg-icon"}}),{c(){e=L("span"),V(t.$$.fragment),s=ae(r),F(e,"slot","name"),bt(e,"display","inline-flex")},m(i,l){T(i,e,l),N(t,e,null),J(e,s),o=!0},p(i,l){(!o||l&8)&&r!==(r=i[21].name+"")&&we(s,r)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){A(t.$$.fragment,i),o=!1},d(i){i&&E(e),B(t)}}}function fg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[Jk],default:[Yk]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&16777224&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function qk(n){let e,t,r;return{c(){e=L("button"),e.textContent="New relay",F(e,"class","mod-cta")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,so.debounce)(n[15])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function jk(n){let e,t,r;function s(){return n[16](n[18])}return e=new Qn({}),e.$on("settings",function(){tt((0,so.debounce)(s))&&(0,so.debounce)(s).apply(this,arguments)}),{c(){V(e.$$.fragment),t=q()},m(o,i){N(e,o,i),T(o,t,i),r=!0},p(o,i){n=o},i(o){r||(k(e.$$.fragment,o),r=!0)},o(o){A(e.$$.fragment,o),r=!1},d(o){o&&E(t),B(e,o)}}}function Gk(n){let e,t;return e=new lg({props:{folder:n[18],slot:"name"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&16&&(o.folder=r[18]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function dg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[Gk],default:[jk]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&16777240&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function zk(n){let e,t,r,s,o,i,l,c,f,d,p,g,_;e=new nt({props:{name:"Join a relay",description:""}}),r=new _e({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[Kk]},$$scope:{ctx:n}}}),o=new nt({props:{name:"Relays"}});let y=ze(n[3].values().sort(hg)),x=[];for(let S=0;S<y.length;S+=1)x[S]=fg(ug(n,y,S));let C=S=>A(x[S],1,1,()=>{x[S]=null});c=new _e({props:{name:"",description:"",$$slots:{default:[qk]},$$scope:{ctx:n}}}),d=new nt({props:{name:"Shared folders"}});let v=ze(n[4].items()),D=[];for(let S=0;S<v.length;S+=1)D[S]=dg(cg(n,v,S));let Y=S=>A(D[S],1,1,()=>{D[S]=null});return{c(){V(e.$$.fragment),t=q(),V(r.$$.fragment),s=q(),V(o.$$.fragment),i=q();for(let S=0;S<x.length;S+=1)x[S].c();l=q(),V(c.$$.fragment),f=q(),V(d.$$.fragment),p=q();for(let S=0;S<D.length;S+=1)D[S].c();g=$e()},m(S,M){N(e,S,M),T(S,t,M),N(r,S,M),T(S,s,M),N(o,S,M),T(S,i,M);for(let O=0;O<x.length;O+=1)x[O]&&x[O].m(S,M);T(S,l,M),N(c,S,M),T(S,f,M),N(d,S,M),T(S,p,M);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(S,M);T(S,g,M),_=!0},p(S,[M]){let O={};if(M&16777222&&(O.$$scope={dirty:M,ctx:S}),r.$set(O),M&72){y=ze(S[3].values().sort(hg));let I;for(I=0;I<y.length;I+=1){let oe=ug(S,y,I);x[I]?(x[I].p(oe,M),k(x[I],1)):(x[I]=fg(oe),x[I].c(),k(x[I],1),x[I].m(l.parentNode,l))}for(xe(),I=y.length;I<x.length;I+=1)C(I);Se()}let U={};if(M&16777216&&(U.$$scope={dirty:M,ctx:S}),c.$set(U),M&152){v=ze(S[4].items());let I;for(I=0;I<v.length;I+=1){let oe=cg(S,v,I);D[I]?(D[I].p(oe,M),k(D[I],1)):(D[I]=dg(oe),D[I].c(),k(D[I],1),D[I].m(g.parentNode,g))}for(xe(),I=v.length;I<D.length;I+=1)Y(I);Se()}},i(S){if(!_){k(e.$$.fragment,S),k(r.$$.fragment,S),k(o.$$.fragment,S);for(let M=0;M<y.length;M+=1)k(x[M]);k(c.$$.fragment,S),k(d.$$.fragment,S);for(let M=0;M<v.length;M+=1)k(D[M]);_=!0}},o(S){A(e.$$.fragment,S),A(r.$$.fragment,S),A(o.$$.fragment,S),x=x.filter(Boolean);for(let M=0;M<x.length;M+=1)A(x[M]);A(c.$$.fragment,S),A(d.$$.fragment,S),D=D.filter(Boolean);for(let M=0;M<D.length;M+=1)A(D[M]);_=!1},d(S){S&&(E(t),E(s),E(i),E(l),E(f),E(p),E(g)),B(e,S),B(r,S),B(o,S),Zt(x,S),B(c,S),B(d,S),Zt(D,S)}}}function hg(n,e){return n.owner&&!e.owner?-1:e.owner&&!n.owner||n.name>e.name?1:-1}function Xk(n,e,t){let r,s=Z,o=()=>(s(),s=Et(c,U=>t(3,r=U)),c),i;n.$$.on_destroy.push(()=>s());let{plugin:l}=e,{relays:c}=e;o();let f=l.sharedFolders;Re(n,f,U=>t(4,i=U));let d="",p=!1,g=pr();function _(U){U&&g("manageRelay",{relay:U})}function y(U,I){U&&g("manageSharedFolder",{folder:U,relay:I})}function x(){t(2,p=!1)}function C(U){return ft(this,void 0,void 0,function*(){try{let I=yield l.relayManager.acceptInvitation(U);g("joinRelay",{relay:I})}catch(I){t(2,p=!0)}})}function v(){g("createRelay")}function D(){d=this.value,t(1,d)}let Y=()=>C(d),S=U=>{_(U)},M=()=>v(),O=U=>{let I=r.values().find(oe=>{var ue;return((ue=U.remote)==null?void 0:ue.relay.guid)===oe.guid});y(U,I)};return n.$$set=U=>{"plugin"in U&&t(11,l=U.plugin),"relays"in U&&o(t(0,c=U.relays))},[c,d,p,r,i,f,_,y,x,C,v,l,D,Y,S,M,O]}var yf=class extends ne{constructor(e){super(),ie(this,e,Xk,zk,te,{plugin:11,relays:0},Wk)}},En=yf;function Zk(n){let e,t,r=n[0].name+"",s,o;return t=new ri({props:{class:"svg-icon",style:"margin-right: .2em; width: 1em;"}}),{c(){e=L("span"),V(t.$$.fragment),s=ae(r),bt(e,"display","inline-flex"),bt(e,"align-items","center")},m(i,l){T(i,e,l),N(t,e,null),J(e,s),o=!0},p(i,[l]){(!o||l&1)&&r!==(r=i[0].name+"")&&we(s,r)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){A(t.$$.fragment,i),o=!1},d(i){i&&E(e),B(t)}}}function Qk(n,e,t){let{folder:r}=e;return n.$$set=s=>{"folder"in s&&t(0,r=s.folder)},[r]}var wf=class extends ne{constructor(e){super(),ie(this,e,Qk,Zk,te,{folder:0})}},ci=wf;var Ye=require("obsidian");var Rg=To(ba());var el=require("obsidian");function eC(n){let e,t,r=n[0].shared&&pg(n);return{c(){e=L("div"),r&&r.c(),F(e,"class","suggestion-icon")},m(s,o){T(s,e,o),r&&r.m(e,null),t=!0},p(s,o){s[0].shared?r?o&1&&k(r,1):(r=pg(s),r.c(),k(r,1),r.m(e,null)):r&&(xe(),A(r,1,1,()=>{r=null}),Se())},i(s){t||(k(r),t=!0)},o(s){A(r),t=!1},d(s){s&&E(e),r&&r.d()}}}function tC(n){let e;return{c(){e=L("span"),e.textContent="Enter to create",F(e,"class","suggestion-action")},m(t,r){T(t,e,r)},p:Z,i:Z,o:Z,d(t){t&&E(e)}}}function pg(n){let e,t;return e=new Xr({props:{class:"svg-icon"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function rC(n){let e,t,r=n[0].folder+"",s,o,i,l,c,f,d=[tC,eC],p=[];function g(_,y){return _[0].exists?1:0}return l=g(n,-1),c=p[l]=d[l](n),{c(){e=L("div"),t=L("div"),s=ae(r),o=q(),i=L("div"),c.c(),F(t,"class","suggestion-title"),F(e,"class","suggestion-content"),F(i,"class","suggestion-aux")},m(_,y){T(_,e,y),J(e,t),J(t,s),T(_,o,y),T(_,i,y),p[l].m(i,null),f=!0},p(_,[y]){(!f||y&1)&&r!==(r=_[0].folder+"")&&we(s,r);let x=l;l=g(_,y),l===x?p[l].p(_,y):(xe(),A(p[x],1,1,()=>{p[x]=null}),Se(),c=p[l],c?c.p(_,y):(c=p[l]=d[l](_),c.c()),k(c,1),c.m(i,null))},i(_){f||(k(c),f=!0)},o(_){A(c),f=!1},d(_){_&&(E(e),E(o),E(i)),p[l].d()}}}function nC(n,e,t){let{suggestion:r}=e;return n.$$set=s=>{"suggestion"in s&&t(0,r=s.suggestion)},[r]}var _f=class extends ne{constructor(e){super(),ie(this,e,nC,rC,te,{suggestion:0})}},mg=_f;var Qa=class extends el.SuggestModal{constructor(t,r,s){super(t);this.sharedFolders=r;this.onChoose=s;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(o=>o.path)),this.hasRemotes=new Set(this.sharedFolders.filter(o=>o.remote!==void 0).map(o=>o.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?-1:!t.exists&&r.exists?1:t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(l=>{l.$destroy()});let r=t.toLowerCase(),s=[],o=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!o&&s.push({folder:t,exists:!1,shared:!1});let i=l=>{let c=this.sharedPaths.has(l.path),f=this.hasRemotes.has(l.path);if(l.path.toLowerCase().contains(r)&&l.path.length>1&&!f&&s.push({folder:l.path,exists:!0,shared:c}),!c)for(let d of l.children)d instanceof el.TFolder&&i(d)};return i(this.app.vault.getRoot()),s.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let s=new mg({target:r,props:{suggestion:t}});this.components.push(s)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var vg=require("obsidian");var vf=require("obsidian");var gg=require("obsidian"),yg=require("obsidian"),tl=class extends yg.AbstractInputSuggest{constructor(t,r,s){super(t,s);this.app=t;this.sharedFolders=r;this.inputEl=s;this.sharedPaths=new Set(this.sharedFolders.map(o=>o.path))}getSuggestions(t){let r=t.toLowerCase(),s=[],o=i=>{if(!this.sharedPaths.has(i.path)){i.path.toLowerCase().contains(r)&&s.push(i.path);for(let c of i.children)c instanceof gg.TFolder&&o(c)}};return o(this.app.vault.getRoot()),s}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function sC(n){let e,t,r,s;return{c(){e=L("div"),t=L("input"),F(t,"type","text"),F(t,"placeholder","/"),F(e,"class","folder-suggest-container")},m(o,i){T(o,e,i),J(e,t),n[5](t),Qt(t,n[2]),r||(s=[re(t,"input",oC),re(t,"input",n[6])],r=!0)},p(o,[i]){i&4&&t.value!==o[2]&&Qt(t,o[2])},i:Z,o:Z,d(o){o&&E(e),n[5](null),r=!1,Te(s)}}}function oC(){}function iC(n,e,t){let r,s=Z,o=()=>(s(),s=Et(d,_=>t(2,r=_)),d);n.$$.on_destroy.push(()=>s());let{app:i}=e,l,c,{sharedFolders:f}=e,{selectedFolder:d=Je()}=e;o(),hr(()=>{c=new tl(i,f,l);let _=y=>{o(t(0,d=y.detail.folder.path))};return l.addEventListener("folder-selected",_),()=>{l.removeEventListener("folder-selected",_)}}),vu(()=>{c&&c.close()});function p(_){Xs[_?"unshift":"push"](()=>{l=_,t(1,l)})}function g(){r=this.value,d.set(r)}return n.$$set=_=>{"app"in _&&t(3,i=_.app),"sharedFolders"in _&&t(4,f=_.sharedFolders),"selectedFolder"in _&&o(t(0,d=_.selectedFolder))},[d,l,r,i,f,p,g]}var bf=class extends ne{constructor(e){super(),ie(this,e,iC,sC,te,{app:3,sharedFolders:4,selectedFolder:0})}},wg=bf;function aC(n){rt(n,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function lC(n){let e,t,r;return{c(){e=L("input"),F(e,"type","text")},m(s,o){T(s,e,o),Qt(e,n[4]),t||(r=re(e,"input",n[8]),t=!0)},p(s,o){o&16&&e.value!==s[4]&&Qt(e,s[4])},d(s){s&&E(e),t=!1,r()}}}function cC(n){let e,t;return e=new wg({props:{app:n[0],sharedFolders:n[2],selectedFolder:n[7]}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.app=r[0]),s&4&&(o.sharedFolders=r[2]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function _g(n){let e,t;return{c(){e=L("span"),t=ae(n[5]),F(e,"class","mod-warning error svelte-hgd3zf")},m(r,s){T(r,e,s),J(e,t)},p(r,s){s&32&&we(t,r[5])},d(r){r&&E(e)}}}function uC(n){let e,t,r,s,o,i,l,c,f,d,p,g,_;s=new _e({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[lC]},$$scope:{ctx:n}}}),i=new _e({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[cC]},$$scope:{ctx:n}}});let y=n[5]&&_g(n);return{c(){e=L("div"),e.textContent="Add to vault",t=q(),r=L("div"),V(s.$$.fragment),o=q(),V(i.$$.fragment),l=q(),c=L("div"),y&&y.c(),f=q(),d=L("button"),d.textContent="Confirm",F(e,"class","modal-title"),F(d,"class","mod-cta"),F(c,"class","modal-button-container"),F(r,"class","modal-content")},m(x,C){T(x,e,C),T(x,t,C),T(x,r,C),N(s,r,null),J(r,o),N(i,r,null),J(r,l),J(r,c),y&&y.m(c,null),J(c,f),J(c,d),p=!0,g||(_=re(d,"click",function(){tt((0,vf.debounce)(n[9]))&&(0,vf.debounce)(n[9]).apply(this,arguments)}),g=!0)},p(x,[C]){n=x;let v={};C&1040&&(v.$$scope={dirty:C,ctx:n}),s.$set(v);let D={};C&1029&&(D.$$scope={dirty:C,ctx:n}),i.$set(D),n[5]?y?y.p(n,C):(y=_g(n),y.c(),y.m(c,f)):y&&(y.d(1),y=null)},i(x){p||(k(s.$$.fragment,x),k(i.$$.fragment,x),p=!0)},o(x){A(s.$$.fragment,x),A(i.$$.fragment,x),p=!1},d(x){x&&(E(e),E(t),E(r)),B(s),B(i),y&&y.d(),g=!1,_()}}}function fC(n,e,t){let r,{app:s}=e,{remoteFolder:o}=e,{sharedFolders:i}=e,{onConfirm:l}=e,c=o.name,f=Je();Re(n,f,_=>t(6,r=_));let d="";function p(){c=this.value,t(4,c)}let g=async()=>{l(o,c,r||"").catch(_=>{t(5,d=_.message)})};return n.$$set=_=>{"app"in _&&t(0,s=_.app),"remoteFolder"in _&&t(1,o=_.remoteFolder),"sharedFolders"in _&&t(2,i=_.sharedFolders),"onConfirm"in _&&t(3,l=_.onConfirm)},[s,o,i,l,c,d,r,f,p,g]}var xf=class extends ne{constructor(e){super(),ie(this,e,fC,uC,te,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},aC)}},bg=xf;var rl=class extends vg.Modal{constructor(t,r,s,o){super(t);this.sharedFolders=r;this.remoteFolder=s;this.onConfirm=o;this.onConfirm=o}onOpen(){let{contentEl:t}=this;this.component=new bg({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,s,o)=>{await this.onConfirm(r,s,o),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var kf=To(xg());function dC(n){rt(n,"svelte-1y54kws",".system3-settings-danger-zone.svelte-1y54kws{margin-top:6em}input.system3-updating.svelte-1y54kws{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-1y54kws{border:1px solid var(--color-red) !important}")}function Sg(n,e,t){let r=n.slice();return r[47]=e[t],r}function kg(n,e,t){let r=n.slice();return r[50]=e[t],r}function Cg(n){let e,t;return e=new _e({props:{name:"Relay name",description:"Set the relay name.",$$slots:{default:[hC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&297|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function hC(n){let e,t,r,s;return{c(){e=L("input"),F(e,"type","text"),F(e,"spellcheck","false"),F(e,"placeholder","Example: Shared Notes"),F(e,"class",t=qs((n[8]?"system3-updating":"")+(n[5]?"":" system3-input-invalid"))+" svelte-1y54kws")},m(o,i){T(o,e,i),Qt(e,n[0].name),n[34](e),r||(s=[re(e,"input",n[33]),re(e,"input",n[25])],r=!0)},p(o,i){i[0]&288&&t!==(t=qs((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-1y54kws")&&F(e,"class",t),i[0]&1&&e.value!==o[0].name&&Qt(e,o[0].name)},d(o){o&&E(e),n[34](null),r=!1,Te(s)}}}function pC(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[yC],default:[gC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&512|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function mC(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[_C],default:[wC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&1536|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function gC(n){let e,t,r;function s(){return n[36](n[50])}return{c(){e=L("button"),e.textContent="Add to Vault",F(e,"class","mod-cta"),F(e,"aria-label","Add shared folder to vault")},m(o,i){T(o,e,i),t||(r=re(e,"click",function(){tt((0,Ye.debounce)(s))&&(0,Ye.debounce)(s).apply(this,arguments)}),t=!0)},p(o,i){n=o},d(o){o&&E(e),t=!1,r()}}}function yC(n){let e,t;return e=new ci({props:{folder:n[50],slot:"name"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&512&&(o.folder=r[50]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function wC(n){let e,t;function r(){return n[35](n[50])}return e=new Qn({}),e.$on("settings",function(){tt((0,Ye.debounce)(r))&&(0,Ye.debounce)(r).apply(this,arguments)}),{c(){V(e.$$.fragment)},m(s,o){N(e,s,o),t=!0},p(s,o){n=s},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){A(e.$$.fragment,s),t=!1},d(s){B(e,s)}}}function _C(n){let e,t;return e=new ci({props:{folder:n[50],slot:"name"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&512&&(o.folder=r[50]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function Eg(n){let e,t,r,s,o;function i(...d){return n[32](n[50],...d)}let l=[mC,pC],c=[];function f(d,p){return p[0]&1536&&(e=null),e==null&&(e=!!d[10].find(i)),e?0:1}return t=f(n,[-1,-1]),r=c[t]=l[t](n),{c(){r.c(),s=$e()},m(d,p){c[t].m(d,p),T(d,s,p),o=!0},p(d,p){n=d;let g=t;t=f(n,p),t===g?c[t].p(n,p):(xe(),A(c[g],1,1,()=>{c[g]=null}),Se(),r=c[t],r?r.p(n,p):(r=c[t]=l[t](n),r.c()),k(r,1),r.m(s.parentNode,s))},i(d){o||(k(r),o=!0)},o(d){A(r),o=!1},d(d){d&&E(s),c[t].d(d)}}}function bC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Add",F(e,"class","mod-cta"),F(e,"aria-label","Select a folder to add to the relay")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[37])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function vC(n){let e=n[11].values().length+"",t,r,s=n[7].user_limit+"",o;return{c(){t=ae(e),r=ae(" / "),o=ae(s)},m(i,l){T(i,t,l),T(i,r,l),T(i,o,l)},p(i,l){l[0]&2048&&e!==(e=i[11].values().length+"")&&we(t,e),l[0]&128&&s!==(s=i[7].user_limit+"")&&we(o,s)},d(i){i&&(E(t),E(r),E(o))}}}function Tg(n){let e,t,r;function s(){return n[38](n[47])}return{c(){e=L("button"),e.textContent="Kick",F(e,"class","mod-destructive")},m(o,i){T(o,e,i),t||(r=re(e,"click",function(){tt((0,Ye.debounce)(s))&&(0,Ye.debounce)(s).apply(this,arguments)}),t=!0)},p(o,i){n=o},d(o){o&&E(e),t=!1,r()}}}function xC(n){let e,t=n[47].role==="Member"&&n[7].owner&&Tg(n);return{c(){t&&t.c(),e=q()},m(r,s){t&&t.m(r,s),T(r,e,s)},p(r,s){r[47].role==="Member"&&r[7].owner?t?t.p(r,s):(t=Tg(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&E(e),t&&t.d(r)}}}function Ag(n){let e,t;return e=new _e({props:{name:n[47].user.name,description:n[47].role,$$slots:{default:[xC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&2048&&(o.name=r[47].user.name),s[0]&2048&&(o.description=r[47].role),s[0]&2176|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function SC(n){let e,t,r;return{c(){e=L("input"),e.value=n[4],F(e,"type","text"),e.readOnly=!0,F(e,"id","system3InviteLink")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[29])),t=!0)},p(s,o){o[0]&16&&e.value!==s[4]&&(e.value=s[4])},d(s){s&&E(e),t=!1,r()}}}function kC(n){let e,t,r,s;return e=new nt({props:{name:"Membership",description:""}}),r=new _e({props:{name:"Leave relay",description:"Leave the relay. Local data is preserved.",$$slots:{default:[EC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment),t=q(),V(r.$$.fragment)},m(o,i){N(e,o,i),T(o,t,i),N(r,o,i),s=!0},p(o,i){let l={};i[1]&4194304&&(l.$$scope={dirty:i,ctx:o}),r.$set(l)},i(o){s||(k(e.$$.fragment,o),k(r.$$.fragment,o),s=!0)},o(o){A(e.$$.fragment,o),A(r.$$.fragment,o),s=!1},d(o){o&&E(t),B(e,o),B(r,o)}}}function CC(n){let e,t,r,s,o,i,l,c=[AC,TC],f=[];function d(p,g){return p[12]?0:1}return e=d(n,[-1,-1]),t=f[e]=c[e](n),s=new nt({props:{name:"Storage",description:""}}),i=new _e({props:{name:"Destroy relay",description:"This will destroy the relay (deleting all data on the server). Local data is preserved.",$$slots:{default:[$C]},$$scope:{ctx:n}}}),{c(){t.c(),r=q(),V(s.$$.fragment),o=q(),V(i.$$.fragment)},m(p,g){f[e].m(p,g),T(p,r,g),N(s,p,g),T(p,o,g),N(i,p,g),l=!0},p(p,g){let _=e;e=d(p,g),e===_?f[e].p(p,g):(xe(),A(f[_],1,1,()=>{f[_]=null}),Se(),t=f[e],t?t.p(p,g):(t=f[e]=c[e](p),t.c()),k(t,1),t.m(r.parentNode,r));let y={};g[0]&64|g[1]&4194304&&(y.$$scope={dirty:g,ctx:p}),i.$set(y)},i(p){l||(k(t),k(s.$$.fragment,p),k(i.$$.fragment,p),l=!0)},o(p){A(t),A(s.$$.fragment,p),A(i.$$.fragment,p),l=!1},d(p){p&&(E(r),E(o)),f[e].d(p),B(s,p),B(i,p)}}}function EC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Leave",F(e,"class","mod-warning")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[42])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function TC(n){let e,t;return e=new _e({props:{name:`Plan: ${n[7].plan}`,description:"",$$slots:{description:[FC],default:[DC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&128&&(o.name=`Plan: ${r[7].plan}`),s[0]&128|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function AC(n){let e,t,r=!n[6].values()[0].active||n[6].values()[0].cancel_at,s,o;e=new _e({props:{name:`Plan: ${n[7].plan}`,description:"",$$slots:{description:[RC],default:[MC]},$$scope:{ctx:n}}});let i=r&&Fg(n);return{c(){V(e.$$.fragment),t=q(),i&&i.c(),s=$e()},m(l,c){N(e,l,c),T(l,t,c),i&&i.m(l,c),T(l,s,c),o=!0},p(l,c){let f={};c[0]&128&&(f.name=`Plan: ${l[7].plan}`),c[0]&4288|c[1]&4194304&&(f.$$scope={dirty:c,ctx:l}),e.$set(f),c[0]&64&&(r=!l[6].values()[0].active||l[6].values()[0].cancel_at),r?i?(i.p(l,c),c[0]&64&&k(i,1)):(i=Fg(l),i.c(),k(i,1),i.m(s.parentNode,s)):i&&(xe(),A(i,1,1,()=>{i=null}),Se())},i(l){o||(k(e.$$.fragment,l),k(i),o=!0)},o(l){A(e.$$.fragment,l),A(i),o=!1},d(l){l&&(E(t),E(s)),B(e,l),i&&i.d(l)}}}function DC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Upgrade",F(e,"class","mod-cta")},m(s,o){T(s,e,o),t||(r=re(e,"click",function(){tt((0,Ye.debounce)(n[41]))&&(0,Ye.debounce)(n[41]).apply(this,arguments)}),t=!0)},p(s,o){n=s},d(s){s&&E(e),t=!1,r()}}}function FC(n){let e,t=(n[7].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=L("fragment"),r=ae(t),F(e,"slot","description")},m(s,o){T(s,e,o),J(e,r)},p(s,o){o[0]&128&&t!==(t=(s[7].cta||"Thanks for supporting Relay development <3")+"")&&we(r,t)},d(s){s&&E(e)}}}function Dg(n){let e,t,r;return{c(){e=L("button"),e.textContent="Cancel",F(e,"class","mod-destructive")},m(s,o){T(s,e,o),t||(r=re(e,"click",function(){tt((0,Ye.debounce)(n[40]))&&(0,Ye.debounce)(n[40]).apply(this,arguments)}),t=!0)},p(s,o){n=s},d(s){s&&E(e),t=!1,r()}}}function MC(n){let e,t,r=n[6].values()[0].active&&!n[6].values()[0].cancel_at,s,o,i,l=r&&Dg(n);return{c(){e=L("button"),e.textContent="Manage",t=q(),l&&l.c(),s=$e()},m(c,f){T(c,e,f),T(c,t,f),l&&l.m(c,f),T(c,s,f),o||(i=re(e,"click",function(){tt((0,Ye.debounce)(n[39]))&&(0,Ye.debounce)(n[39]).apply(this,arguments)}),o=!0)},p(c,f){n=c,f[0]&64&&(r=n[6].values()[0].active&&!n[6].values()[0].cancel_at),r?l?l.p(n,f):(l=Dg(n),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(c){c&&(E(e),E(t),E(s)),l&&l.d(c),o=!1,i()}}}function RC(n){let e,t=n[7].cta+"",r;return{c(){e=L("fragment"),r=ae(t),F(e,"slot","description")},m(s,o){T(s,e,o),J(e,r)},p(s,o){o[0]&128&&t!==(t=s[7].cta+"")&&we(r,t)},d(s){s&&E(e)}}}function Fg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[OC],default:[PC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s[0]&64|s[1]&4194304&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function PC(n){let e=n[14](n[6].values()[0].cancel_at)+"",t;return{c(){t=ae(e)},m(r,s){T(r,t,s)},p(r,s){s[0]&64&&e!==(e=r[14](r[6].values()[0].cancel_at)+"")&&we(t,e)},d(r){r&&E(t)}}}function OC(n){let e;return{c(){e=L("span"),e.textContent="Status: Cancelled",F(e,"slot","name"),F(e,"class","mod-warning")},m(t,r){T(t,e,r)},p:Z,d(t){t&&E(e)}}}function IC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Destroy",F(e,"class","mod-warning")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,Ye.debounce)(n[26])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function LC(n){let e,t;return{c(){e=L("button"),e.textContent="Destroy",e.disabled=t=!0,F(e,"class","mod-warning"),F(e,"aria-label","Cancel subscription to destroy relay.")},m(r,s){T(r,e,s)},p:Z,d(r){r&&E(e)}}}function $C(n){let e,t;function r(i,l){return l[0]&64&&(e=null),e==null&&(e=i[6].values().length>0&&!i[6].values()[0].cancel_at),e?LC:IC}let s=r(n,[-1,-1]),o=s(n);return{c(){o.c(),t=$e()},m(i,l){o.m(i,l),T(i,t,l)},p(i,l){s===(s=r(i,l))&&o?o.p(i,l):(o.d(1),o=s(i),o&&(o.c(),o.m(t.parentNode,t)))},d(i){i&&E(t),o.d(i)}}}function UC(n){let e,t=n[0].name+"",r,s,o,i,l,c,f,d,p,g,_,y,x,C,v,D,Y,S,M,O=n[0].owner&&Cg(n);i=new nt({props:{name:"Shared folders"}});let U=ze(n[9].values()),I=[];for(let H=0;H<U.length;H+=1)I[H]=Eg(kg(n,U,H));let oe=H=>A(I[H],1,1,()=>{I[H]=null});f=new _e({props:{description:"",name:"",$$slots:{default:[bC]},$$scope:{ctx:n}}}),p=new nt({props:{name:"Users",$$slots:{default:[vC]},$$scope:{ctx:n}}});let ue=ze(n[11].values().sort(Mg)),se=[];for(let H=0;H<ue.length;H+=1)se[H]=Ag(Sg(n,ue,H));let ge=H=>A(se[H],1,1,()=>{se[H]=null});y=new nt({props:{name:"Sharing"}}),C=new _e({props:{name:"Share key",description:"Share this key with your collaborators.",$$slots:{default:[SC]},$$scope:{ctx:n}}});let be=[CC,kC],$=[];function j(H,z){return H[7].owner?0:1}return D=j(n,[-1,-1]),Y=$[D]=be[D](n),{c(){e=L("h3"),r=ae(t),s=q(),O&&O.c(),o=q(),V(i.$$.fragment),l=q();for(let H=0;H<I.length;H+=1)I[H].c();c=q(),V(f.$$.fragment),d=q(),V(p.$$.fragment),g=q();for(let H=0;H<se.length;H+=1)se[H].c();_=q(),V(y.$$.fragment),x=q(),V(C.$$.fragment),v=q(),Y.c(),S=$e()},m(H,z){T(H,e,z),J(e,r),T(H,s,z),O&&O.m(H,z),T(H,o,z),N(i,H,z),T(H,l,z);for(let ke=0;ke<I.length;ke+=1)I[ke]&&I[ke].m(H,z);T(H,c,z),N(f,H,z),T(H,d,z),N(p,H,z),T(H,g,z);for(let ke=0;ke<se.length;ke+=1)se[ke]&&se[ke].m(H,z);T(H,_,z),N(y,H,z),T(H,x,z),N(C,H,z),T(H,v,z),$[D].m(H,z),T(H,S,z),M=!0},p(H,z){if((!M||z[0]&1)&&t!==(t=H[0].name+"")&&we(r,t),H[0].owner?O?(O.p(H,z),z[0]&1&&k(O,1)):(O=Cg(H),O.c(),k(O,1),O.m(o.parentNode,o)):O&&(xe(),A(O,1,1,()=>{O=null}),Se()),z[0]&285214208){U=ze(H[9].values());let le;for(le=0;le<U.length;le+=1){let G=kg(H,U,le);I[le]?(I[le].p(G,z),k(I[le],1)):(I[le]=Eg(G),I[le].c(),k(I[le],1),I[le].m(c.parentNode,c))}for(xe(),le=U.length;le<I.length;le+=1)oe(le);Se()}let ke={};z[1]&4194304&&(ke.$$scope={dirty:z,ctx:H}),f.$set(ke);let vt={};if(z[0]&2176|z[1]&4194304&&(vt.$$scope={dirty:z,ctx:H}),p.$set(vt),z[0]&134219904){ue=ze(H[11].values().sort(Mg));let le;for(le=0;le<ue.length;le+=1){let G=Sg(H,ue,le);se[le]?(se[le].p(G,z),k(se[le],1)):(se[le]=Ag(G),se[le].c(),k(se[le],1),se[le].m(_.parentNode,_))}for(xe(),le=ue.length;le<se.length;le+=1)ge(le);Se()}let st={};z[0]&16|z[1]&4194304&&(st.$$scope={dirty:z,ctx:H}),C.$set(st);let yt=D;D=j(H,z),D===yt?$[D].p(H,z):(xe(),A($[yt],1,1,()=>{$[yt]=null}),Se(),Y=$[D],Y?Y.p(H,z):(Y=$[D]=be[D](H),Y.c()),k(Y,1),Y.m(S.parentNode,S))},i(H){if(!M){k(O),k(i.$$.fragment,H);for(let z=0;z<U.length;z+=1)k(I[z]);k(f.$$.fragment,H),k(p.$$.fragment,H);for(let z=0;z<ue.length;z+=1)k(se[z]);k(y.$$.fragment,H),k(C.$$.fragment,H),k(Y),M=!0}},o(H){A(O),A(i.$$.fragment,H),I=I.filter(Boolean);for(let z=0;z<I.length;z+=1)A(I[z]);A(f.$$.fragment,H),A(p.$$.fragment,H),se=se.filter(Boolean);for(let z=0;z<se.length;z+=1)A(se[z]);A(y.$$.fragment,H),A(C.$$.fragment,H),A(Y),M=!1},d(H){H&&(E(e),E(s),E(o),E(l),E(c),E(d),E(g),E(_),E(x),E(v),E(S)),O&&O.d(H),B(i,H),Zt(I,H),B(f,H),B(p,H),Zt(se,H),B(y,H),B(C,H),$[D].d(H)}}}function Mg(n,e){return n.role==="Owner"&&e.role!=="Owner"?-1:n.role!=="Owner"&&e.role==="Owner"||n.user.name>e.user.name?1:-1}function NC(n){if(/[\\:*?"<>|]/.test(n))return!1;let t=n.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function BC(n,e,t){let r,s,o=Z,i=()=>(o(),o=Et(O,R=>t(43,s=R)),O),l,c,f=Z,d=()=>(f(),f=Et(D,R=>t(7,c=R)),D),p,g,_,y=Z,x=()=>(y(),y=Et(M,R=>t(10,_=R)),M),C,v;n.$$.on_destroy.push(()=>o()),n.$$.on_destroy.push(()=>f()),n.$$.on_destroy.push(()=>y());let{relay:D}=e;d();let Y=D.folders;Re(n,Y,R=>t(9,g=R));let{plugin:S}=e,{sharedFolders:M}=e;x();let{relayRoles:O}=e;i();function U(R){if(!R)return"Active";let de=(0,kf.default)(),Ae=(0,kf.default)(R).diff(de,"days");return Ae<=0?"Subscription has ended":Ae===1?"Active for 1 more day":`Active for ${Ae} more days`}let I=c.subscriptions;Re(n,I,R=>t(6,l=R));let oe=li(l,R=>{if(R.values().length!==0)return R.values()[0]});Re(n,oe,R=>t(12,v=R));let ue=s.filter(R=>{var de;return((de=R.relay)===null||de===void 0?void 0:de.id)===D.id});Re(n,ue,R=>t(11,C=R));let se=Je(!0);Re(n,se,R=>t(5,r=R));let ge;hr(()=>{ge&&ge.value===""&&ge.focus()});let be=pr();function $(R){return ft(this,void 0,void 0,function*(){var de;!((de=S.loginManager)===null||de===void 0)&&de.user&&window.open(S.buildApiUrl(`/subscribe?relay=${R.id}&quantity=10&user_email=${S.loginManager.user.name}`),"_blank")})}function j(R){return ft(this,void 0,void 0,function*(){let de=R.token,Ue=R.id;window.open(S.buildApiUrl(`/subscriptions/${Ue}/manage?token=${de}`),"_blank")})}function H(R){return ft(this,void 0,void 0,function*(){let de=R.token,Ue=R.id;window.open(S.buildApiUrl(`/subscriptions/${Ue}/cancel?token=${de}`),"_blank")})}function z(){return ft(this,void 0,void 0,function*(){S.relayManager.leaveRelay(D),be("goBack",{clear:!0})})}let ke;S.relayManager.getRelayInvitationKey(D).then(R=>{t(4,ke=R)});function vt(R,de,Ue){return ft(this,void 0,void 0,function*(){let Ae=(0,Ye.normalizePath)((0,Rg.join)(Ue,de));return S.vault.getFolderByPath(Ae)===null&&(yield S.vault.createFolder(Ae)),S.sharedFolders.new(Ae,R.guid,D.guid,!0).then(on=>(on.remote=R,S.sharedFolders.notifyListeners(),Gr(jr.enableDownloadOnAddToVault,()=>{S.backgroundSync.getFolderFiles(on)}),on))})}let st=Je(!1);Re(n,st,R=>t(8,p=R));let yt=(0,Ye.debounce)(()=>{S.relayManager.updateRelay(D),st.set(!1)},500,!0),le=R=>{new rl(S.app,M,R,vt).open()};function G(){se.set(NC(ge.value)),r&&ge.value!==""&&(st.set(!0),yt())}function sn(){S.relayManager.destroyRelay(D),be("goBack",{})}function Ht(R){S.relayManager.kick(R)}function Rr(R,de){R&&be("manageSharedFolder",{folder:R,relay:de,mount:!1})}function rs(R){let de=R.target;de.focus(),de.select(),navigator.clipboard.writeText(de.value).then(()=>new Ye.Notice("Invite link copied")).catch(Ue=>{})}let ns=new Qa(S.app,M,R=>ft(void 0,void 0,void 0,function*(){let de=(0,Ye.normalizePath)(R),Ue=M.find(wt=>wt.path==R);if(Ue){let wt=yield S.relayManager.createRemoteFolder(Ue,D);Ue.remote=wt,Ue.connect(),S.sharedFolders.notifyListeners();return}S.vault.getFolderByPath(de)===null&&(yield S.vault.createFolder(de));let Ae=zi(),on=yield S.sharedFolders.new((0,Ye.normalizePath)(R),Ae,D.guid,!1),ss=yield S.relayManager.createRemoteFolder(on,D);on.remote=ss,S.sharedFolders.notifyListeners()})),lo=(R,de)=>de.remote===R;function co(){D.name=this.value,d(t(0,D))}function uo(R){Xs[R?"unshift":"push"](()=>{ge=R,t(3,ge)})}let fo=R=>{let de=_.find(Ue=>Ue.remote===R);de&&Rr(de,R.relay)},ho=R=>{le(R)},po=()=>{ns.open()},mo=R=>{Ht(R)},go=()=>{j(v)},yo=()=>{H(v)},Pr=()=>{$(c)},Ze=()=>{z()};return n.$$set=R=>{"relay"in R&&d(t(0,D=R.relay)),"plugin"in R&&t(31,S=R.plugin),"sharedFolders"in R&&x(t(1,M=R.sharedFolders)),"relayRoles"in R&&i(t(2,O=R.relayRoles))},[D,M,O,ge,ke,r,l,c,p,g,_,C,v,Y,U,I,oe,ue,se,$,j,H,z,st,le,G,sn,Ht,Rr,rs,ns,S,lo,co,uo,fo,ho,po,mo,go,yo,Pr,Ze]}var Cf=class extends ne{constructor(e){super(),ie(this,e,BC,UC,te,{relay:0,plugin:31,sharedFolders:1,relayRoles:2},dC,[-1,-1])}},ui=Cf;function VC(n){let e,t,r,s,o,i;return r=new Mu({}),{c(){e=L("div"),t=L("div"),V(r.$$.fragment),F(t,"class","clickable-icon"),F(t,"aria-label","Back"),F(t,"tabindex","0"),F(t,"role","button"),F(e,"class","modal-setting-nav-bar")},m(l,c){T(l,e,c),J(e,t),N(r,t,null),s=!0,o||(i=[re(t,"click",n[0]),re(t,"keypress",n[1])],o=!0)},p:Z,i(l){s||(k(r.$$.fragment,l),s=!0)},o(l){A(r.$$.fragment,l),s=!1},d(l){l&&E(e),B(r),o=!1,Te(i)}}}function HC(n){let e=pr();function t(){e("goBack",{})}function r(s){s.key==="Escape"&&(e("goBack",{}),s.stopPropagation())}return[t,r]}var Ef=class extends ne{constructor(e){super(),ie(this,e,HC,VC,te,{})}},Pg=Ef;var io=require("obsidian");function WC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Delete local",F(e,"class","mod-warning")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,io.debounce)(n[12])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function KC(n){let e,t,r,s,o,i,l;return{c(){e=L("button"),t=ae("Delete metadata"),F(e,"class",r=n[4]?"mod-disabled":"mod-warning"),e.disabled=s=!!n[4],F(e,"aria-label",o=n[4]?"Metadata is required for sharing.":"")},m(c,f){T(c,e,f),J(e,t),i||(l=re(e,"click",(0,io.debounce)(n[13])),i=!0)},p(c,f){f&16&&r!==(r=c[4]?"mod-disabled":"mod-warning")&&F(e,"class",r),f&16&&s!==(s=!!c[4])&&(e.disabled=s),f&16&&o!==(o=c[4]?"Metadata is required for sharing.":"")&&F(e,"aria-label",o)},d(c){c&&E(e),i=!1,l()}}}function Og(n){var s,o,i,l,c;let e,t,r=(((s=n[4])==null?void 0:s.owner)||((l=(i=(o=n[3])==null?void 0:o.remote)==null?void 0:i.creator)==null?void 0:l.id)===((c=n[0].relayManager.user)==null?void 0:c.id))&&Ig(n);return{c(){r&&r.c(),e=$e()},m(f,d){r&&r.m(f,d),T(f,e,d),t=!0},p(f,d){var p,g,_,y,x;(p=f[4])!=null&&p.owner||((y=(_=(g=f[3])==null?void 0:g.remote)==null?void 0:_.creator)==null?void 0:y.id)===((x=f[0].relayManager.user)==null?void 0:x.id)?r?(r.p(f,d),d&25&&k(r,1)):(r=Ig(f),r.c(),k(r,1),r.m(e.parentNode,e)):r&&(xe(),A(r,1,1,()=>{r=null}),Se())},i(f){t||(k(r),t=!0)},o(f){A(r),t=!1},d(f){f&&E(e),r&&r.d(f)}}}function Ig(n){let e,t,r,s;return e=new nt({props:{name:"Remote Folder"}}),r=new _e({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[YC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment),t=q(),V(r.$$.fragment)},m(o,i){N(e,o,i),T(o,t,i),N(r,o,i),s=!0},p(o,i){let l={};i&262144&&(l.$$scope={dirty:i,ctx:o}),r.$set(l)},i(o){s||(k(e.$$.fragment,o),k(r.$$.fragment,o),s=!0)},o(o){A(e.$$.fragment,o),A(r.$$.fragment,o),s=!1},d(o){o&&E(t),B(e,o),B(r,o)}}}function YC(n){let e,t,r;return{c(){e=L("button"),e.textContent="Delete remote",F(e,"class","mod-destructive")},m(s,o){T(s,e,o),t||(r=re(e,"click",(0,io.debounce)(n[8])),t=!0)},p:Z,d(s){s&&E(e),t=!1,r()}}}function Lg(n){let e,t;return e=new _e({props:{description:"",$$slots:{name:[qC],default:[JC]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&262160&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function JC(n){let e,t;return e=new Qn({}),e.$on("settings",function(){tt((0,io.debounce)(n[14]))&&(0,io.debounce)(n[14]).apply(this,arguments)}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){n=r},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function qC(n){let e,t,r=n[4].name+"",s,o;return t=new mr({props:{class:"svg-icon"}}),{c(){e=L("span"),V(t.$$.fragment),s=ae(r),F(e,"slot","name"),bt(e,"display","inline-flex")},m(i,l){T(i,e,l),N(t,e,null),J(e,s),o=!0},p(i,l){(!o||l&16)&&r!==(r=i[4].name+"")&&we(s,r)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){A(t.$$.fragment,i),o=!1},d(i){i&&E(e),B(t)}}}function jC(n){let e,t,r,s,o,i,l,c,f,d,p,g,_,y;t=new ci({props:{folder:n[1]}}),s=new nt({props:{name:"Local folder"}}),i=new _e({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[WC]},$$scope:{ctx:n}}}),c=new _e({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[KC]},$$scope:{ctx:n}}});let x=n[4]&&Og(n);p=new nt({props:{name:"Relay"}});let C=n[4]&&Lg(n);return{c(){e=L("h3"),V(t.$$.fragment),r=q(),V(s.$$.fragment),o=q(),V(i.$$.fragment),l=q(),V(c.$$.fragment),f=q(),x&&x.c(),d=q(),V(p.$$.fragment),g=q(),C&&C.c(),_=$e()},m(v,D){T(v,e,D),N(t,e,null),T(v,r,D),N(s,v,D),T(v,o,D),N(i,v,D),T(v,l,D),N(c,v,D),T(v,f,D),x&&x.m(v,D),T(v,d,D),N(p,v,D),T(v,g,D),C&&C.m(v,D),T(v,_,D),y=!0},p(v,[D]){let Y={};D&2&&(Y.folder=v[1]),t.$set(Y);let S={};D&262144&&(S.$$scope={dirty:D,ctx:v}),i.$set(S);let M={};D&262160&&(M.$$scope={dirty:D,ctx:v}),c.$set(M),v[4]?x?(x.p(v,D),D&16&&k(x,1)):(x=Og(v),x.c(),k(x,1),x.m(d.parentNode,d)):x&&(xe(),A(x,1,1,()=>{x=null}),Se()),v[4]?C?(C.p(v,D),D&16&&k(C,1)):(C=Lg(v),C.c(),k(C,1),C.m(_.parentNode,_)):C&&(xe(),A(C,1,1,()=>{C=null}),Se())},i(v){y||(k(t.$$.fragment,v),k(s.$$.fragment,v),k(i.$$.fragment,v),k(c.$$.fragment,v),k(x),k(p.$$.fragment,v),k(C),y=!0)},o(v){A(t.$$.fragment,v),A(s.$$.fragment,v),A(i.$$.fragment,v),A(c.$$.fragment,v),A(x),A(p.$$.fragment,v),A(C),y=!1},d(v){v&&(E(e),E(r),E(o),E(l),E(f),E(d),E(g),E(_)),B(t),B(s,v),B(i,v),B(c,v),x&&x.d(v),B(p,v),C&&C.d(v)}}}function GC(n,e,t){let r,s,o=Z,i=()=>(o(),o=Et(d,U=>t(15,s=U)),d),l;n.$$.on_destroy.push(()=>o());let{plugin:c}=e,{sharedFolder:f}=e,{sharedFolders:d}=e;i();let{relayRoles:p}=e,g=li(s,U=>U.find(I=>I===f));Re(n,g,U=>t(3,r=U));let _=li([g,p],([U,I])=>{var oe;return(oe=I.find(ue=>{var se;return ue.relay===((se=U==null?void 0:U.remote)===null||se===void 0?void 0:se.relay)}))===null||oe===void 0?void 0:oe.relay});Re(n,_,U=>t(4,l=U));let y;hr(()=>{!f&&y&&y.value===""&&y.focus()});let x=pr();function C(U){U&&x("manageRelay",{relay:U})}function v(){return ft(this,void 0,void 0,function*(){yield c.relayManager.deleteRemote(f),c.sharedFolders.notifyListeners()})}function D(){return ft(this,void 0,void 0,function*(){r&&c.sharedFolders.delete(r),x("goBack",{clear:!0})})}function Y(){let U=c.vault.getFolderByPath(f.path);U&&c.app.vault.trash(U,!1),x("goBack",{})}let S=()=>{Y()},M=()=>{D()},O=()=>{C(l)};return n.$$set=U=>{"plugin"in U&&t(0,c=U.plugin),"sharedFolder"in U&&t(1,f=U.sharedFolder),"sharedFolders"in U&&i(t(2,d=U.sharedFolders)),"relayRoles"in U&&t(11,p=U.relayRoles)},[c,f,d,r,l,g,_,C,v,D,Y,p,S,M,O]}var Tf=class extends ne{constructor(e){super(),ie(this,e,GC,jC,te,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:11})}},$g=Tf;function zC(n){rt(n,"svelte-p7bayo",".vertical-tab-content.svelte-p7bayo{max-height:var(--modal-max-height)}")}function Ug(n){let e,t;return e=new Pg({}),e.$on("goBack",n[9]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p:Z,i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function XC(n){let e,t;return e=new ig({props:{plugin:n[0],$$slots:{default:[eE]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),s&262145&&(o.$$scope={dirty:s,ctx:r}),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function ZC(n){let e,t;return e=new ui({props:{plugin:n[0],relayRoles:n[3],relay:n[2],sharedFolders:n[5]}}),e.$on("goBack",n[9]),e.$on("close",n[10]),e.$on("manageSharedFolder",n[7]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),s&4&&(o.relay=r[2]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function QC(n){let e,t;return e=new $g({props:{plugin:n[0],relayRoles:n[3],sharedFolder:n[1],sharedFolders:n[5]}}),e.$on("goBack",n[9]),e.$on("close",n[10]),e.$on("manageRelay",n[6]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),s&2&&(o.sharedFolder=r[1]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function eE(n){let e,t;return e=new En({props:{relays:n[4],plugin:n[0]}}),e.$on("manageRelay",n[6]),e.$on("manageSharedFolder",n[7]),e.$on("createRelay",n[8]),e.$on("joinRelay",n[11]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let o={};s&1&&(o.plugin=r[0]),e.$set(o)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){A(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function tE(n){let e,t,r,s,o,i=(n[2]||n[1])&&Ug(n),l=[QC,ZC,XC],c=[];function f(d,p){return d[1]?0:d[2]?1:2}return r=f(n,-1),s=c[r]=l[r](n),{c(){i&&i.c(),e=q(),t=L("div"),s.c(),F(t,"class","vertical-tab-content svelte-p7bayo")},m(d,p){i&&i.m(d,p),T(d,e,p),T(d,t,p),c[r].m(t,null),o=!0},p(d,[p]){d[2]||d[1]?i?(i.p(d,p),p&6&&k(i,1)):(i=Ug(d),i.c(),k(i,1),i.m(e.parentNode,e)):i&&(xe(),A(i,1,1,()=>{i=null}),Se());let g=r;r=f(d,p),r===g?c[r].p(d,p):(xe(),A(c[g],1,1,()=>{c[g]=null}),Se(),s=c[r],s?s.p(d,p):(s=c[r]=l[r](d),s.c()),k(s,1),s.m(t,null))},i(d){o||(k(i),k(s),o=!0)},o(d){A(i),A(s),o=!1},d(d){d&&(E(e),E(t)),i&&i.d(d),c[r].d()}}}function rE(n,e,t){let r,{plugin:s}=e,o=s.app,i=s.relayManager,l=i.relayRoles,c=i.relays;Re(n,c,M=>t(13,r=M));let f=s.sharedFolders,d,p=En,g,_=[{component:En}],{close:y}=e;function x(M){_.push({currentRelay:g,sharedFolder:d,component:p}),t(2,g=M.detail.relay),t(1,d=void 0),p=ui}function C(M){_.push({currentRelay:g,sharedFolder:d,component:p}),t(1,d=M.detail.folder),t(2,g=M.detail.relay)}function v(M){return ft(this,void 0,void 0,function*(){_.push({currentRelay:g,sharedFolder:d,component:p}),t(2,g=yield s.relayManager.createRelay("")),p=ui})}function D(M){if(M.detail.clear){_.length=0,t(2,g=void 0),t(1,d=void 0),p=En;return}let O=_.pop();if(O)for(;O;){if(!O.currentRelay&&!O.sharedFolder)t(2,g=O.currentRelay),t(1,d=O.sharedFolder),p=O.component;else if(O.sharedFolder&&f.has(O.sharedFolder)){t(2,g=O.currentRelay),t(1,d=O.sharedFolder),p=O.component;break}else if(O.currentRelay&&i.relays.get(O.currentRelay.id)){t(2,g=O.currentRelay),t(1,d=O.sharedFolder),p=O.component;break}O=_.pop()}else t(2,g=void 0),t(1,d=void 0),p=En}function Y(M){_.length=0,y()}function S(M){t(2,g=M.detail.relay),p=ui}return n.$$set=M=>{"plugin"in M&&t(0,s=M.plugin),"close"in M&&t(12,y=M.close)},n.$$.update=()=>{if(n.$$.dirty&8196){e:g&&!r.has(g.id)&&(t(2,g=void 0),p=En)}if(n.$$.dirty&2){e:d&&!f.has(d)&&(t(1,d=void 0),p=En)}},[s,d,g,l,c,f,x,C,v,D,Y,S,y,r]}var Af=class extends ne{constructor(e){super(),ie(this,e,rE,tE,te,{plugin:0,close:12},zC)}},Ng=Af;var nl=class extends Bg.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new Ng({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var jg=require("obsidian");var Vg=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],fi=class{constructor(e,t,r){this.id=e,this.name=t,this.token=r,this.color=Vg[Ro()%Vg.length]}};var At=class extends Error{constructor(e){var t,r,s,o;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,At.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof At||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(o=(s=(r=this.originalError)==null?void 0:r.cause)==null?void 0:s.message)!=null&&o.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},sl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function nE(n,e){let t={};if(typeof n!="string")return t;let r=Object.assign({},e||{}).decode||sE,s=0;for(;s<n.length;){let o=n.indexOf("=",s);if(o===-1)break;let i=n.indexOf(";",s);if(i===-1)i=n.length;else if(i<o){s=n.lastIndexOf(";",o-1)+1;continue}let l=n.slice(s,o).trim();if(t[l]===void 0){let c=n.slice(o+1,i).trim();c.charCodeAt(0)===34&&(c=c.slice(1,-1));try{t[l]=r(c)}catch(f){t[l]=c}}s=i+1}return t}function Hg(n,e,t){let r=Object.assign({},t||{}),s=r.encode||oE;if(!sl.test(n))throw new TypeError("argument name is invalid");let o=s(e);if(o&&!sl.test(o))throw new TypeError("argument val is invalid");let i=n+"="+o;if(r.maxAge!=null){let l=r.maxAge-0;if(isNaN(l)||!isFinite(l))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(l)}if(r.domain){if(!sl.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!sl.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!function(c){return Object.prototype.toString.call(c)==="[object Date]"||c instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function sE(n){return n.indexOf("%")!==-1?decodeURIComponent(n):n}function oE(n){return encodeURIComponent(n)}var Yg;function ol(n){if(n)try{let e=decodeURIComponent(Yg(n.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function Jg(n,e=0){let t=ol(n);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Yg=typeof atob=="function"?atob:n=>{let e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,s=0,o=0,i="";r=e.charAt(o++);~r&&(t=s%4?64*t+r:r,s++%4)?i+=String.fromCharCode(255&t>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var Wg="pb_auth",di=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Jg(this.token)}get isAdmin(){return ol(this.token).type==="admin"}get isAuthRecord(){return ol(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Wg){let r=nE(e||"")[t]||"",s={};try{s=JSON.parse(r),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch(o){}this.save(s.token||"",s.model||null)}exportToCookie(e,t=Wg){var c,f;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=ol(this.token);r.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let o={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=Hg(t,JSON.stringify(o),e),l=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(o.model&&l>4096){o.model={id:(c=o==null?void 0:o.model)==null?void 0:c.id,email:(f=o==null?void 0:o.model)==null?void 0:f.email};let d=["collectionId","username","verified"];for(let p in this.model)d.includes(p)&&(o.model[p]=this.model[p]);i=Hg(t,JSON.stringify(o),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Ff=class extends di{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},en=class{constructor(e){this.client=e}},Mf=class extends en{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,s,o,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:s,duration:o}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},hi=class extends en{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(s=>{var o;return s.items=((o=s.items)==null?void 0:o.map(i=>this.decode(i)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var s;if(!((s=r==null?void 0:r.items)!=null&&s.length))throw new At({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new At({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],s=async o=>this.getList(o,e||500,t).then(i=>{let l=i.items;return r=r.concat(l),l.length==i.perPage?s(o+1):r});return s(1)}};function Nt(n,e,t,r){let s=r!==void 0;return s||t!==void 0?s?(console.warn(n),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Df(n){var e;(e=n._resetAutoRefresh)==null||e.call(n)}var Rf=class extends hi{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(s=>{var o,i;return((o=this.client.authStore.model)==null?void 0:o.id)===s.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,o;return r&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((o=this.client.authStore.model)==null?void 0:o.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,s){let o={method:"POST",body:{identity:e,password:t}};o=Nt("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",o,r,s);let i=o.autoRefreshThreshold;delete o.autoRefreshThreshold,o.autoRefresh||Df(this.client);let l=await this.client.send(this.baseCrudPath+"/auth-with-password",o);return l=this.authResponse(l),i&&function(f,d,p,g){Df(f);let _=f.beforeSend,y=f.authStore.model,x=f.authStore.onChange((C,v)=>{(!C||(v==null?void 0:v.id)!=(y==null?void 0:y.id)||(v!=null&&v.collectionId||y!=null&&y.collectionId)&&(v==null?void 0:v.collectionId)!=(y==null?void 0:y.collectionId))&&Df(f)});f._resetAutoRefresh=function(){x(),f.beforeSend=_,delete f._resetAutoRefresh},f.beforeSend=async(C,v)=>{var M;let D=f.authStore.token;if((M=v.query)!=null&&M.autoRefresh)return _?_(C,v):{url:C,sendOptions:v};let Y=f.authStore.isValid;if(Y&&Jg(f.authStore.token,d))try{await p()}catch(O){Y=!1}Y||await g();let S=v.headers||{};for(let O in S)if(O.toLowerCase()=="authorization"&&D==S[O]&&f.authStore.token){S[O]=f.authStore.token;break}return v.headers=S,_?_(C,v):{url:C,sendOptions:v}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},o))),l}async authRefresh(e,t){let r={method:"POST"};return r=Nt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Nt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,o){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=Nt("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,s,o),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}},iE=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function qg(n){if(n){n.query=n.query||{};for(let e in n)iE.includes(e)||(n.query[e]=n[e],delete n[e])}}var il=class extends en{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let s=e;if(r){qg(r);let l="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));s+=(s.includes("?")?"&":"?")+l}let o=function(l){let c=l,f;try{f=JSON.parse(c==null?void 0:c.data)}catch(d){}t(f||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(o),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(s,o):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,o)}async unsubscribe(e){var r;let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let o in s)if(this.hasSubscriptionListeners(o)){for(let i of this.subscriptions[o])(r=this.eventSource)==null||r.removeEventListener(o,i);delete this.subscriptions[o],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let o of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,o);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var o;let r=!1,s=this.getSubscriptionsByTopic(e);for(let i in s){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let l=!1;for(let c=this.subscriptions[i].length-1;c>=0;c--)this.subscriptions[i][c]===t&&(l=!0,delete this.subscriptions[i][c],this.subscriptions[i].splice(c,1),(o=this.eventSource)==null||o.removeEventListener(i,t));l&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((r=this.subscriptions[s])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in r)for(let o of r[s])o(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new At(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Pf=class extends hi{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(s=>{var o,i,l;return((o=this.client.authStore.model)==null?void 0:o.id)!==(s==null?void 0:s.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((l=this.client.authStore.model)==null?void 0:l.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,o,i;return!r||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((o=this.client.authStore.model)==null?void 0:o.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,s){let o={method:"POST",body:{identity:e,password:t}};return o=Nt("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",o,r,s),this.client.send(this.baseCollectionPath+"/auth-with-password",o).then(i=>this.authResponse(i))}async authWithOAuth2Code(e,t,r,s,o,i,l){let c={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:s,createData:o}};return c=Nt("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",c,i,l),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",c).then(f=>this.authResponse(f))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(c=>c.name===t.provider);if(!r)throw new At(new Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildUrl("/api/oauth2-redirect"),o=new il(this.client),i=null;function l(){i==null||i.close(),o.unsubscribe()}return t.urlCallback||(i=Kg(void 0)),new Promise(async(c,f)=>{var d;try{await o.subscribe("@oauth2",async y=>{let x=o.clientId;try{if(!y.state||x!==y.state)throw new Error("State parameters don't match.");let C=Object.assign({},t);delete C.provider,delete C.scopes,delete C.createData,delete C.urlCallback;let v=await this.authWithOAuth2Code(r.name,y.code,r.codeVerifier,s,t.createData,C);c(v)}catch(C){f(new At(C))}l()});let p={state:o.clientId};(d=t.scopes)!=null&&d.length&&(p.scope=t.scopes.join(" "));let g=this._replaceQueryParams(r.authUrl+s,p);await(t.urlCallback||function(y){i?i.location.href=y:i=Kg(y)})(g)}catch(p){l(),f(new At(p))}})}async authRefresh(e,t){let r={method:"POST"};return r=Nt("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=Nt("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,o){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=Nt("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,s,o),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,t,r){let s={method:"POST",body:{email:e}};return s=Nt("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,r){let s={method:"POST",body:{token:e}};return s=Nt("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>!0)}async requestEmailChange(e,t,r){let s={method:"POST",body:{newEmail:e}};return s=Nt("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,r,s){let o={method:"POST",body:{token:e,password:t}};return o=Nt("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",o,r,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",o).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,s="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));let o={},i=s.split("&");for(let l of i){if(l=="")continue;let c=l.split("=");o[decodeURIComponent(c[0].replace(/\+/g," "))]=decodeURIComponent((c[1]||"").replace(/\+/g," "))}for(let l in t)t.hasOwnProperty(l)&&(t[l]==null?delete o[l]:o[l]=t[l]);s="";for(let l in o)o.hasOwnProperty(l)&&(s!=""&&(s+="&"),s+=encodeURIComponent(l.replace(/%20/g,"+"))+"="+encodeURIComponent(o[l].replace(/%20/g,"+")));return s!=""?r+"?"+s:r}};function Kg(n){if(typeof window=="undefined"||!(window!=null&&window.open))throw new At(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,s=window.innerHeight;e=e>r?r:e,t=t>s?s:t;let o=r/2-e/2,i=s/2-t/2;return window.open(n,"popup_window","width="+e+",height="+t+",top="+i+",left="+o+",resizable,menubar=no")}var Of=class extends hi{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},If=class extends en{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new At({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Lf=class extends en{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},$f=class extends en{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let o=this.client.buildUrl(s.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);o+=(o.includes("?")?"&":"?")+i}return o}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Uf=class extends en{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},al=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Ff,this.admins=new Rf(this),this.collections=new Of(this),this.files=new $f(this),this.logs=new If(this),this.settings=new Mf(this),this.realtime=new il(this),this.health=new Lf(this),this.backups=new Uf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Pf(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let s=t[r];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",s)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let s=Object.assign({},await this.beforeSend(r,t));s.url!==void 0||s.options!==void 0?(r=s.url||r,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let s=this.serializeQueryParams(t.query);s&&(r+=(r.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async s=>{let o={};try{o=await s.json()}catch(i){}if(this.afterSend&&(o=await this.afterSend(s,o)),s.status>=400)throw new At({url:s.url,status:s.status,data:o});return o}).catch(s=>{throw new At(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),qg(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let s=new AbortController;this.cancelControllers[r]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let s=this.normalizeFormDataValue(e[r]),o=Array.isArray(s)?s:[s];if(o.length)for(let i of o)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let s of r)if(typeof Blob!="undefined"&&s instanceof Blob||typeof File!="undefined"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let s=e[r],o=encodeURIComponent(r);if(Array.isArray(s))for(let i of s)t.push(o+"="+encodeURIComponent(i));else s instanceof Date?t.push(o+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(o+"="+encodeURIComponent(JSON.stringify(s))):t.push(o+"="+encodeURIComponent(s))}return t.join("&")}};var ll=class extends di{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(s){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var cl=class extends $t{constructor(t,r){super();this._log=Q("[LoginManager]");let s=Q("[Pocketbase]");this.authStore=new ll(`pocketbase_auth_${t}`),this.pb=new al("https://auth.system3.md",this.authStore),this.pb.beforeSend=(o,i)=>(s(o,this.pb,i),i.fetch=Zn,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.3.0"}),{url:o,options:i}),this.openSettings=r,this.user=this.pb.authStore.isValid?this.makeUser(this.pb.authStore):void 0,fr.set(this,"loginManager")}log(t,...r){this._log(t,...r)}setup(t){var r;return this.pb.authStore.isValid?(this.log("LoginManager",this),this.user=this.makeUser(this.pb.authStore),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(r=t.meta)==null?void 0:r.rawUser}).then(()=>{this.notifyListeners()}).catch(s=>{this.log(s)}),!0):(this.notifyListeners(),!1)}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,jg.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t){var r,s;return new fi((r=t.model)==null?void 0:r.id,(s=t.model)==null?void 0:s.email,t.token)}get anon(){return new fi("","Anonymous","")}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}async initiateManualOAuth2CodeFlow(t){let s=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(i=>{throw i.originalError})).authProviders[0],o=this.pb.buildUrl("/api/oauth2-redirect");return[s.authUrl+o,s,async i=>this.pb.collection("users").authWithOAuth2Code(s.name,i,s.codeVerifier,o,{fetch:t}).then(l=>(this.setup(l),l))]}async poll(t,r){let s=0,o=1e3;return new Promise((i,l)=>{let c=setInterval(()=>{if(s+=1,s>30)return clearInterval(c),l(new Error(`Auth timeout: Timed out after ${s*o/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(f=>{if(f)return clearInterval(c),i(r(f.code))}).catch(f=>{})},o)})}async login(){try{let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}catch(t){return this.log("request failed",t),console.error("Authenticating failed",t),!1}}async openLoginPage(){return await this.openSettings(),await new Promise((r,s)=>{let o=()=>{this.loggedIn&&(this.off(o),r(!0)),r(!1)};this.on(o)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};function Gg(n,e){let t=Object.keys(e).map(r=>aE(n,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function aE(n,e,t){let r=n[e],s=n.hasOwnProperty(e),o=s?r:function(){return Object.getPrototypeOf(n)[e].apply(this,arguments)},i=t(o);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(l,i),n[e]=l,c;function l(...f){return i===o&&n[e]===l&&c(),i.apply(this,f)}function c(){n[e]===l&&(s?n[e]=o:delete n[e]),i!==o&&(i=o,Object.setPrototypeOf(l,r||Function))}}var gt=crypto;var Mr=new TextEncoder,Bt=new TextDecoder,eI=2**32;var zg=n=>{let e=n;typeof e=="string"&&(e=Mr.encode(e));let t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))},yr=n=>zg(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Xg=n=>{let e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},es=n=>{let e=n;e instanceof Uint8Array&&(e=Bt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Xg(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Nf={};zl(Nf,{JOSEAlgNotAllowed:()=>mi,JOSEError:()=>dt,JOSENotSupported:()=>Xe,JWEDecryptionFailed:()=>gi,JWEInvalid:()=>Vt,JWKInvalid:()=>fl,JWKSInvalid:()=>dl,JWKSMultipleMatchingKeys:()=>hl,JWKSNoMatchingKey:()=>yi,JWKSTimeout:()=>pl,JWSInvalid:()=>tn,JWSSignatureVerificationFailed:()=>wi,JWTClaimValidationFailed:()=>pi,JWTExpired:()=>ul,JWTInvalid:()=>Dt});var dt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},pi=class extends dt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},ul=class extends dt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},mi=class extends dt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},Xe=class extends dt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},gi=class extends dt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Vt=class extends dt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},tn=class extends dt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Dt=class extends dt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},fl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},dl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},yi=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},hl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},pl=class extends dt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},wi=class extends dt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var ml=gt.getRandomValues.bind(gt);function dE(n){return typeof n=="object"&&n!==null}function Ft(n){if(!dE(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}var kE=Symbol();var OE,wl,ly;(typeof navigator=="undefined"||!((ly=(wl=navigator.userAgent)==null?void 0:wl.startsWith)!=null&&ly.call(wl,"Mozilla/5.0 ")))&&(OE="jose/v5.3.0");var Hf={};zl(Hf,{decode:()=>_l,encode:()=>IE});var IE=yr,_l=es;function Wf(n){if(typeof n!="string")throw new Dt("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=n.split(".");if(t===5)throw new Dt("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Dt("Invalid JWT");if(!e)throw new Dt("JWTs must contain a payload");let r;try{r=_l(e)}catch(o){throw new Dt("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Bt.decode(r))}catch(o){throw new Dt("Failed to parse the decoded payload as JSON")}if(!Ft(s))throw new Dt("Invalid JWT Claims Set");return s}var ts=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function cy(n){return n<1e3?`${n}ms`:n<6e4?`${Math.round(n/1e3)}s`:n<36e5?`${Math.round(n/6e4)}m`:`${Math.round(n/36e5)}h`}function LE(n){let e=Wf(n.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var bl=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=LE,this.maxConnections=t,this.refreshInterval=null}onRefresh(e){return new Promise((r,s)=>{let o=l=>{r(l)},i=l=>{s(l)};this.refresh(e,o,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=s=>{this.onTokenRefreshed(e,s),this.activeConnections--;let o=this.dequeue();o&&this.addToRefreshQueue(o)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let s=this.tokenMap.get(e),o=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...s,token:t,expiryTime:r}),o(t),this.log(`Token refreshed for ${s.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let s=this._activePromises.get(e);if(s)return s;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let o=this.onRefresh(e).then(i=>(this.onTokenRefreshed(e,i),this._activePromises.delete(e),i)).catch(i=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),i});return this._activePromises.set(e,o),o}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new ts("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let s=this.tokenMap.get(e);if(s.token&&this.isTokenValid(s))return this.callbacks.set(e,r),s.friendlyName=t,r(s.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(s.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),s=Array.from(this.tokenMap.entries()).sort((o,i)=>o[1].expiryTime-i[1].expiryTime);for(let[o,{friendlyName:i,expiryTime:l,attempts:c}]of s){if(!e(o))continue;let f=l-r,d="";f>0?d=`expires in ${cy(f-this.expiryMargin)}`:d="expired",t.push(`${o} (${i}): ${c} attempts, (${d})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${cy(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(){this.tokenMap.clear(),this.refreshQueue.clear()}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};var uy=require("obsidian");var vl=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let s=r.split(`${this.namespace}${this.seperator}`)[1],o=this.get(s);e.call(t,o,s,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};function $E(n){return n.expiryTime||0}function UE(n,e){return(...t)=>e(n,...t)}async function NE(n,e,t,r){var f;let s=Q("[TokenStore][Refresh]","log"),o=Q("[TokenStore][Refresh]","error");s(`${e}`);let i=Dr.decode(e),l;if(i instanceof dr)l=JSON.stringify({docId:i.documentId,relay:i.relayId});else if(i instanceof Gt)l=JSON.stringify({docId:i.folderId,relay:i.relayId});else{r(new Error("No remote to connect to"));return}if(!n.loggedIn){r(Error("Not logged in"));return}let c={Authorization:`Bearer ${(f=n.user)==null?void 0:f.token}`};(0,uy.requestUrl)({url:"https://api.system3.md/token",method:"POST",headers:c,body:l}).then(d=>{d.status!==200&&(s(d.status,d.text),r(Error(`Received status code ${d.status} from an API.`)));let p=d.json;t(p)}).catch(d=>{o(d,l),r(d)})}var xl=class extends bl{constructor(e,t,r,s=5){super({log:Q("[LiveTokenStore]"),refresh:UE(e,NE),getJwtExpiry:$E,getStorage:function(){return new vl("TokenStore/"+r)},getTimeProvider:()=>t},s)}};var fy=require("obsidian");var Kf=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Q("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,fy.requestUrl)({url:this.url,method:"HEAD"}).then(e=>{if(e.status===200&&!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t()),this._onceOnline.forEach(t=>t()),this._onceOnline.clear();return}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t())})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},dy=Kf;var Sl=class{constructor(e){this.app=e}renameFile(e,t){return this.app.fileManager.renameFile(e,t)}};var wr=class extends $t{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,s]of this._map)if(t(s,r))return s}some(t){for(let[r,s]of this._map)if(t(s,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let s=new Yf(this,t);return this._derivedMaps.set(t,s),s}},Yf=class extends wr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,s)=>{this.predicate(r,s)&&t.set(s,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),[...this._listeners.values()].length===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function Jf(n){return typeof n.id=="string"}function BE(n){return typeof n.name=="string"}var qf=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function hy(n){return typeof n.aggregate_root=="object"}function py(n){return typeof n.acl=="object"}var bi=class{get aggregate_root(){}get acl(){}},kl=class extends bi{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},jf=class extends bi{constructor(t,r,s){super();this.remoteFolder=t;this.relays=r;this.users=s}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},Gf=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new jf(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},zf=class{constructor(e,t,r,s,o,i,l){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=o;this.subscriptions=i;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Cl(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Xf=class{constructor(e,t,r,s){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=s}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new rd(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Zf=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new nd(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Qf=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new kl(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},ed=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new sd(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},td=class{constructor(e){this.collections=new Map,this.relationships=new Map;for(let t of e)this.collections.set(t.collectionName,t);this.error=Q("[Store]","error"),this.warn=Q("[Store]","warn"),fr.set(this,"Store")}getCollection(e){let t=this.collections.get(e);if(!t)throw this.error("No collection found for",e),new Error("No collection found for "+e);return t}clear(){let e=zt.getInstance();e.beginTransaction(),this.collections.forEach(t=>{t.clear()}),this.collections.clear(),this.relationships.clear(),e.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(e){return this.ingestBatch(e==null?void 0:e.items)}ingestBatch(e){if(e)return e.map(t=>this.ingest(t))}ingest(e){let t=zt.getInstance();t.beginTransaction();let r=this._ingest(e);return t.commitTransaction(),r}_ingest(e){if(!e)return;let t,r=this.collections.get(e.collectionName);if(r?t=r.ingest(e):this.error("No collection found for record",e),hy(t)){let s=t.aggregate_root;if(s){let o=e.id,i=this.relationships.get(s.join(":"))||new Set;i.add([e.collectionName,o].join(":")),this.relationships.set(s.join(":"),i)}}if(py(t)){let s=t.acl;if(s){let o=e.id,i=this.relationships.get(s.join(":"))||new Set;i.add([e.collectionName,o].join(":")),this.relationships.set(s.join(":"),i)}}if(e.expand)for(let[,s]of Object.entries(e.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return t}delete(e){this.cascade(e.collectionName,e.id)}graphviz(){let e=`digraph G {
`;for(let[t,r]of this.collections)for(let s of r.items()){if(!Jf(s)){this.warn("record has no id",s);continue}let o=t+"_"+s.id;if(BE(s)&&(o=t+"_"+s.name),e+=`  ${t}_${s.id} [label="${o}"];
`,Jf(s)&&hy(s)&&s.aggregate_root){let[i,l]=s.aggregate_root;e+=`  ${t}_${s.id} -> ${i}_${l};
`}if(Jf(s)&&py(s)&&s.acl){let[i,l]=s.acl;e+=`  ${t}_${s.id} -> ${i}_${l} [style=dotted];
`}}return e+="}",e}cascade(e,t){let r=this.collections.get(e),s=this.relationships.get([e,t].join(":")),o=zt.getInstance();o.beginTransaction(),r&&(this.warn("cascade delete parent",e,t),r.delete(t)),this.relationships.delete([e,t].join(":"));for(let i of s||[]){let[l,c]=i.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}o.commitTransaction()}},rd=class extends bi{constructor(t,r,s,o){super();this.users=s,this.roles=o,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error("invalid role");return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},nd=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},sd=class extends $t{constructor(t,r,s){super();this.subscription=t;this.relays=r;this.users=s}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancel_at(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Cl=class extends $t{constructor(t,r,s,o,i,l){super();this.relay=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=o;this._subscriptions=i;this.user=l;this.log=Q("[RelayAuto]","log"),this.warn=Q("[RelayAuto]","warn")}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get user_limit(){return this.relay.user_limit}get role(){var s;let t=this.relay.creator===this.user.id,r=(s=this.relayRoles.find(o=>{var i;return((i=o.relay)==null?void 0:i.id)===this.relay.id&&o.user.id===this.user.id}))==null?void 0:s.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(s=>s.relay.id===this.id&&s.user.id===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}},El=class{constructor(e){this.loginManager=e;this.log=Q("[RelayManager]","log"),this.debug=Q("[RelayManager]","debug"),this.warn=Q("[RelayManager]","warn"),this.pb=this.loginManager.pb,this.users=new wr("users"),this.relays=new wr("relays"),this.remoteFolders=new wr("remote folders"),this.relayInvitations=new wr("relay invitations"),this.relayRoles=new wr("relay roles"),this.roles=new wr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new wr("subscriptions"),this._offLoginManager=this.loginManager.subscribe(()=>{this.login()}),this.setUser(),this.user&&(fr.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user||this.store)return;let e=new qf(this.roles),t=new Qf(this.users),r=new zf(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user),s=new Xf(this.relayRoles,this.relays,this.users,this.roles),o=new Zf(this.relayInvitations,this.relays,this.roles),i=new Gf(this.remoteFolders,this.relays,this.users),l=new ed(this.subscriptions,this.relays,this.users);this.store=new td([e,t,r,s,o,i,l])}setUser(){var e;this.authUser=(e=this.pb)==null?void 0:e.authStore.model,this.authUser&&(this.user=new kl(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var e;(e=this.store)==null||e.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(e){if(!this.pb)return"";let t=this.relayInvitations.find(r=>r.relay.id===e.id);return t!=null&&t.key?t.key:this.pb.collection("relay_invitations").getList(0,200).then(r=>{r.items.forEach(o=>{var i;(i=this.store)==null||i.ingest(o)});let s=this.relayInvitations.find(o=>o.relay.id===e.id);return s?s.key:""})}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0)return;let e=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],t=(s,o)=>{var i,l;this.debug(`[Event]: ${s}`,o.action,o.record),o.action==="delete"?(i=this.store)==null||i.delete(o.record):(l=this.store)==null||l.ingest(o.record)};for(let s of e)this.pb.collection(s.name).subscribe("*",o=>t(s.name,o),{expand:s.expand.join(","),fetch:Zn})}collection(e){this.pb}async update(){var e;if(!(!this.pb||!this.pb.authStore.isValid||((e=this.pb.authStore.model)==null?void 0:e.id)===void 0))try{await this.pb.collection("users").getOne(this.pb.authStore.model.id,{expand:"relay_roles_via_user,relay_roles_via_user.relay,relay_roles_via_user.role,subscriptions_via_user,subscriptions_via_user.relay"}).then(t=>{var r;(r=this.store)==null||r.ingest(t)}).catch(t=>{t.status===404&&this.loginManager.logout()}),await this.pb.collection("relay_roles").getFullList({expand:"user"}).then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})}),await this.pb.collection("relay_invitations").getFullList().then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})}),await this.pb.collection("shared_folders").getFullList({expand:"relay,creator"}).then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})}),await this.pb.collection("subscriptions").getFullList({expand:"relay,user",fetch:Zn}).then(t=>{t.forEach(r=>{var s;(s=this.store)==null||s.ingest(r)})})}catch(t){this.warn("error during update()",t)}}async acceptInvitation(e){var s;if(!this.pb)throw new Error("Failed to accept invitation");let t=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e})});this.debug("[InviteAccept]",t);let r=(s=this.store)==null?void 0:s.ingest(t);if(!r)throw new Error("Failed to accept invitation");return r}async createRelay(e){var o;let t=$s(),r=await((o=this.pb)==null?void 0:o.collection("relays").create({guid:t,name:e,path:null}));if(!r)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new Cl(r,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(s.id,s),s}async updateRelay(e){var s;if(!this.pb)throw new Error("Failed to update relay");let t=await this.pb.collection("relays").update(e.id,{name:e.name.trim()}),r=(s=this.store)==null?void 0:s.ingest(t);if(!r)throw new Error("Failed to update relay");return r}async deleteRemote(e){var r;e.remote=void 0;let t=this.remoteFolders.find(s=>s.guid===e.guid);return t?(await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),e.remote=void 0,!0):!1}async createRemoteFolder(e,t){var o,i;if(!this.pb)throw new Error("Failed to create folder");let r=await this.pb.collection("shared_folders").create({name:e.name,guid:e.guid,relay:t.id,creator:(o=this.user)==null?void 0:o.id,private:!1},{expand:"relay"}),s=(i=this.store)==null?void 0:i.ingest(r);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(e){var t,r;return await((t=this.pb)==null?void 0:t.collection("relays").delete(e.id)),(r=this.store)==null||r.cascade("relays",e.id),!0}async leaveRelay(e){var r,s;let t=this.relayRoles.find(o=>{var i,l;return o.user.id===((i=this.user)==null?void 0:i.id)&&((l=o.relay)==null?void 0:l.id)===e.id});t?await((r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",e.id)}async kick(e){var t;return(t=this.pb)==null?void 0:t.collection("relay_roles").delete(e.id)}destroy(){var e,t;this._offLoginManager&&this._offLoginManager(),(e=this.pb)==null||e.cancelAllRequests(),this.loginManager=null,this.pb=null,(t=this.store)==null||t.destroy(),this.authUser=null,this.store=null}};var vy=require("obsidian");var _y=require("obsidian");var yy=require("obsidian");function VE(n){rt(n,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function my(n,e,t){let r=n.slice();return r[5]=e[t][0],r[6]=e[t][1],r}function gy(n){let e,t,r,s=n[5]+"",o,i,l,c,f=n[5]+"",d,p,g,_,y,x,C,v,D,Y,S,M,O;function U(){return n[2](n[5])}function I(){return n[3](n[5])}return{c(){e=L("div"),t=L("div"),r=L("div"),o=ae(s),i=q(),l=L("div"),c=ae("Toggle "),d=ae(f),p=ae(" on or off"),g=q(),_=L("div"),y=L("div"),x=L("input"),v=q(),D=L("div"),S=q(),F(r,"class","setting-item-name"),F(l,"class","setting-item-description"),F(t,"class","setting-item-info"),F(x,"type","checkbox"),x.checked=C=n[6],F(D,"class","checkbox-toggle"),F(y,"role","checkbox"),F(y,"aria-checked",Y=n[6]),F(y,"tabindex","0"),F(y,"class","checkbox-container svelte-4kkvmr"),bu(y,"is-enabled",n[6]),F(_,"class","setting-item-control"),F(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(oe,ue){T(oe,e,ue),J(e,t),J(t,r),J(r,o),J(t,i),J(t,l),J(l,c),J(l,d),J(l,p),J(e,g),J(e,_),J(_,y),J(y,x),J(y,v),J(y,D),J(e,S),M||(O=[re(y,"keypress",U),re(y,"click",I)],M=!0)},p(oe,ue){n=oe,ue&1&&s!==(s=n[5]+"")&&we(o,s),ue&1&&f!==(f=n[5]+"")&&we(d,f),ue&1&&C!==(C=n[6])&&(x.checked=C),ue&1&&Y!==(Y=n[6])&&F(y,"aria-checked",Y),ue&1&&bu(y,"is-enabled",n[6])},d(oe){oe&&E(e),M=!1,Te(O)}}}function HE(n){let e,t,r,s,o,i=ze(Object.entries(n[0])),l=[];for(let c=0;c<i.length;c+=1)l[c]=gy(my(n,i,c));return{c(){e=L("div"),t=L("h2"),t.textContent="Feature Flags",r=q(),s=L("p"),s.textContent="Make sure you reload obsidian after changing the flags below.",o=q();for(let c=0;c<l.length;c+=1)l[c].c();F(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(c,f){T(c,e,f),J(e,t),J(e,r),J(e,s),J(e,o);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null)},p(c,[f]){if(f&3){i=ze(Object.entries(c[0]));let d;for(d=0;d<i.length;d+=1){let p=my(c,i,d);l[d]?l[d].p(p,f):(l[d]=gy(p),l[d].c(),l[d].m(e,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=i.length}},i:Z,o:Z,d(c){c&&E(e),Zt(l,c)}}}function WE(n,e,t){let r=et.getInstance(),s=Object.assign({},r.flags);function o(c){t(0,s[c]=!s[c],s),r.setFlag(c,s[c],!0)}return hr(()=>{Object.keys(s).forEach(c=>{let f=document.getElementById(`toggle-${c}`);f&&(0,yy.setIcon)(f,"check")})}),[s,o,c=>{o(c)},c=>o(c)]}var od=class extends ne{constructor(e){super(),ie(this,e,WE,HE,te,{},VE)}},wy=od;var Tl=class extends _y.Modal{constructor(t){super(t)}onOpen(){let{contentEl:t}=this;this.component=new wy({target:t})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var KE={sharedFolders:[],debugging:!1,...Ma},Al=class extends vy.Plugin{constructor(){super(...arguments);this.settingsFileLocked=!0;this.fileDiffMergeWarningKey="file-diff-merge-warning"}enableDebugging(t){Ta(!0),console.warn("RelayInstances",fr),t&&(this.settings.debugging=!1,this.saveSettings())}disableDebugging(t){Ta(!1),t&&(this.settings.debugging=!1,this.saveSettings())}toggleDebugging(t){let r=!this.settings.debugging;return Ta(r),t&&(this.settings.debugging=r,this.saveSettings()),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.log=Q("[System 3][Relay]","log"),this.warn=Q("[System 3][Relay]","warn"),await this.loadSettings();let t=et.getInstance();t.setFlags(this.settings),this._offFlagUpdates=t.subscribe(s=>{this.settings={...this.settings,...s.flags},this.saveSettings()}),this.settings.debugging&&(this.enableDebugging(),this.addCommand({id:"toggle-feature-flags",name:"Feature Flags",callback:()=>{new Tl(this.app).open()}})),this.vault=new Ga(this.app);let r=this.vault.getName();this.fileManager=new Sl(this.app),this.timeProvider=new Js,this.register(()=>{this.timeProvider.destroy()}),this.loginManager=new cl(this.vault.getName(),this.openSettings.bind(this)),this.relayManager=new El(this.loginManager),this.sharedFolders=new Pa(this.relayManager,this._createSharedFolder.bind(this)),this.tokenStore=new xl(this.loginManager,this.timeProvider,r,3),this.networkStatus=new dy(this.timeProvider,"https://api.system3.md/health?version=0.3.0"),this.backgroundSync=new Ka(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new An.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(async()=>{this.loadSharedFolders(this.settings.sharedFolders);let s=new za(this.app.workspace);this._liveViews=new ja(s,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),by.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(o=>o.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(to,o=>new qa(o)),this.setup(),this.settingsFileLocked=!1,this._liveViews.refresh("init")})}loadSharedFolders(t){this.log("Loading shared folders");let r=this.settingsFileLocked;this.settingsFileLocked=!0;let s=!1;t.forEach(o=>{if(!this.vault.getFolderByPath(o.path)){this.warn(`[System 3][Relay][Shared Folder]: Invalid settings, ${o.path} does not exist`);return}this.sharedFolders._new(o.path,o.guid,o==null?void 0:o.relay),s=!0}),this._offSaveSettings||(this._offSaveSettings=this.sharedFolders.subscribe(()=>{this.saveSettings()})),this.settingsFileLocked=r,s&&this.sharedFolders.notifyListeners()}async _createSharedFolder(t,r,s,o){return new Ra(r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.backgroundSync,s,o)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.loadSharedFolders(this.settings.sharedFolders),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(){let t=this.app.setting;await t.open(),t.openTabById("system3-relay")}setup(){this.folderNavDecorations=new Za(this.vault,this.app.workspace,this.sharedFolders),this.folderNavDecorations.refresh(),this.settingsTab=new nl(this.app,this),this.addSettingTab(this.settingsTab);let t=Q("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",d=>{t("file-open"),c._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Q("[System 3][Relay][Vault]","log"),s=d=>{let p=d.error;console.error(p),p instanceof ts&&uu(p)},o=d=>s(d);window.addEventListener("error",o,!0),this.register(()=>window.removeEventListener("error",o,!0));let i=d=>{d.reason instanceof ts&&uu(d.reason)},l=d=>i(d);window.addEventListener("unhandledrejection",l,!0),this.register(()=>window.removeEventListener("unhandledrejection",l,!0)),this.registerEvent(this.app.vault.on("create",d=>{if(d instanceof An.TFolder)return;let p=this.sharedFolders.lookup(d.path);p&&p.whenReady().then(g=>{g.getFile(d.path,!0,!0)})})),this.registerEvent(this.app.vault.on("delete",d=>{if(d instanceof An.TFolder){let g=this.sharedFolders.find(_=>_.path===d.path);g&&this.sharedFolders.delete(g);return}let p=this.sharedFolders.lookup(d.path);p&&(r("Delete",d),p.whenReady().then(g=>{g.deleteFile(d.path)}))})),this.registerEvent(this.app.vault.on("rename",(d,p)=>{if(d instanceof An.TFolder){let x=this.sharedFolders.find(C=>C.path==p);x&&(x.path=d.path,this.sharedFolders.update());return}let g=this.sharedFolders.lookup(p),_=this.sharedFolders.lookup(d.path),y=g||_;g&&_?(r("Rename",d,p),g.renameFile(d.path,p),_.renameFile(d.path,p),this._liveViews.refresh("rename")):y&&(r("Rename",d,p),y.renameFile(d.path,p),this._liveViews.refresh("rename"))})),this.registerEvent(this.app.vault.on("modify",d=>{let p=this.sharedFolders.lookup(d.path);p&&(r("Modify",d),Gr(jr.enableUpdateYDocFromDiskBuffer,()=>{try{let g=p.getFile(d.path,!1,!1);this._liveViews.docIsOpen(g)||p.read(g).then(_=>{_.length!==0&&Ya(g.ydoc,_)})}catch(g){}}),this.app.metadataCache.trigger("resolve",d))}));let c=this,f=Gg(An.MarkdownView.prototype,{onUnloadFile(d){return function(p){return c._liveViews.wipe(),d.call(this,p)}}});this.register(f)}onunload(){var t,r,s,o,i,l,c,f;this.settingsFileLocked=!0,this._offFlagUpdates(),this._offSaveSettings&&this._offSaveSettings(),this.timeProvider.destroy(),(t=this.folderNavDecorations)==null||t.destroy(),this.app.workspace.detachLeavesOfType(to),this.backgroundSync.destroy(),(r=this._liveViews)==null||r.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(o=this.tokenStore)==null||o.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(f=this.networkStatus)==null||f.destroy(),this.networkStatus=null,this.sharedFolders.destroy(),this.sharedFolders=null,this.settingsTab.destroy(),this.loginManager.destroy(),et.destroy(),zt.destroy(),gm()}async loadSettings(){this.settings=Object.assign({},KE,await this.loadData())}async saveSettings(){this.settingsFileLocked?this.log("Saving settings: settings file locked"):(this.settings.sharedFolders=this.sharedFolders.toSettings(),this.log("Saving settings",this.settings),await this.saveData(this.settings),et.getInstance().setFlags(this.settings))}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/
